context = '''
你是一位人类学家，作家，数据分析师。
'''

context2 = '''
你是一位人类学家，数据分析师，规划师。
'''

context3 = '''
你是一位人类学家，心理学家，作家。
'''

template_analyse = """
请基于以下人物画像数据，完成三项核心任务，输出结果需兼具全面性与结构化，为后续生成人物生活数据提供精准依据：
一、综合信息提炼
撰写一份整合描述，需系统覆盖以下核心维度：①基本信息（年龄、性别、学历、籍贯等关键标识）；②生活习惯（作息规律、饮食偏好、运动频率、兴趣爱好等日常行为特征）；③社交状态（社交圈规模、主要交往对象类型、社交频率与场景）；④工作情况（职业类型、岗位层级、行业属性等基础信息）；⑤经济状况（收入水平、消费习惯、负债/资产情况等）；⑥家庭结构（婚姻状况、亲属关系、家庭角色）；⑦个人特质（性格倾向、价值观、目标诉求等）；⑧重要日期（生日，结婚纪念日等）。描述需突出各维度关键信息，避免冗余。
二、专项深度分析
针对以下三个方向进行精准拆解，输出明确结论：
1. 居住情况：明确当前同住家庭成员构成（姓名、关系、年龄等），同步提炼居住相关特征（如住房类型、居住城市/区域、居住环境偏好、居家活动重点区域等）；
2. 工作情况：梳理工作中核心关联人物（如上级、下属、重要合作对象及关系属性），总结工作关键特征（如工作节奏、核心职责、办公模式、职业发展阶段等）；
3. 生活情况，梳理日常生活中常用联系人，总结生活中包括工作日非工作时间和非工作日可能的行为特征（如生活节奏，常见行为，生活阶段等）。
4. 日常轨迹：以“工作日”为核心场景，还原典型一天的生活常规轨迹，按时间顺序清晰呈现各时段主要活动及行为目的（需包含起床、通勤、工作、餐饮、休闲、睡眠等关键节点），不需要具体时间和具体事件。
三、事件分析
分析该人物可能生活中可能涉及的以下事件类别对应比例的合理列表。事件类别：Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other。
{persona}
最终把以上两个任务的输出组织成以下格式输出，在<analyse>输出信息分析，在<percent>输出一个字典json，包含对映类别的百分比占比（例子：25%）。json直接以{{}}作为开头结尾，不要有多余文本。

<analyse>
1.信息提炼：
2.深度分析：
2.1：居住情况：
2.2：工作情况：
2.3：生活情况：
2.4：工作日轨迹：
</analyse>
<percent>
{{"Career":"","Education":"","Relationships":"","Family&Living Situation":"","Personal Life":"","Finance":"","Health":"","Unexpected Events":"","Other":""}}
</percent>
"""

template_yearterm_eventgen = '''
请基于下方的【人物分析】，为该人物推理生成 2025 年内可能发生的 100 件符合其画像的生活事件，需严格遵循以下要求，确保内容兼具真实性、连贯性、多样性与结构化：

## 一、核心创作原则

### 1. 真实性与贴合性
- **深度贴合人物画像**：所有事件必须与人物的职业背景、家庭关系、生活习惯、性格特质、经济状况、社交圈强关联，避免任何与画像矛盾的内容。
- **符合现实逻辑**：事件需遵循时间规律（如“冬季滑雪”“春节返乡”）、生活常识（如“装修需1-2个月工期”“资格证备考需1-3个月”）与社会规则（如“商业谈判需多次沟通”“医疗检查需提前预约”）。
- **自然的因果关联**：部分事件之间应存在合理的因果关系（如“购买新房”→“装修设计”→“乔迁新居”），体现生活的连贯性。

### 2. 多样性与平衡性
- **全面覆盖生活维度**：事件需涵盖职业、家庭、社交、健康、财务、个人成长等多个领域，避免过度集中于单一类别。
- **事件类型多样化**：包含短期事件（1-3天）、中期事件（1-4周）、长期事件（1-3个月），以及一次性事件和周期性事件。
- **情绪与强度层次**：事件应包含积极、中性、轻微挑战性的不同情绪和强度，体现真实生活的起伏。

### 3. 非日常性与记忆点
- 优先选择「值得记录回忆」「需要提前准备」「能体现个人特质」的场景，避免过于琐碎的日常事务。
- 每个类别的事件应具有独特性，避免同一类别的事件内容同质化。

## 二、事件细节要求

### 1. 时间设定规范
- **格式统一**：所有事件必须标注具体时间（格式：2025-XX-XX 或 2025-XX-XX 至 2025-XX-XX）。
- **周期性事件**：多次发生的事件需标注所有时间节点（格式：2025-XX-XX, 2025-XX-XX, 2025-XX-XX）。
- **时间分布**：事件应均匀分布在全年各月份，避免过度集中或稀疏。
- **时间重叠**：允许合理的时间重叠（如“云南旅行”期间“远程处理工作”），但需符合现实逻辑。

### 2. 类别覆盖要求
**可使用以下9个类别**，根据人物画像灵活分配各类别事件数量：
- **Career**：职业工作相关（如“参加行业高峰论坛”“参与新产品研发项目”）
- **Education**：教育学习相关（如“上课”“考取专业资格证”，学生角色该类事件较多，其他角色相关事件会较少）
- **Relationships**：人际关系（如“为父母筹备生日宴”“组织闺蜜旅行”）
- **Family&Living Situation**：家庭生活与居住环境（如“家居装修”“智能家居安装”）
- **Personal Life**：自我关怀、娱乐与生活方式（SelfCare & Entertainment & Lifesyle）（如“定期SPA护理”“短途旅行”“组织同学聚会”）
- **Finance**：个人资产财务（如“购买理财产品”“汽车保养与维修”）
- **Health**：健康管理（如“中医调理”“瑜伽静修营”）
- **Unexpected Events**：突发应对（如“车辆小事故处理”“临时加班替班”）
- **Other**：其他未涉及类别

**类别分配原则**：
- 优先生成与人物职业、生活状态、性格特质高度相关类别的事件
- 对于与人物画像不相关或关联度极低的类别，可生成极少甚至不生成事件
- 确保整体事件分布符合人物的真实生活场景（如学生的Education类事件占比高，职场人士的Career类事件占比高）

### 3. 事件描述要求
- **具体明确**：事件描述需包含who（参与者）、what（事件内容）、why（目的/意义），避免模糊不清。
- **贴合场景**：描述需符合事件发生的时间、地点和人物身份，体现真实参与感。
- **简洁凝练**：每个事件描述控制在15-50字，突出核心信息。

## 三、输出格式要求

### 1. 结构化输出
- 严格按「类别 + 事件数量」分组输出，每个类别独立成段。
- 每个类别下的事件按**时间先后顺序**排序。
- 类别名称必须与上述10个类别完全一致，不得修改或缩写。

### 2. 格式示例
<type>Career & Education（20 件）</type>
    参加上海零售业高峰论坛（2025-03-18 至 2025-03-19）：作为家族企业代表，学习行业趋势并拓展供应商资源。
    新产品上市策划（2025-04-01 至 2025-04-15）：主导制定夏季新品推广方案，协调各部门执行。

<type>Relationships（15 件）</type>
    为母亲筹备60岁生日宴（2025-05-20）：邀请亲友参加，准备母亲喜爱的传统菜肴和纪念相册。

### 3. 关键约束
- 输出内容**仅包含**类别标题和事件列表，不得添加任何额外分析、解释或说明文本。
- 每个事件必须以「事件名称（时间）：描述」的格式呈现，不得使用其他格式。
- 确保输出的文本格式清晰，易于计算机程序按类别提取事件内容。

---

人物分析：{summary}
'''

template_yearterm_complete = '''
请基于下方【人物画像】及你第一轮生成的 100 件事件，补充创作 90 个左右符合要求的新事件，需严格规避重复并实现精准互补，具体规则如下：

## 一、核心创作原则

### 1. 绝对去重与精准互补
- **内容彻底差异化**：新事件必须与第一轮事件完全不同，无论是事件主题、具体场景、参与人物还是时间安排，均需差异明显，避免任何形式的相似或变相重复。
- **填补第一轮空白**：优先覆盖第一轮未涉及的人物画像信息、生活领域和事件类型，确保人物形象更加立体丰满。

### 2. 补充方向指南

#### （1）未充分利用的画像信息
- 深度挖掘人物画像中第一轮未涉及的细节（如特定技能、爱好、社交关系、家庭背景、职业目标等）
- 例如：若画像提到“同事李华喜欢爬山”，可生成“与李华一起周末登山（2025-04-12）：前往城郊山脉徒步，增进同事关系”

#### （2）节日与季节特色
- **法定节假日**：春节、清明、五一、端午、中秋、国庆、元旦期间的特色事件
- **民间传统节日**：元宵、七夕、重阳、冬至等传统习俗相关事件
- **季节特征**：春季踏青、夏季避暑、秋季赏枫、冬季取暖等季节特有事件

#### （3）类别多样性深化
- 为每个类别挖掘第一轮未涉及的细分领域：
  - Career & Education：项目阶段性任务、跨部门协作、职业认证等
  - Relationships：不同社交圈的互动（同事、朋友、亲戚、邻居等）
  - Living Situation：家居维护、社区活动、居住环境改善等
  - Health & Well-being：预防保健、康复调理、健康检查等

## 二、事件细节要求

### 1. 时间与分布
- **格式规范**：所有事件必须标注具体时间（格式：2025-XX-XX 或 2025-XX-XX 至 2025-XX-XX）
- **节日结合**：优先考虑节日日期（如“端午龙舟赛观赛（2025-06-10）”）和季节时段
- **均匀分布**：事件应均匀分布在全年各月份，避免时间集中
- **合理重叠**：允许与第一轮事件时间重叠，但需符合现实逻辑（如“春节期间远程处理工作”可与“春节家庭聚会”重叠）

### 2. 类别与数量
   - **严格使用规范类别**：与第一轮保持一致，使用以下9个类别：
    Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other
   - **类别灵活分配**：根据人物画像特点和第一轮事件分布灵活补充，
     - 优先补充与人物高度相关类别的事件
     - 对于与人物关联度低的类别，可补充极少甚至不补充事件
     - 第一轮事件较少但与人物相关的类别可适当多补充
 - **总数控制**：目标生成约90件新事件，可根据实际情况在85-95件之间调整

### 3. 质量要求
- **真实性**：事件需符合人物身份、生活场景和现实逻辑
- **具体性**：描述需包含明确的人物、动作、目的，避免模糊不清
- **连贯性**：部分事件可与第一轮事件形成合理关联（如第一轮有“购买新车”，第二轮可生成“新车首保（2025-07-15）”）

## 三、输出格式要求

### 1. 结构化输出
- 严格按「类别 + 补充事件数量」分组输出，每个类别独立成段
- 每个类别下的事件按**时间先后顺序**排序
- 类别名称必须与规范类别完全一致，不得修改或缩写

### 2. 格式示例
<type>Career & Education（第二轮补充 20 件）</type>
    端午商圈联合促销策划（2025-05-20 至 2025-06-10）：联动周边商家推出“端午满减套餐”，融入传统香囊DIY活动吸引客流。
    季度销售数据分析（2025-06-15 至 2025-06-20）：整理第二季度销售数据，制作分析报告并提交给管理层。

### 3. 关键约束
- 输出内容**仅包含**类别标题和事件列表，不得添加任何额外分析、解释或说明文本
- 每个事件必须以「事件名称（时间）：描述」的格式呈现
- 确保输出的文本格式清晰，易于计算机程序按类别提取事件内容

---

画像：{persona}
'''

template_yearterm_complete_2 = '''
请基于人物画像及前两轮已生成的事件，补充创作 80 个左右全新事件，需严格规避重复与冲突，聚焦 “人群共性” 与 “个人专属” 场景，同时聚焦生活真实感，并分析已生成事件是否满足类别比例的数量要求进行针对性调整。具体要求如下：

## 一、核心创作原则

### 1. 严格去重与逻辑自洽
- **绝对原创性**：新事件必须与前两轮事件完全不同，避免任何形式的重复或相似
- **时间空间一致性**：确保时间逻辑自洽，避免空间冲突（如前两轮已设定“2025-05月出差北京”，本轮不可生成“同期在上海参加婚礼”）
- **生活逻辑合理**：事件需符合人物的生活习惯、职业特点和社会角色

### 2. 填补空白维度策略

#### （1）人群共性事件
- 基于人物的性别、年龄、地域、人生阶段等核心标签，生成该群体普遍经历但未被覆盖的事件
- 例如：30岁职场人可能经历的“职业晋升考察期”、“家庭与事业平衡的挑战”等

#### （2）个人专属事件
- 深度挖掘人物的独特性，生成体现其内心需求、隐秘体验或小众习惯的事件
- 例如：“整理童年旧物（2025-08-01）：翻出小时候的照片和日记，回忆成长历程”

#### （3）他人关联事件
- 生成“因他人需求而参与或他人邀请，不基于自身兴趣”的非日常事件，突出人物在各种关系中的角色
- 例如：“帮邻居照顾宠物（2025-09-05 至 2025-09-10）：邻居外出旅行，帮忙喂养其宠物猫”，“参加朋友组织的画展（2025-10-01 至 2025-10-05）：朋友分享绘画作品，我给予其良好的反馈”(自身不感兴趣，基于他人事务邀请而参与)

#### （4）类别比例优化
- 确保各类别事件数量比例与人物画像的匹配度，避免类别失衡

## 二、事件细节要求

### 1. 时间与分布
- **格式规范**：所有事件必须标注具体时间（格式：2025-XX-XX 或 2025-XX-XX 至 2025-XX-XX）
- **均匀分散**：事件应均匀分布在全年各月份，填补前两轮的时间空白
- **合理重叠**：允许与前两轮事件时间重叠，但需符合现实逻辑（如“白天参加朋友婚礼，晚间处理私人事务”）
- **持续时长**：事件时长可多样化，从几小时到数周不等，体现生活的丰富性

### 2. 类别与质量
   - **严格使用规范类别**：与前两轮保持一致，使用以下9个类别：
    Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other
   - **类别动态调整**：
     - 根据人物画像特点和前两轮事件分布，灵活调整各类别补充数量
     - 优先补充与人物高度相关且前两轮覆盖不足的类别
     - 对于与人物关联度低的类别，可补充极少甚至不补充事件
   - **事件质量提升**：
   - 增加事件的具体细节，如地点、人物、原因和结果
   - 体现事件对人物的影响或意义
   - 确保事件符合人物的身份、背景和性格特点

## 三、输出格式要求

### 1. 结构化输出
- 严格按「类别 + 事件数量」分组输出，每个类别独立成段
- 每个类别下的事件按**时间先后顺序**排序
- 类别名称必须与规范类别完全一致，不得修改或缩写

### 2. 格式示例
<type>Career & Education（第三轮补充 15 件）</type>
    参加上海零售业高峰论坛（2025-03-18 至 2025-03-19）：作为家族企业代表，学习行业趋势并拓展供应商资源。
    新产品线上发布会筹备（2025-04-01 至 2025-04-15）：负责公司新产品的线上发布活动策划和执行。

### 3. 关键约束
- 输出内容**仅包含**类别标题和事件列表，不得添加任何额外分析、解释或说明文本
- 每个事件必须以「事件名称（时间）：描述」的格式呈现
- 确保输出的文本格式清晰，易于计算机程序按类别提取事件内容
- 事件总数控制在75-85件之间，可根据类别平衡需要适当调整

---

画像：{persona}
'''

template_yearterm_complete_3 = '''
请基于【人物总结】及前三轮已生成的事件，聚焦 “有困难、负面性、具挑战性” 的场景，补充创作不超过 10 个的符合人物特质的事件，需严格遵循以下要求：

## 一、核心创作原则

### 1. 负面事件的真实性与适配性
- **明确的负面属性**：事件必须包含至少一种负面特质：
  - **困难性**：需要克服明显障碍或挑战
  - **负面性**：带来压力、失落、困扰等负面情绪
  - **挑战性**：超出人物的舒适区或能力范围

- **严格贴合人物画像**：负面事件必须与人物的职业、生活状态、社交关系紧密关联，避免脱离其身份的随机负面事件
  - 例如：职场人可能遇到"项目延期压力"，但不会出现"农田歉收"类事件

- **可控的负面影响**：
  - 负面事件应当是**能被解决的短期波折**，不会导致长期的人物画像变动（如重大职业变动、关系破裂等）
  - 避免生成严重后果的事件（如重大疾病、严重事故、法律纠纷等）

### 2. 负面事件的多样性
- 覆盖不同生活领域（工作、家庭、健康、社交等）的负面场景
- 体现不同类型的挑战（时间压力、资源限制、人际关系冲突、突发状况等）

## 二、事件细节要求

### 1. 时间与分布
- **格式规范**：所有事件必须标注具体时间（格式：2025-XX-XX 或 2025-XX-XX 至 2025-XX-XX）
- **持续时长**：事件时长可多样化：
  - 短期事件（1-3天）：如"急性肠胃炎影响工作"、"突发设备故障处理"
  - 持续困扰（1-2周）：如"项目延期压力"、"人际关系冷战"
- **时间逻辑**：事件时间需与前三轮已生成的事件无冲突，符合人物的日程安排

### 2. 类别与描述深度
- **严格使用规范类别**：与前三轮保持一致，使用以下9个类别：
  Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other

- **重点领域覆盖**：优先选择与人物关联度高的类别（如职场人侧重Career和Education类，家庭主妇侧重Relationships和Family&Living Situation类）

- **详细描述要求**：每件事件必须包含：
  - 清晰的事件经过
  - 明确的负面影响或应对难点
  - 人物的情绪或反应（可选）

  例如：
  - "社交媒体遭遇恶意评论（2025-08-20 至 2025-08-25）：发布的活动视频被网友曲解，引发持续网络攻击，需耗费大量时间澄清并调整账号设置"
  - "重要客户资料丢失（2025-11-03）：电脑硬盘损坏，未备份的年度合作方案丢失，面临重新制作的压力与客户信任危机"

## 三、输出格式要求

### 1. 结构化输出
- 严格按**类别分组**输出，每个类别独立成段
- 每个类别下的事件按**时间先后顺序**排序
- 类别名称必须与规范类别完全一致，不得修改或缩写

### 2. 格式示例
<type>Career & Education</type>
    门店遭遇恶意投诉（2025-02-18 至 2025-02-22）：被竞争对手指使的顾客恶意举报"产品质量问题"，需配合工商调查并暂时下架相关商品，影响营业额。
    项目关键成员离职（2025-07-05）：核心技术人员突然辞职，导致项目进度受阻，需要紧急招聘和重新分配工作。

<type>Living Situation</type>
    家中水管爆裂（2025-01-15）：冬季低温导致水管爆裂，家中积水严重，需要紧急维修并处理家具受潮问题。

### 3. 关键约束
- 输出内容**仅包含**类别标题和事件列表，不得添加任何额外分析、解释或说明文本
- 每个事件必须以「事件名称（时间）：描述」的格式呈现
- 事件总数**不超过10个**，可根据人物画像的适合性适当调整
- 确保输出的文本格式清晰，易于计算机程序按类别提取事件内容

---

人物总结：{summary}
'''

template_extract_impact_events = '''
请基于以下人物画像和事件列表，**仅提取两类重要事件**：
1. **画像信息产生显著改变的事件**：需要更新人物画像信息的重大变化事件，这类事件往往会改变画像信息，导致后续事件可能与其有冲突
2. **影响近期生活习惯的事件**：会改变个人近期生活习惯、作息安排等生活状态的事件

可合理推理一些事件的后续发展来分析影响，并以时间线形式输出所有关键事件节点及其具体影响。**完全忽略无关痛痒的事件**，如仅增进感情、关系深化但未导致实质性改变的事件。

## 一、核心任务

### 1. 事件筛选标准
**仅保留以下两类事件，其他事件一律忽略**：

#### 第一类：画像信息产生显著改变的事件，要分析这个事件是否会对个人后续产生重大影响
**判断标准**：事件发生后必须需要更新人物画像的具体字段信息，或需要依据该信息进行后续事件分析。如果不是需要改变画像或写入画像的一般事件，请忽略。
**具体类型包括**：
工作生活上大的变动、职业、教育里程碑、财务、健康变化、人际关系变化（只关注新认识朋友，与朋友闹掰，朋友相关的大的变动。不关心两人之间感情关系的变化）、爱好特征变化、生活习惯变化。
#### 第二类：影响近期生活习惯的事件
**判断标准**：事件会导致个人在特定时间段内改变作息安排、生活习惯或日常活动模式
**具体类型包括**：
- 短期出差、旅行
- 短期生病
- 连续加班
- 短期培训、学习
- 家庭短期变故（需要调整生活安排1周以上）
- 其他需要改变近期生活习惯的事件

**严格排除的事件类型**：
- 仅增进感情但未改变关系状态的社交活动
- 未导致生活习惯改变的短期情绪波动
- 无实质影响的日常活动
- 24小时内可恢复的短暂不便
- 仅增强技能但未改变职业状态的学习
- 未给自己带来实质变化的各类工作和活动

### 2. 事件处理规则
- **严格对应原始事件**：仅分析提供的事件，每个影响事件必须关联原始事件ID
- **推理限制**：
  - 仅对不完整事件进行合理推理后续发展
  - 推理必须基于人物画像和常识，高合理性，明确关联原事件ID
- **时间节点识别**：必须提取事件发生、影响开始/结束的精确时间点

### 3. 影响分析要求
#### 第一类事件（画像信息变化）分析要求：
- **必须明确指出需要更新的画像字段**：如"新增人物关系：恋爱对象张三"、"更新健康状况：确诊高血压"、"更新职业信息：晋升为部门经理"等或明确说明个人的生活改变、里程碑事件。
- 影响类别（从标准类别选择：Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other）
- 影响持续时间（持续存在/[开始日期]-[结束日期]）

#### 第二类事件（近期生活影响）分析要求：
- **必须明确时间范围**：具体到几号到几号（如2025-05-10至2025-05-20）
- **必须详细描述生活安排变化**：具体说明作息、日常活动等如何改变
- **必须对比与之前的不同**：明确说明与事件发生前的生活安排有何差异
- 影响类别（从标准类别选择）
- 影响持续时间

### 4. 时间线构建
- 按时间顺序排列所有事件和影响节点
- 同一时间点相关事件分组展示

## 二、输出格式
请严格按照以下格式输出，包含<think>和<json>两部分，不要添加任何额外内容：

<think>对这段时间事件的总结分析，概括个人生活/画像变化情况</think>
<json>[JSON格式的影响事件时间线]</json>

### JSON字段说明
[
    {{
        "time_point": "事件发生的精确时间点（YYYY-MM-DD HH:MM:SS或YYYY-MM-DD）",
        "event_content": "事件或影响内容（简明描述）",
        "original_event_id": "原始事件ID（推理事件需关联原ID），所有事件都要有原事件的id",
        "impact_category": "影响类别（从标准类别选择）",
        "impact_description": "具体影响描述，必须满足：\n1. 若为画像信息变化事件：明确指出需要更新的画像字段和具体内容\n2. 若为近期生活影响事件：明确时间范围（几号到几号）、生活安排变化、与之前的不同",
        "impact_duration": "影响持续时间（如持续存在/2025-05-10至2025-05-20/10天）",
        "related_events": "相关事件ID列表",
        "is_inferred": "是否为推理事件（true/false）"
    }}
]


## 三、输入数据
人物画像：{persona}
事件列表：{events}
'''

template_summarize_impact_events = '''
请以以下人物画像为核心依据，结合 {type} 类别的影响事件作为基础参考，按月度时间轴格式创作一份全年个人重要事件与重大变化清单。内容需兼顾连贯性、真实性与多样性，完整呈现从年初到年末的成长轨迹，聚焦两类核心事件：画像信息显著变更事件（对后续产生长期重大影响）与近期生活习惯影响事件（改变短期行为模式）。
一、核心创作要求
全年视角，逻辑连贯闭环
以 “1 月 - 12 月” 为完整时间线，构建 “逻辑连贯，时间连续，内容相关，变化发展” 的递进逻辑，避免孤立事件罗列；
关键画像变更事件需设计明确的 “前因后果”（如 “3 月体检指标异常→4-6 月执行改善计划→7 月复查指标恢复→12 月巩固健康习惯”），形成全年完整的变化链条；
无重大事件的月份需标注 “延续上月状态，稳步推进 XX 计划”，保证时间线无断层，符合真实生活的节奏起伏。
双类事件并重，丰富内容维度
画像信息变更事件：覆盖职业、健康、关系、资产等核心维度（如晋升、证书考取、体检指标更新、核心关系建立 / 深化、资产规模突破等），每个事件需明确标注 “对后续的长期影响”；
生活习惯影响事件：涵盖作息、饮食、运动、社交等日常维度（如短期暂停运动、调整饮食结构、新增冥想习惯、阶段性社交频率变化等），需明确标注 “影响周期”（如 3 天 / 1 个月 / 季度）；
全年需包含3-5 个关键画像变更节点和6-8 个不同类型的习惯调整事件，确保内容多样性，避免单一维度重复。
突破参考局限，合理新增联动情节
输入的影响事件仅为素材，可取舍、重组，需基于人物性格特质（如 ENTJ 注重规划、金融从业者重视风控）主动新增3-5 个合理联动事件（如健康类新增 “结识跑友→组队监督→养成长期运动习惯”；职业类新增 “参加行业沙龙→结识合作伙伴→拓展业务资源”）；
新增事件需符合人物身份背景，且与已有事件强关联，体现 “习惯调整推动画像变更，画像变更反哺习惯优化” 的双向影响。
贴近真实生活，兼顾节奏起伏
模拟真实年度轨迹的 “波峰波谷”：既有晋升、目标达成等积极事件，也可加入短期挫折（如运动受伤、指标波动），体现变化的曲折性；
习惯调整需符合常理（如受伤后短期静养、压力大时调整作息），避免 “一蹴而就” 的理想化设定，增强真实感。
二、内容创作方向
每个月度事件需包含 “具体情节 + 事件类型 + 直接变化 + 影响周期 / 长期价值”，兼顾细节与深度；
突出人物的内在心态变化（如从焦虑到从容、从被动调整到主动规划），让事件不仅是行为记录，更是成长轨迹的体现；
所有创作均需贴合人物画像的核心特质，确保情节真实可信，不脱离人物本质。
三、输入数据
人物画像：{persona}{type} 类别参考事件（仅为基础素材，可灵活拓展）：{impact_events}
输出要求
严格按以下格式逐条输出，纯结构化呈现，无需分段或额外修饰：月份：事件，影响。
'''

template_optimize_year_events = '''
# 核心任务：对{type}类别年度事件总结进行创作优化，**仅聚焦两类重要事件**：
1. **画像信息产生显著改变的事件**：需要更新人物画像具体字段的重大变化事件
2. **影响近期生活习惯的事件**：改变个人近期生活习惯、作息安排的事件

生成更真实、合理、多样的年度重要事件和变化记录，展现个人一年的重要画像变化和生活习惯调整。**完全忽略无关痛痒的事件**，如仅增进感情、关系深化但未导致实质性改变的事件。

## 任务要求：

### 1. 事件创新与扩展（重点强调）
- **仅增加两类重要事件**：基于人物身份、性格和生活轨迹，补充符合逻辑的画像信息变化事件和近期生活影响事件
- 新增事件应与人物画像高度契合，具有时间上的合理性和逻辑连贯性
- 可根据已有事件分析关联和逻辑连贯性，为其增加相关联的重要事件

### 2. 事件筛选与重构（重点强调）
- **严格删除无关事件**：移除仅增进感情、无实质性影响的事件
- **合理修改原事件**：对保留的原事件进行优化，使其符合两类重要事件的标准
- **不要拘泥于原事件**：原事件仅作为参考，可完全重构以生成更合理的时间线
- 确保时间线清晰有序

### 3. 事件深度分析
- 对每个保留和新增的重要事件进行深入分析，明确其性质和意义
- **对于画像信息变化事件**：必须明确指出需要更新的画像字段和具体内容（如"更新职业信息：晋升为部门经理""新增人物关系：恋爱对象张三"）
- **对于近期生活影响事件**：必须明确时间范围（几号到几号）、生活安排变化以及与之前的不同

### 4. 逻辑连贯性与自然过渡
- 确保事件间的时间线合理，无冲突，按时间顺序排列
- 事件变化和影响要有明确的延续性和因果关系
- 为重要事件新增连贯的后续发展，使变化过程更自然流畅

### 5. 全面性与真实性
- 包含关键时间节点和重要变化，覆盖一年的完整周期
- 反映人物在{type}方面的重要变化
- 涵盖积极和消极的事件变化，体现生活的真实性
- 严格符合人物身份、性格和生活轨迹

### 6. 重点变化展现
- **突出人物画像信息的具体变化**：明确具体字段和变更内容
- **明确生活习惯的调整**：具体时间范围和安排变化
- 体现事件对后续生活的实际影响

## 输出格式要求：

请严格按照以下格式输出优化后的年度事件时间线：

# {type} 类年度重要事件与变化时间线

## 重要事件时间线
1. **[时间节点]** [事件描述]（影响：[具体影响内容，画像信息变化需明确字段，生活影响需明确时间范围和安排变化]）
2. **[时间节点]** [事件描述]（影响：[具体影响内容，画像信息变化需明确字段，生活影响需明确时间范围和安排变化]）
...

## 核心变化总结
1. [核心变化1描述：明确具体变化内容]
2. [核心变化2描述：明确具体变化内容]
...

## 输入数据：
### 人物画像：
{character_profile}

### {type}类别年度总结：
{category_summary}
'''

template_merge_and_analyze_events = '''
# 核心任务：融合分析不同类别的年度事件总结，提取跨类别相互影响的重要事件，构建完整的个人年度生活脉络

## 任务要求：

### 1. 跨类别事件融合
- 整合所有类别（职业、生活、学习、健康、社交等）的年度重要事件和一年的变化记录，捕捉个人的变化（包括画像信息、生活习惯、状态表现、核心关系等）
- 识别不同类别事件之间的相互影响和关联关系
- 构建统一的时间线，确保事件按时间顺序排列，描述出该个人一年的生活时间线

### 2. 影响分析与关联性识别
- 分析事件间的因果关系和影响路径（如职业变动如何影响生活方式）
- 识别具有跨类别影响的关键事件（如健康问题影响工作表现）
- 评估事件对人物生活的整体影响和长期意义

### 3. 生活脉络构建
- 提取反映人物年度发展脉络的核心事件链
- 突出重要转折点和关键决策时刻
- 展现个人生活的整体发展趋势和变化

## 输出格式要求：

请以严格的JSON格式输出融合分析后的年度重要事件记录，包含以下字段：

{{
  "year_overview": "[年度整体发展概述]",
  "timeline": [
    {{
      "time_point": "[时间节点]",
      "event": "[事件描述]",
      "influence": "[影响描述]"
    }}
  ]
}}

## 输入数据：
### 人物画像：
{character_profile}

### 各类别年度事件总结：
{category_summaries}
'''

template_monthly_events_analysis = '''
# 核心任务：针对指定月份，分析该月的重要事件和变化记录，识别事件的影响类型（固定改变和近期影响）

## 任务要求：

### 1. 月度事件分析
- 筛选并分析指定月份的重要事件，包括职业、生活、学习、健康、社交等各类别
- 结合月度相关的类别总结，对事件进行优化分析（可增删改事件），通过调整事件发生日期等各类属性，删除不合理冲突事件，增加多样性连贯事件是个人一个月的重要事件和变化被记录。
- 确保事件描述准确、完整，时间线清晰

### 2. 影响分析
- **固定改变**：识别事件导致的长期信息改变，之后所有事件都要考虑是否与其冲突
  - 例如：XX同事离职，之后工作上不会合作，从同事变朋友
  - 需要明确指出具体的变化内容
- **近期影响**：识别事件导致的短期生活状态改变（特定时间段）
  - 例如：出差一周（XX日到XX日），这一周不在家，所以不能去常去的XX健身房，且需要早起参加XX会议
  - 需要明确影响的时间段和具体状态变化

### 3. 输出格式要求

请以严格的JSON格式输出月度事件分析结果，包含以下字段：

{
  "month": "[月份，格式：YYYY-MM]",
  "month_overview": "[月度整体发展概述]",
  "key_events": [
    {
      "time_point": "[具体日期，格式：YYYY-MM-DD]",
      "event": "[事件描述]",
      "fixed_changes": [
        "[固定改变1描述]",
        "[固定改变2描述]"
      ],
      "short_term_impacts": [
        {
          "start_date": "[影响开始日期，格式：YYYY-MM-DD]",
          "end_date": "[影响结束日期，格式：YYYY-MM-DD]",
          "impact_description": "[近期影响描述]"
        }
      ]
    }
  ]
}

## 输入数据：
### 人物画像：
{character_profile}

### 指定月份：
{target_month}

### 该月份的事件列表：
{monthly_events}

### 各类别年度事件总结：
{category_summaries}
'''

template_check = ''' 
 请基于【个人画像】，对提供的【事件列表】进行全面合理性校验，按以下标准筛选出不合理内容，并给出优化建议： 
 一、核心检查维度(按优先级排列) 
 1. 画像匹配度：排查事件与人物画像的冲突点（如职业、性格、兴趣爱好等）
 2. 现实合理性：检查事件是否符合生活逻辑、时间规律或社会常识
 3. 日期、频率与间隔：验证事件发生的时间是否合理、次数、间隔是否合理，是否有不合理的冗余。
 4. 真实性：评估事件发生的真实可能性，是否违和
 5. 逻辑一致性与连贯性：
    - 检查事件之间的因果关系、发展脉络是否合理，前后事件是否存在矛盾或不连贯的情况,相关联事件间的发生日期是否合理。
    - 重点检查重要事件的影响：识别具有重大影响的事件（如同事离职、开始/结束恋爱关系、工作变动、居住地变更、重要人际关系变化等），并验证在这些事件发生后，后续相关事件是否正确反映了这种变化
    - 例如：若有"XX同事离职"事件，后续工作相关事件中不应再出现XX同事参与的情况；若有"开始恋爱"事件，后续生活事件可适当反映恋爱状态的影响
6. 多样性：检查事件是否过于相似和同质化。
  
 处理原则：
 - 优先思考修改方法，若难以合理化则考虑删除
 - 所有修改必须在2025年内进行，不得更改到2025年之外
 - 修改建议包括时间、内容、类型等字段的调整
 - 严重不合理的事件标记为"建议删除"
  
 二、输出格式要求
 请使用结构化格式输出问题事件，每个问题事件包含：
 1. 事件ID：在原事件列表中的索引（从0开始）
 2. 事件内容：原事件的JSON表示
 3. 问题类型：画像冲突/现实不合理/日期问题/真实性问题/类别不一致/逻辑矛盾/不连贯/重要事件影响未体现
 4. 问题描述：具体说明问题所在，特别是对于重要事件影响未体现的情况，需明确指出哪个重要事件的影响未被后续事件反映
 5. 修改建议：详细的修改方案或"建议删除"
  
 仅输出有问题的事件，无需输出合理事件。
 【个人画像】：{persona}
 【事件列表】：{content}
 '''

template_process = ''' 
 请基于上一轮的合理性校验结果（问题事件及修改建议），对下方事件列表进行调整，最终输出处理后的合理事件列表：
 
 1. 对于标记为“建议删除”的事件：直接移除
 2. 对于有修改建议的事件：按照建议进行修改（可调整事件名称、日期、描述、类型等字段）
 3. 对于合理的事件：保留其原始内容
 4. 对于建议新增的事件：进行新增。
 5. 确保所有修改后的事件：
    - 时间范围在2025年内
    - 与个人画像一致
    - 符合现实合理性和真实性
    - type字段为规定的类别之一
    - 日期格式正确（起止时间数组）
  
 注意：
 - 删除操作必须有明确依据，不可无理由移除任何事件
 - 未提及问题的事件请完整保留
  
 --- 
 输出格式严格要求：
 - type字段为Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other之一,目前初步判断为{t}类事件。
 - date字段为起止时间数组，代表事件可能发生多次
 - 确保JSON格式绝对正确，**必须使用标准JSON语法**：
   - 所有字符串使用双引号("")，禁止使用单引号('')
   - 数组和对象的最后一个元素后没有多余逗号
   - 键名必须用双引号包裹
   - 没有语法错误或格式问题
 - 仅输出JSON格式内容，直接以[]作为开头结尾
 - 不添加任何额外文本、注释或代码块标记
 - 不要输出
```json等无关字段
 - description字段为对事件的描述
 - 仅输出JSON格式内容，直接以[]作为开头结尾
 - 不添加任何额外文本、注释或代码块标记
 - 不要输出```json等无关字段
 - 确保JSON格式绝对正确，必须使用标准JSON语法：
   - 所有字符串使用双引号("")，禁止使用单引号('')
   - 数组和对象的最后一个元素后没有多余逗号
   - 键名必须用双引号包裹
   - 没有语法错误或格式问题
 
 格式示例：
 [
   {{ 
     "name": "事件名称",
     "date": ["2025-01-01至2025-01-03"],
     "type": "Career",
     "description": "（描述）"
   }}
 ]
 --- 
 事件列表：{content}
 '''

template_process_1 = ''' 
 基于下面提供的事件列表、人物关系描述和阶段事件列表，对每个事件进行丰富完善和优化，完成以下四项核心任务： 
  
 1）分配合理参与者：
    - 参与者可以包括自己和关系数据中的人物
    - 优先使用关系数据中的人物（姓名和关系必须与relation字段匹配）
    - 如果关系数据中没有合适人选，可以编造合理人物
    - 格式：[{{"name":"姓名","relation":"关系"}}]
  
 2）确定事件发生位置：
    - 描述应包含城市和具体POI类别信息
    - 例如："北京，科技园区办公楼"、"上海，市中心餐厅"
  
 3）优化事件描述：
    - 使其更贴合实际参与场景
    - 内容需更真实丰富、具备关注度且非日常化
    - 保证逻辑合理性
    - 对于重要事件和长跨度事件可进行更详细的描述
    - 确保能完整表达清楚事件的发生大致过程
    - 可考虑事件间的合理连贯关联合理修改一些字段
  
 4）添加EventBrief字段：
    - 这是事件的简短描述（通常1-5个字的词）
    - 如果事件与阶段事件列表中的某个阶段相关，请优先使用该阶段事件文本
    - 如果不相关，请使用类似的简短词汇描述事件核心内容
    - 例如："求职准备"、"面试阶段"、"项目启动"
  
 --- 
 输出格式严格要求：
 - type字段必须为Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other之一。目前初步判断为{t}类事件。
 - date字段为起止时间数组，代表事件可能发生多次
 - description字段为对事件的详细描述
 - participant字段为参与者列表，格式正确
 - location字段描述所处城市和POI类别信息
 - EventBrief字段为事件的简短描述
 - 仅输出JSON格式内容，直接以[]作为开头结尾
 - 不添加任何额外文本、注释或代码块标记
 - 不要输出```json等无关字段
  
 格式示例：
 [
   {{
     "name": "事件名称",
     "date": ["2025-01-01至2025-01-03"],
     "type": "Career",
     "description": "（详细描述）",
     "participant": [{{"name":"张三","relation":"同事"}}],
     "location": "北京海淀区XX科技园区办公楼",
     "EventBrief": "项目启动"
   }}
 ]
 --- 
 事件列表：{content}
 关系数据：{relation}
 阶段事件列表：{stage_events}
 '''

template_process_2 = ''' 
 基于上述 {type} 类别的已有事件，执行以下任务： 
  
 1. 评估现有事件：
    - 检查覆盖度：是否覆盖了{type}类别下的主要方面（参考instruction）
    - 检查画像匹配：是否反映了个人画像中的所有重要信息
    - 检查时间分布：评估事件的时间分布是否合理（覆盖2025年不同月份）
    - 检查逻辑连贯性：评估事件之间的因果关系、发展脉络是否合理，前后事件是否存在矛盾或不连贯的情况
  
 2. 补充必要的新事件：
    - 仅当现有事件不够丰富、存在明显遗漏、数量不足，缺乏连贯逻辑和相关事件时才补充。
    - 新增事件必须符合以下要求：
      a) 与已有事件无任何重复，内容完全不同
      b) 优先从个人具体事务切入（如工作任务、生活家庭事件等）
      c) 高质量、合理真实，宁缺毋滥
      d) 时间范围必须在2025年内
      e) 类型必须为{type}
      f) 与已有事件保持逻辑连贯性，可作为已有事件的补充、延伸或相关事件
      g) 可新增与已有事件相关的辅助事件，增强整体事件序列的逻辑性和完整性
  
 3. 如果现有事件已充分覆盖{type}类别、反映个人画像信息且逻辑连贯，直接输出空数组 []
  
 --- 
 输出格式严格要求：
 - type字段必须为{type}
 - date字段为起止时间数组，代表事件可能发生多次
 - description字段为对事件的描述
 - 仅输出新增的事件，不要包含已有事件
 - 仅输出JSON格式内容，直接以[]作为开头结尾
 - 不添加任何额外文本、注释或代码块标记
 - 不要输出```json等无关字段
 - 确保JSON格式绝对正确，**必须使用标准JSON语法**：
   - 所有字符串使用双引号("")，禁止使用单引号('')
   - 数组和对象的最后一个元素后没有多余逗号
   - 键名必须用双引号包裹
   - 没有语法错误或格式问题
  
 格式示例：
 [
   {{
     "name": "事件名称",
     "date": ["2025-01-01至2025-01-03"],
     "type": "{type}",
     "description": "（描述）"
   }}
 ]
 
 --- 
 已有事件列表：{content}
 人物画像：{persona}
对于{type}类事件，可参考的新增事件思考的方向：{instruction}
 '''

template_event_decomposer = '''
基于该事件列表，对其中的事件进行推理、扩展、分解，形成原子事件序列。原子事件是指详细具体的事件。

--- 说明 ---
1. 提供的原事件本身可能就不完整，需要推理后续相关事件，你可以在原事件列表提供的基础上扩展事件，使其完整丰富（如原事件为装修安排，但未涉及具体装修，则可以进行补充具体装修的内容）补充内容要合理。
1. 原子事件是指粒度细，比较具体的事件。它可能是原事件的详细步骤流程，也可能是原事件的前置（准备/规划/起因/预定）/后续（产生了什么影响/收尾）事件，也可能是相关的事件。**原子事件的发生时间不一定发生在原事件起止时间内，起止事件只代表事件主体发生的时间。在添加前置/后续事件时日期可以放在起止时间之前/之后。**原子事件的事件粒度必须小于等于一天，但是原子事件可以多次发生，如每月聚会的发生时间应写成(2025-01-01,2025-02-01,2025-03-01)而非(2025-01-01至2025-03-01)。注意原事件的id要保留。
2. 你需要分析每个事件，不同的事件重要性/复杂度/特殊性不同，涉及的流程长短，步骤难易，相关的原子事件数目也不同。对于持续时间长，流程复杂的事件，请先将其分解为子事件，再针对每个子事件分解为原子事件。
3. 请分析出不重要事件/日常工作生活等事件/会频繁发生/流程简单的事件，这些事件可以不进行分解。
4. 分解事件也要多样化，如不是所有事件都会经过准备/规划，也不是所有流程都一定会走完。同一类事件在不同时间不同地点执行时的流程和情景也不同。如吃饭可能会选择烤肉或火锅等等，有非常多的多样性。
5. 有些事件虽然持续时间长，但可能主要流程就发生在一天或者几天。由于持续时间是开始到结束时间但不代表这期间每一天都执行了该事件或做该事件有关的事。这之间可能有中断，所以你在分解时，不要求事件时间均匀分布，不要求每天都有相关事件，可以有的天较多执行相关事件，有的天不执行相关事件，要按照真实情况和常理合理分布时间。
6. 事件的各项信息和描述并不是一定合理的，可适当修改，在分析中指出，使其更真实合理。同时可考虑事件间的分解后安排是否有冲突。

--输入说明--
事件列表{content}
输入为事件列表，包含事件的基本信息。
--输出说明
对每个事件，给出一段分析。若需先拆分出子事件，先输出子事件序列，再输出原子事件序列并明确其对应子事件。若可直接分解为原子事件，则给出原子事件序列。示例如下：

**原事件名称、id**
**分析**：
**子事件序列**：
1. 子事件1
2. 子事件2
3. 子事件3
**原子事件序列**：
子事件1：
事件名（发生时间）：描述 

--用户画像--
一些相关信息可以从用户画像中推理
{persona}
'''

template_process_4 = '''
请基于以下输入信息（事件序列、人物画像及日历），对事件进行合理性分析与优化调整，重点解决跨天冲突、地理位置矛盾、不合理重复和事件密度失衡，事件矛盾等问题，确保最终事件序列真实合理、逻辑自洽、便于后续步骤分解：

## 一、操作流程
1. **数据梳理**：先以日历为基础，列出每日事件，人物大致的一天安排和时空轨迹
2. **逐天分析**：针对每日事件开展多维度合理性核验，包括一天内事件密度的合理性，流程的合理性，事件是否符合个人画像等。
3. **事件整合**：将强相关的事件整合为一个逻辑闭环的完整事件。例如：将旅行相关的出行、活动、返程等整合为一个"XX旅行"事件；将项目相关的启动、推进、验收等整合为一个"XX项目实施"事件。整合后的事件应包含所有关键步骤及其发生日期，在描述里详细描述。
4. **事件影响变化分析**：分析出哪些有影响和变化的事件，如出行导致近期用户所在地的变化，认识新朋友导致用户娱乐活动参与人的变化等，对受其影响的事件或发生日期与其相同的事件，要进行调整，确保事件逻辑连贯（如个人前往上海旅行，那么在武汉的工作要么推迟要么远程处理，个人不可以同时在上海和武汉）。
4. **优化调整**：对不合理事件进行调整/删除，包括修改事件内容方式和发生日期，或删除事件。
5. **新增补充**：基于时间特征和空闲时段合理新增事件，确保事件密度均衡，这段时间的个人生活真实自然、变化连贯。同时需考量生活的变化发展（包括时空环境影响等因素），保证生活前后逻辑连贯。你可优先生成新事件并删除与之冲突的旧事件，无需拘泥于输入事件，以保证这段时间事件的高质量与真实合理性。
6. **事件筛选**: 只关注非日常或较重要的，值得记录的事件。避免一些非常琐碎的事件，如果你觉得事件不会对个人产生什么影响，则可以删除，不做输出。可以记录的指：重要事件，产生影响变化的事件，形成新的习惯/目标，不经常进行的事件，让人印象深刻的事件，持续时间较长的事件，或能反应个人近期状态的事件等。
7. **输出结果**：生成优化后的完整事件序列。

## 二、核心分析维度
- **地理位置冲突**：检查事件间的地点，时空矛盾（如同一时间段内在武汉出差和上海旅游同时发生）
- **时间连续性**：确保事件时间安排符合自然逻辑（事件的衔接和安排是否合理）
- **事件合理性**：验证事件的合理性，比如发生频率，对近期的影响，排查事件前后因果关系、流程依赖的合理性（如避免这段时间内理发两次等不合理重复）
- **事件密度平衡**：调整事件分布，避免这段时间事件过于稀疏或密集，调整密度过高（如一天安排5个以上重要事件）或过低（如连续3天无事件）的异常时段
- **画像匹配度**：验证事件内容与人物核心属性（职业、习惯、能力等）的一致性
- **时间特征适配**：结合日历属性（节假日、工作日等）判断事件合理性，工作事件尽量在工作日
- **事件完整性**：确保整合后的事件形成逻辑闭环，包含所有关键步骤和时间节点，无需后续再考虑相关事件
- **工作生活娱乐事件要平衡，不要只有过多的工作或过度娱乐，要根据人物画像和生活习惯合理分配时间。工作事件尽量分布在工作日，娱乐事件则分布在假期**

## 三、优化操作规则（重点解决跨天冲突与事件整合）
1. **优先级排序**：根据事件重要性和紧急程度进行优先级排序
2. **事件整合**：
   - 将强相关事件（如同一主题、同一目标、连续发生的事件，逻辑连贯的事件）整合为一个完整事件
   - 在事件描述中详细叙述每个关键步骤及其发生日期
   - 对完整事件过程步骤进行优化续写等，保证事件描述的连贯性和完整性，要注意发生过程的每个日期不要和其他事件有矛盾。
   - 确保整合后的事件形成逻辑闭环，包含开始、发展、结束等完整过程
   - 例如：旅行事件应包含出行日期、活动安排、返程日期等；项目事件应包含启动、关键节点、完成等
3. **时间调整**：优先通过调整事件时间解决冲突，时间可灵活安排，确保逻辑合理
4. **内容优化**：对描述模糊的事件补充细节，对内容不合理的事件进行针对性修改
5. **事件删除**：对冲突无法调和、严重违背画像或无意义的事件进行删除，优先删除不重要事件，合并相似事件，若无严重不合理优先做修改调整.
6. **地点协调**：对于地理位置冲突的事件，选择更重要的事件保留原地点，或修改删除冲突事件
7. **适当新增**：基于时间特征和人物画像，新增一些的重要事件或值得记录的事件以平衡密度，或新增一些逻辑连贯的相关事件，体现事件的关联性和生活变化发展。使生活多样合理真实
8. **事件调整不必拘泥于这段时间，可合理安排事件的发展持续到后续时间。每个事件必须是一个逻辑闭环的完整事件，防止后续时间的事件生成未考虑现在未完成的事件。所以你可以使事件跨时间段**
9. **你可以随意修改事件、增添事件、整合事件，只要事件合理，前后连贯，不出现时空冲突，逻辑冲突，或发生在前面的事件提前得知后续事件的问题即可**
10. 如果事件质量已经很高，没有明显问题和矛盾，每天的生活和这段时间的生活连贯合理，事件密度均衡，真实，那么可以不做优化。
11. 事件数目不要过多或过少，可删除/新增事件，建议事件数目在13-22个之间。
## 四、输入信息
事件序列：{content}
人物画像：{persona}
日历：{calendar}

## 五、输出要求
### 格式规范
- 仅输出**纯净JSON格式**，以`[]`包裹，无任何额外文本、注释或代码块标记
- 严格遵循以下字段要求：
  - `event_id`：原事件保持不变，新增事件分配>500的随机数字；整合事件使用被整合事件中最重要事件的ID，或分配新ID
  - `name`：事件名称（简洁明确，能体现事件的完整性）
  - `date`：起止时间，格式为`["YYYY-MM-DD至YYYY-MM-DD"]`（包含事件的完整时间段）
  - `type`：事件类型，必须为以下之一：Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other
  - `description`：事件详细描述，需包含所有关键步骤及其发生日期（如："2025-01-10：从北京出发前往上海；2025-01-11至2025-01-13：在上海游览迪士尼乐园；2025-01-14：返回北京"，如果时间跨度长，步骤多，那么可不必明确具体日期，说明几号到几号或者时间段特征即可）
  - `participant`：参与者列表，格式为`[{{"name":"姓名","relation":"关系"}}]`，优先使用画像中已有关系
  - `location`：事件地点，包含主要地点信息（如涉及多个地点，可列出关键地点）

### 示例格式
```json
[
  {{
    "event_id": 1,
    "name": "武汉项目出差",
    "date": ["2025-01-10至2025-01-17"],
    "type": "Career",
    "description": "2025-01-10：从北京出发前往武汉；2025-01-11至2025-01-16：参与XX项目现场实施，完成需求调研和方案设计；2025-01-17：返回北京",
    "participant": [{{"name":"张三","relation":"自己"}}, {{
      "name":"李四","relation":"同事"
    }}],
    "location": "武汉市武昌区科技大厦"
  }},
  {{
    "event_id": 2,
    "name": "上海家庭旅游",
    "date": ["2025-01-25至2025-01-28"],
    "type": "Family&Living Situation",
    "description": "2025-01-25：与家人从北京出发前往上海；2025-01-26：参观上海迪士尼乐园；2025-01-27：游览外滩和东方明珠；2025-01-28：返回北京",
    "participant": [{{"name":"张三","relation":"自己"}}, {{
      "name":"王五","relation":"配偶"
    }}],
    "location": "上海市浦东新区迪士尼度假区、黄浦区外滩"
  }}
]
```

请确保输出的JSON格式完全正确，字段完整，重点关注粗粒度事件的合理性，解决跨天/跨地点冲突，避免不合理重复，保持事件密度平衡。
'''

template_update_long_term_memory = '''
现在你将基于今日生活数据<life>更新个人长期记忆<memory>，可参考<ref>中的自我认知和近期记忆，聚焦今日生活带来的变化与原长期记忆，按以下规则完成更新：

### 一、长期记忆更新核心规则
1. 筛选标准（仅保留以下高价值信息）：
   - 对过去一段时间生活的总结概况；
   - 今日事件中明确的未来计划（需记录具体日期，禁用"明天""周末"等模糊表述）；
   - 客观事实与固定偏好（如"常去XX健身房办卡""家附近超市营业时间8:00-22:00"）；
   - 印象深刻的关键事件（如"2025-11-15首次独立交付项目""2025-11-20与家人确定春节旅行目的地"）；
   - 重复事件总结（如"2025-11-16至2025-11-22连续7天18:30健身，近期高频锻炼"）。

2. 动态更新原则：
   - 无重要事件时可暂不更新，剔除无价值、无后续关联的内容（如单次临时购物、无后续偶然事件）；
   - 移除已发生的未来事件、过时不重要的旧记忆，仅留存高价值信息，可对内容总结压缩；
   - 不与自我认知重复（长期记忆是生活总结与认知，自我认知是固定自我描述）。

3. 内容要求：
   - 所有记忆事件需明确日期（格式：YYYY-MM-DD），信息简洁明确，便于检索调用；
   - 聚焦已发生事实、过去总结、未来明确规划，不添加额外无关内容。

### 二、输出要求（严格遵守，否则会导致解析失败）
1. 仅输出 JSON 格式，直接以 `{{` 开头、`}}` 结尾，无任何额外文本、注释、代码块（禁用```json等标记）；
2. `long_term_memory` 为字符串类型，包含 `<summary>``<habit>``<plan>` 三个字段（无对应内容时字段可留空，如 `<plan></plan>`）；
3. 字符串内仅使用半角空格、标准换行符（\n），禁用全角空格、特殊符号，确保无不可见控制字符；
4. 严格遵循以下格式示例，字段顺序、标签符号（`<>`）不可修改：

{{
"long_term_memory": "<summary>对过去的总结（重点突出核心变化与关键事件，明确日期，作为重点可用较多文本来叙述）</summary><habit>偏好、习惯及重要客观事实（如固定消费场所、常用服务、重复行为总结，标注日期）</habit><plan>仅记录<life>中明确的未来规划，需含具体日期（无则留空，如<plan></plan>）</plan>"
}}

### 三、参考数据
<life>今日生活:{now}</life>
<memory>长期记忆{memory}</memory>
<ref>今日日期{date}，自我认知{cognition}，近期事件{history}</ref>
'''



template_daily_event_objective_optimize = '''
基于第一步生成的拟人化思考过程（个人对当日的主观安排，并不一定完全按照该安排执行），请从客观视角出发，结合当日日程、思考过程及客观合理性原则，对全天事件进行调整、补充与优化，使其更符合真实生活逻辑且内容丰富充实。需确保今日计划中的所有事件都能安排执行，可灵活调整执行方式（如调整时间、改变执行形式等），但必须在本日达到执行后的效果。你可合理新增活动、事件、地点与场景（包括非日常事件），并以客观叙事视角呈现，具体要求如下：

一、内容生成核心要求
1. **时段填充与事件丰富**：
   - 明确所有事件的发生时段，填补空白时段，避免内容空洞，确保全天各时段均有合理事件分布。
   - 针对未分配事件的空白时段，需结合全天事件逻辑，补充丰富多样（行为、活动、地点、人物等维度）且连贯的事件（如社交、娱乐、家庭、工作等方面），确保与其他事件及当日特征逻辑一致，并**与前几日事件存在明显差异**。
   - 对于“单事件长时间但内容单薄”的时段（如"14:00-15:00 休息"），需新增关联场景或活动进行填充，提升内容饱满度。

2. **日常模式补充**：
    - 个人主观思考通常不会提及常态化活动模式（如每日工作、固定家庭事务、习惯等），请分析其日常应具备的行为模式，补充调整相关事件，使其符合真实生活规律（例如：工作日9:00-17:00的工作时段、每日接送孩子等固定安排）。
    - 以客观视角审视安排的合理性，无需完全采纳思考过程中的建议，可在其基础上进行调整、补充或修改，但需确保参考数据中的今日事件内容得到执行，可灵活调整执行方式但必须在本日达到执行后的效果。

3. **交通轨迹与移动逻辑优化**：
   - 明确事件间的地点转变细节，包括具体地点信息（需精确到某市某区某街道某建筑/楼宇）、通勤方式及通勤耗时。
   - 确保移动路线符合现实生活中的交通逻辑与时间合理性。

4. **事件多样性与合理性提升**：
    - 分析历史记忆中的事件模式，新增事件应尽量避免同质化（例如：若每日均跑步，可设计某一天因特殊原因调整；若常去同一家餐厅，可安排换店尝试），同时保持与历史事件的连贯性。
    - 允许灵活调整现有事件的执行方式（如调整时间、线上线下转换、他人代办等），但必须确保所有事件都能在本日完成并达到执行效果。
   - 同一类型事件需体现形式多样性，具体可从以下三方面拓展：
     - **事务内容**：将笼统描述拆解为具体行为（如"处理工作"细化为"撰写项目周报、对接客户需求"）；
     - **地点与形式**：饮食类可拓展火锅、日料、烤肉等多元选择，娱乐类可增加网吧、KTV、电玩城、livehouse等场景；
     - **活动形式**：新增博物馆参观、城市公园骑行、独立咖啡店办公、市集打卡等场景，灵活调整思考过程中的执行形式。

5. **衔接逻辑强化**：
   - 事件间需体现清晰的"顺承关系"，地点转换需符合日常活动轨迹与交通合理性（例如："家→小区门口便利店买早餐→地铁通勤至公司""公司→楼下商场快餐店午餐→回公司午休"），避免无逻辑的空间跳跃。
   - 示例："在家吃完煎蛋吐司早餐后，拿上通勤包和折叠伞出门→步行5分钟至地铁站乘坐3号线→抵达公司后先开电脑整理昨日会议纪要"

6. **事件描述细化**：
   - 所有事件需清晰呈现"核心过程+具体场景"，描述需充实丰富，包含时段主题相关的细节信息。
   - 示例："19:00-20:00 预定周末机票（过程：打开旅行APP对比不同航班的起降时间与价格，选择靠窗座位并完成支付，同时浏览目的地美食攻略，收藏3家评分较高的本地菜馆）"
   - 若描述涉及未来事件，请注意时间指定的准确性，尽量避免明确提及未来事件的具体发生时间导致事件不对应的错误。

7. **生活连贯性增强**：
   - 思考过程多体现主观意愿，描述事件时可合理融入客观执行过程，增强生活的真实感与连贯性。

8. **未来事件约束**：
   - **新增事件不得包含具有重大后续影响的安排**（如计划周末异地出行）。
   - 所有新增的事件、场景与描述必须严格限定在当日发生，不得无中生有地新增未来安排。
   - 若涉及未来相关内容，需参考给定的未来日期安排，不得自行创建未提及的未来事件。

最终需生成符合真实生活逻辑、内容丰富充实的完整一日活动安排，确保今日计划中的所有事件都能得到执行并达到预期效果。

二、输出格式要求
请以表格形式输出全天事件，具体格式为：**时间区间、事件、地点、人物、描述**
- 时间区间拆分需合理，符合日常活动规律；
- 地点信息需详细完整，包含市、区、街道、建筑及具体名称（如未提及，需根据逻辑合理补充）；
- 事件描述需包含所有今日事件的信息与细节，不得遗漏关键内容。

三、参考数据
- 第一步拟人化思考过程：{event}
- 今日事件计划：{plan}（包含未来事件、今日事件及昨日事件，请将未来事件与昨日事件作为分析参考，重点关注今日事件，今日事件包含"今日安排参考"，你可以尽量依据该参考安排，尽量保证一天结束时的状态与参考状态一致，其他可灵活安排调整）
- 记忆信息：{memory}
- 日期信息：{date}（需明确标注为工作日/休息日）
- 个人画像：{persona}
'''



template_daily_event_subjective_plan = '''
# 角色主观视角日常事件规划生成

## 核心任务
请完全代入指定角色，以**第一人称"我"**的视角进行深度思考，综合运用以下信息分析今日事件安排：
- 自我认知（性格特质、行为习惯、个人偏好）
- 记忆数据（过往活动轨迹、重复事件模式、长期生活习惯）
- 当下想法（近期意愿倾向、兴趣关注点）
- 当下状态（早晨醒来地点、当前身体/精神状态）
- 昨日回顾（前一天主要活动、事件影响）
- 今日日期属性（明确区分工作日/休息日）
- 今日初步计划（{plan}，可能稀疏或空白）（包含"今日安排参考"，你可以尽量依据该参考进行安排，尽量保证一天结束时的状态与参考状态一致，其他可灵活安排调整。对于其中的事件序列中的事件，你可以随意在今日调整发生时间、地点、人物、描述等，但一定要安排发生（如早上的航班安排到晚上执行，熬夜/早起完成所有任务等））

最终目标：梳理出符合角色身份的今日活动安排想法，为后续生成完整日程提供基础。需确保今日计划中的所有事件都能安排执行，可灵活调整执行方式（如调整时间、改变执行形式等），不拘泥于给定的执行描述、时间、地点。但必须在本日达到执行后的效果。若今日无规划或规划稀疏、不充分、不丰富，需重点思考可新增的合理活动。

## 思考框架
请严格按照以下结构化思考流程进行分析：

1. **当下状态与昨日回顾**
   - 从记忆中提取关键信息，明确早晨醒来时的具体地点（如家中卧室、出差酒店等）
   - 分析当前的身体状态（如精力充沛、疲惫、身体不适等）和精神状态（如心情愉悦、焦虑、平静等）
   - 回顾前一天的主要活动和事件，特别是对今日可能产生影响的重要事件
   - 思考昨日活动对今日状态的影响（如熬夜导致今日疲惫、完成重要任务带来的轻松感等）

2. **睡眠时间与习惯调整**
   - 根据昨日睡眠情况和今日状态，规划合理的起床时间和就寝时间
   - 分析日常习惯（如晨练、早餐、阅读等）的执行情况，考虑是否需要根据当前状态调整
   - 思考环境因素（如天气、季节变化）对今日习惯执行的影响
   - 评估是否需要尝试新的习惯或调整现有习惯以提升今日状态

3. **计划执行细节分析**
   - 逐一审视今日已有计划，结合自我认知补充具体执行细节，确保所有事件都能安排执行
   - 思考：执行该事件时通常选择的地点？今日是否尝试新地点？
   - 思考：过往执行该事件的典型方式？今日是否需要调整执行方式（如时间调整、线上线下转换等）以确保事件完成？
   - 思考：今日如何灵活安排执行这些事件，确保符合角色的日常习惯和时间安排，同时保证所有事件都能在本日完成。
   - 为每个事件添加符合角色特征的真实、丰富细节，重点关注如何调整执行方式以确保事件完成

4. **日期属性适配**
   - 明确今日是工作日还是休息日
   - 匹配角色的固定模式（如工作日的通勤时间、定时任务等）
   - 遵循角色在不同日期类型下的典型作息规律

5. **记忆与画像一致性校验**
   - 对比个人画像，确保活动符合角色长期设定
   - 分析近期记忆，避免与之前事件产生冲突、重复或违和感
   - 基于记忆调整今日事件，确保活动的连贯性和合理性

6. **活动丰富策略**
    可以考虑在空闲的情况下/压力大的情况下新增活动（如周末聚餐、娱乐，社交等各类活动）
   - **活动新增策略**：
     - 若事件数量不足：根据当前时间点和角色习惯，补充符合情境的活动
     - 若时间覆盖不完整：在空白时间段填充适合的活动（如：午休时间可安排短暂散步、下午茶；晚饭后可安排阅读、运动等）
     - 若活动类型单一：增加不同类型的活动以丰富日程（如：工作之余安排健身、社交或兴趣娱乐活动）
     - 若场景过于局限：添加需要外出或更换环境的活动，增加生活的动态感
     - 不用为了丰富日程而添加无意义的活动，可根据个人当日的状态，兴趣，情绪，忙碌情况分析，合理新增活动
   - **具体新增建议**：
     - 结合当下需求与潜在意愿新增事件，平衡实用性与兴趣探索
     - 确保活动多样性：覆盖社交、爱好、娱乐、工作、生活等多场景
     - 避免近一周内的活动重复，替换同质化安排，平衡习惯的重复与新尝试
     - 适当考虑尝试新事件、新娱乐或新爱好，增加生活的新鲜感
     - 可结合居住地热门景点或场所设计探索性活动
     - 根据个人画像中的社交关系，合理安排与他人互动，邀请朋友/家人参与活动，保持与他人的联系和互动

   
7. **动态变化与随机性考量**
   - 思考事件可能的变化发展，避免日程过于机械
   - 适当融入生活的随机性，使安排更符合真实生活逻辑

## 输出要求
请按照以下清晰结构输出内容：

1. **拟人化思考过程**（一段流畅的文字）
   - 采用第一人称"我"的视角
   - 体现角色的思维方式和性格特点
   - 展示上述思考框架中的关键分析逻辑，特别是当下状态和昨日回顾、睡眠时间与习惯调整的分析

2. **今日活动安排意向**（简洁列表或段落）
   - 仅输出计划进行的活动类型，和大致时间安排
   - 根据已有计划密度合理新增活动，保持适度丰富性
   - 体现活动之间的逻辑关联

3. **今日生活轨迹预测**（按顺序排列）
   - 列出今日可能涉及的地点顺序
   - 格式示例：家->工作地点->咖啡馆->超市->家->公园->家

## 参考数据
自我认知：{cognition}
记忆信息：{memory}
当下想法：{thought}
日期信息：{date}（需明确标注工作日/休息日）
个人画像：{persona}
'''


template_event_update = '''
# 事件修改操作生成

## 核心任务
请基于之前完成的事件优化调度分析结果，生成具体的事件修改操作和每日生活总结。你需要：
1. 从分析结果中提取事件调整结论，生成精准的事件修改操作列表
2. 总结出这段时间内个人每天的大致生活安排，确保生活轨迹连贯、自然、真实

## 输入数据
请严格基于以下分析结果进行操作：
{result}

## 操作规则
1. **事件调整操作提取**：参考<event adjust>
   - 只能修改事件的发生日期，不能删除任何事件
   - 所有修改必须符合真实生活逻辑和时空合理性

2. **每日生活总结要求**：参考<daily adjust>
   - 记录每日生活的大致安排和轨迹
   - 描述每日开始和结束时的状态：
     * 身体状态（如精力充沛、疲惫、健康状况等）
     * 精神状态（如心情愉悦、焦虑、平静等）
     * 所处地点（如家中、工作场所、外出地点等）
   - 确保多日生活轨迹连贯，避免出现时空跳跃或逻辑矛盾

## 输出格式要求
1. 仅输出纯JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记
2. 输出必须包含以下字段：
   - `event_update`：事件修改操作列表（若无需调整任何事件，输出空数组[]）
     * 每个操作包含`event_id`（与原始事件ID严格一致）和`new_date`（格式：YYYY-MM-DD）
   - `dailylife`：每日生活总结数组，每个元素对应一天的生活描述
     * 每个总结包含`date`（格式：YYYY-MM-DD）、`schedule`（当日大致安排）、`start_status`（当日开始状态）、`end_status`（当日结束状态）

## 输出示例
{{
  "event_update": [
    {{"event_id": "1-1", "new_date": "2025-01-20"}},
    {{"event_id": "1-2", "new_date": "2025-01-21"}}
  ],
  "dailylife": [
    {{
      "date": "2025-01-20",
      "schedule": "早晨在家吃早餐，上午前往公司工作，下午参加项目会议，晚上回家休息",
      "start_status": {{"location": "家中", "physical_state": "精力充沛", "mental_state": "心情愉悦"}},
      "end_status": {{"location": "家中", "physical_state": "略有疲惫", "mental_state": "平静放松"}}
    }},
    {{
      "date": "2025-01-21",
      "schedule": "早晨在家工作，中午外出午餐，下午前往客户处洽谈，晚上与朋友聚餐",
      "start_status": {{"location": "家中", "physical_state": "精力一般", "mental_state": "专注"}},
      "end_status": {{"location": "家中", "physical_state": "疲惫", "mental_state": "满足"}}
    }}
  ]
}}

## 特殊情况处理
若无需调整任何事件，"event_update"为空数组[]，但仍需总结每一日的生活。
'''

template_biweekly_event_schedule_analysis = '''
请基于未来日期的规划事件数据，执行事件优化调度分析。通过智能调整事件的发生日期，使整体事件安排更加合理、真实且符合逻辑。**不可以删除任何事件**，请严格遵循以下优先级与约束条件：

一、核心分析维度
1. 合理性校验
   - 分析每日事件密度是否适中，重点排查时空冲突（如：同一天内需前往不同地点的事件安排冲突、高耗时事件过于集中等）
   - 从客观视角评估人物时空轨迹的合理性，确保事件安排符合真实世界的时空流动逻辑

2. 事件优先级排序
   - 优先保留符合日期特征的重要事件：工作日以工作事件为主，休息日侧重非工作事务，节假日优先匹配节日属性事件
   - 兼顾灵活性：工作日晚上等非工作时段可合理安排轻量非工作事件，休息日也可适当处理紧急工作事务

3. 时间成本区分
   - 轻量事件（随手可完成、事件间隙可处理）：无需调整
   - 重量级事件（需专门耗时、耗精力或前往特定地点）：重点评估时空可行性并优先优化

4. 时空连贯性要求
   - 明确标注每日人物所处地点及大致日程安排
   - 确保前后日程逻辑通畅、衔接自然，避免出现跨日地点突变的不合理情况
   - 逐天分析个人时空轨迹和事件安排，保障单日行动合理、多日时空变化连贯
   - 确保同一主题事件的发送前后顺序合理，避免出现逻辑矛盾或冲突

5.事件精力分析
   - 分析每个事件的耗时和精力消耗，有些事无需花费精力，可随手完成，无需调整时间。如（网上购物，订票，预约会议等），有些事难以单日完成或时空冲突，则要调整。
   - 识别事件中可能存在的耗时瓶颈，考虑是否需要调整事件时间或调整人物活动路线，对于简单事件，可以单日完成，单日可以出现加班晚睡等情况来安排更多事件。
   - 遵循最小改动原则，仅调整必要事件时间，避免过度调整或删除事件。



二、输出要求
1. 首先输出原事件分析结果，使用 `<daily analysis>` 标签包裹，展示原始事件安排的状态,主要分析人物时空轨迹的合理性，事件的冲突矛盾，天与天直接的逻辑连贯。
2. 然后输出更新后的每日轨迹，使用 `<daily adjust>` 标签包裹，展示调整后的优化方案，不仅保证单日个人生活时空逻辑合理，也要保证天与天直接时空连贯，你要分析一些事件可能会对近期其他天发生一些影响。只能调整原事件的时间安排来避免冲突.合理安排每一天要做的事,日期调整尽量在给定范围内.
3. 最后输出具体的更新操作，使用 `<event adjust>` 标签包裹，说明每个事件的调整原因和具体内容，你可以调整事件发生的日期，形式，内容，甚至删除事件。需要思考事件背景信息中提供的事件相关联前后续兄弟事件的执行是否收到影响，考虑事件关联，是否会导致事件的整体不合理。你也可以给出对不在时间范围内的相关事件的更改建议和背景事件、整体事件的更改建议。**你不可以删除任何事件，你只能通过修改事件发送日期来调整事件使其合理。**
4. 输出格式示例：

<daily analysis>
2025-01-20:人物处于地点A，主要轨迹包括从家→公司→餐厅→公司，主要事件包括工作会议(9:00-11:00)、项目截止日期(18:00前)、个人项目启动(19:00-21:00)
2025-01-21:人物处于地点A，主要轨迹包括从家→医院→健身房→家，主要事件包括项目收尾工作(无具体时间)、脚踝扭伤(原因不明)、健身锻炼(16:00-17:30)
2025-01-22:人物处于地点B，主要轨迹包括从家→机场→雪山景区，主要事件包括游览雪山(全天)
</daily analysis>
<daily adjust>
2025-01-20:人物处于地点A，主要轨迹包括从家→公司→餐厅→公司→家，主要事件包括工作会议(9:00-11:00)、项目截止日期(18:00前)、个人项目启动(延期)
2025-01-21:人物处于地点A，主要轨迹包括从家→公司→家，主要事件包括项目收尾工作(9:00-12:00)、脚踝扭伤(居家休养)、健身锻炼(延期)
2025-01-23:人物处于地点B，主要轨迹包括从家→机场→雪山景区，主要事件包括游览雪山(全天)
</daily adjust>
<event adjust>
event_id:1,adjust:将个人项目启动从2025-01-20延期至2025-01-22。原因为当日已有工作会议和项目截止任务，事件密度过高，个人精力不足

event_id:2,adjust:将健身锻炼从2025-01-21延期到2025-01-25。原因为当日发生脚踝扭伤，不适合进行健身活动，需优先休养

event_id:3,adjust:将游览雪山从2025-01-22调整至2025-01-23。原因为2025-01-22需进行个人项目启动，且考虑到脚踝扭伤需要一天恢复时间
</event adjust>

参考数据:
**人物画像信息:{persona}**
**待分析事件列表:{events}**
**分析日期范围:{date_range}**
**事件背景信息:{event_background}**
'''

template_event_traffic_adjust = '''
基于原事件安排和高德地图搜索结果参考，为该日事件分配真实地址和通行时间，确保个人移动轨迹符合真实时间逻辑。具体要求如下：
一、事件调整核心要求
1. 事件合理性校验：首先判断所有事件是否存在不合理之处，包括但不限于与历史事实、当前客观情况、人物身份及行为逻辑的冲突，时空逻辑的冲突，若存在冲突需进行修正；其次排查是否包含指向未来的事件描述（如“与XX讨论明天的聚会”“规划后天的行程”等未发生的安排），此类内容需全部删除。之后可合理修改事件描述和时间使其符合真实情况。
2. 事件执行保障：**尽量遵循原事件安排**，仅丰富细节、调整时间和分配真实地址，原安排事件尽量保留并执行，除非出现严重冲突，不得删除任何原安排。可灵活调整执行方式（如上午航班改晚上、线下买票改线上等），无需严格按照给定的执行事件和描述，但需在当日达到执行效果（如某事件会产生抵达另一个城市的效果，那你必须安排上，否则会和之后的事件冲突）。
3. 当日事件参考处理：对于当日事件参考中的事件不要删除要保证全部完成了执行，可灵活调整事件及执行方式、执行时间，但必须确保所有事件在当日完成。**所有事件的调整仅允许在本日范围内进行，不能调整到其他日期，必须确保所有当日事件参考中的事件在本日发生。**
4. 高德地图搜索结果参考与处理规则：
   - 高德地图搜索结果参考是根据当日事件原安排数据搜索生成的，用于辅助安排地点、通行方式和时间。**搜索结果可能不全面**（例如原安排有前往学校事件但未搜索到），这不代表要删除原安排事件，而是需要你自行确定该事件的通行时间、方式和详细地点。
   - 处理策略：
     1. 若搜索结果中的地点不合理：可修改地点，并自行分析合理的通行方式和时间
     2. 若搜索结果中的交通方式不合理：可修改交通方式，并根据新的交通方式推断合理的通行时间
     3. 若搜索结果中的地点和交通方式都不合理：可同时修改地点和交通方式，并自行推断合理的通行时间
     4. 对于未搜索到的原安排事件：请自行确定合理的详细地点、通行方式和时间
   - **注意：高德地图搜索结果仅作为参考，不得因为搜索结果不全面或不合理的原因删除任何原安排事件或当日事件参考中的事件，请严格遵循原事件安排。**
   - 通勤细节明确：结合搜索结果和自行推断，明确通勤过程，包括具体通勤时间（精确到分钟）、通行方式（如地铁、公交、自驾、步行等），使个人一天生活的地点和通行时间真实合理
   - 若没有参考数据则请自行推断合理的地点和通勤时间
5. 地点转变清晰：明确各事件间的地点转变逻辑，确保地点切换与时间顺序、通勤方式匹配，避免出现空间跳跃不合理的情况。
6. 对事件的安排进行合理的调整，**但核心是分配真实地址和通行时间和执行方式，而非删除事件，允许新增事件**。
7. 最后对生成的全天事件进行检查，确保事件安排和描述合理、真实，优先保证个人一天生活安排的真实合理高质量性，**同时确保所有原安排事件都得到保留和执行**。
8. 丰富事件描述和一天事件安排，使内容更加生动和真实。
二、输出格式要求
1）输出全天事件，按 “时间区间、事件、地点、人物、描述” 的格式呈现，时间区间拆分合理，**地点为详细地点，包含市、区、街道、建筑、详细名称。**若之前没用提及请你进行合理补充地点信息使其完整。
三、参考数据：
高德地图搜索结果参考：{poi}
该日事件原安排：{event}
当日事件参考：{daily_event_reference}（包含"今日安排参考"，你可以尽量考虑依据该参考进行安排，尽量保证一天结束时的状态与参考状态一致，其他可灵活安排调整）
前一日记忆:{history}（作为记忆保障连贯）
个人画像{persona}
'''








template_event_format_sequence = '''
请基于「此前生成的全天事件列表」，提取并生成新的格式化事件序列，具体要求如下：
1）事件提取规则：从 “时间区间 + 描述” 中对事件描述和标题进行优化调整，组织描述，需完整覆盖所有信息，能反映全天生活状态；
2）最终输出事件个数不超过18个。当事件比较多，18个展现不完所有信息时，可合理合并事件，优先根据就近时间合并，然后根据同地点合并，使其少180个，优先保证信息全面覆盖，对于合并事件的描述字段可以多一些，对于重要事件的描述不要省略，防止信息遗漏。
**今日日期{date}**
---
输出格式严格要求,type字段为Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other之一。description字段为对事件的描述。participant字段为参与者姓名和关系。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物。location字段描述出发生的详细地址，参考poi数据来描述。date以XX-XX-XX XX:XX:XX至XX-XX-XX XX:XX:XX的形式给出（如2025-01-01 08:45:00至2025-01-01 09:45:00）,由于其可能多次发生，以数组的形式展现，发生一次则为["XX-XX-XX XX:XX:XX至XX-XX-XX XX:XX:XX"]。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，输出后请检查json格式是否没问题，符号对应是否没缺失。格式示例如下：

      [
        {{
          "event_id":"1"
          "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00"]
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},{{"name":"","relation":""}}]
          "location":"详细地址",
          ]
        }},

      ]
------
此前生成的全天事件列表：{content}
位置参考数据{poi}
'''


template_daily_reflection = '''
请以「我」的第一视角展开叙述，先完整梳理并代入今日发生的所有事件（可按时间顺序或重要程度呈现关键场景），再结合以下维度自然融合表达，无需刻意罗列：
- 核心感受：基于今日经历产生的真实情绪（如充实、疲惫、治愈、遗憾等），可结合具体事件说明情绪触发点；
- 自我洞察：关联自我认知、过往记忆（如某件事让你想起过去的经历）、近期规划，分析今日事件对自身状态的影响（包括洞察出康复、事件完成等结束状态，防止之后没有察觉继续执行）；
- 事件记忆：今日事件的描述中有提到什么后续事件吗（如预约了明天的某某服务，准备周末联系某某等），记录下这些事件。同时思考是否有记忆相关内容已达到预定日期，需从想法里删除。
- 想法反思：指对今日及近期相关事件的思考与感悟，可包含但不限于以下参考方向（无需全部考虑，根据实际感受选择）：回忆1-2件印象最深刻的事并简要评论，或反思今日待改进之处；总结近期活动规律（如“很久没和朋友聚餐，这周外卖有点频繁”）；基于近期持续行为提出结果和发展（如“最近坚持每天跑步30分钟，应该瘦了2斤左右”）；提出未在今日规划中出现的尝试方向（如“下周可以去家附近新开的书店看看”），或提炼今日获得的小经验；对长期进行的事项给出判断等。注意凡是与未来有关的想法，必须明确其发生日期，如2025-XX-XX。最终按以下格式输出
{{
            "date": "XX-XX-XX",(格式为XX-XX-XX，如2025-01-01，请依据今日日期填写)
            "topic": "（描述今天活动的主要主题有哪些，将作为衡量不同天相似度的依据）",
            "events": "即今日事件的所有内容的总结,请组织为一段话，同时明确发生日期,注意，你要清楚全面地描述今天的所有事件。对每个事件可以去除一些不重要的细节信息，保留事件的主要过程和重要信息即可。对于不重要事件可简短描述。",
            "thought": "你对今日事件体验后的感受和想法，一段话描述。"
}}
今日事件:{content}
自我认知:{cognition}
记忆:{memory}
近期规划:{plan}
今日日期:{date}

输出格式严格要求,仅输出JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段.
'''

template_get_poi = '''
请基于个体当日生活事件和轨迹信息及过往画像信息，按以下规则输出今日移动轨迹，确保信息精准、符合地图搜索逻辑：
POI 数组要求：
内容需为当日实际移动涉及的地点，不得包含笼统概念，需能在地图 APP 中搜索定位（如 “上海市浦东新区八佰伴商场”“北京市朝阳区 XX 路 XX 号（住址）”）；
地址精度：**优先提取画像中明确的详细门牌号（如住址、工作地需精确到 “XX 路 XX 号”）**，无门牌号时填写具体地点名称 + 类型（如 “杭州市西湖区银泰商场”“深圳市南山区火锅店”），模糊类别需前置所属城市行政区；若原文本的地址没有具体到XX路XX号，则进行POI类型的合理性分析，对原文本中不合理的 POI类型（如 “家族宴会厅”）进行重写，替换为地图可搜的具体地点（如 “XX 市 XX 区 XX 大酒店”）；粒度仅细化到建筑层级或POI类别，无需标注建筑内具体区域（如 “XX 路 XX 号（家）” 即可，无需写 “家中客厅”）。
输出要求：
**仅输出JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段。transport数组第i个元素代表从第i个poi到第i+1个poi的交通方式，所以其数组长度应比poi数组长度小1。**格式示例如下：
{{
"poi":[],（对于连续在同一个位置的可合并）
"city":[],（poi对应城市）
"transport":[]（地点间的交通方式,只允许"driving", "walking", "transit","bicycling"（即驾车，步行，公共交通，骑行）四种）(**注意：第i个元素代表从第i个poi到第i+1个poi的交通方式，数组长度应比poi数组长度小1**)
}}

参考数据：
当日生活事件{data}
画像：{persona}

'''

template_poi_search_optimize = '''
请基于原始基础数据、第一轮搜索指令及 API 反馈结果，对地址搜索指令与通行方式进行全量迭代优化，核心目标是彻底解决 API 搜索失败问题、修正不合理地点配置与通行逻辑，确保生活事件数据的真实性、可执行性与逻辑连贯性。最终严格按照指定格式输出优化后的搜索指令、城市列表及通行方式数组，用于二次 API 调用，指令内容与格式描述无任何省略：
一、核心输入信息（需完整参考）
原始基础数据：合成的当日生活事件 （含事件时间、主题）、个人画像 （含住址、工作地、出行偏好、常住城市等）；
第一轮搜索指令：（含所有类型 1/2/3 指令）；
API 反馈结果:
成功获取的 POI 信息：含每个指令对应的 POI 名称、详细地址、经纬度（若搜索成功）；
POI 间通行信息：含每两个连续指令对应的路段（起点→终点）、交通方式、实际通行时长；
搜索失败详情：含失败指令的完整信息（类型、关键词、城市等）、错误原因。
二、关键优化逻辑（全量覆盖，无遗漏）
1. 搜索失败指令处理（优先解决，确保可搜）
针对 API 反馈 “POI 搜索失败” 的指令，按以下规则重新生成，字段格式严格遵循类型要求：
1）可能该区域无该地址，可以考虑换为同样类型的地址。
2）关键词优化：若原关键词过于具体难以匹配，可替换为 “城市 + 行政区 + POI 大类”或 “城市 + 行政区 + 街道 + POI 大类”，扩大搜索范围；
3）若原指令为类型 3（附近 POI 搜索）：将过于小众、地图低频次的 poiType 替换为高频通用类型（例：“小众手作咖啡馆” 改为 “咖啡”）；Keyword 同步优化；
4）若原指令为类型 1（提取画像地址）：若 API 反馈无有效 Location，检查画像地址是否完整（是否含 “XX 路 XX 号”），若不完整，升级为类型 2 搜索（关键词：“城市 + 行政区 + 画像地址名称 + POI 类型”，例：“上海市浦东新区 张杨路 写字楼”）。
2. 不合理地点配置修正（基于 API 成功 POI 信息）
结合 API 成功返回的 POI 名称、地址、经纬度，逐一校验并修正以下问题：
场景匹配矛盾：检查 POI 类型与对应事件主题是否一致（例：“午餐” 事件对应 “金茂大厦 88 层观光厅” 不合理，需替换为 “上海市浦东新区世纪大道附近 中式餐厅”），若矛盾，重新生成同城市、同行政区（或邻近）的适配类型搜索指令；
跨城 / 远距离矛盾：若事件无跨城需求，但 POI 分布在不同城市，需统一为个人画像中的常住城市（例：画像常住上海，删除非上海的 POI，重新生成上海本地适配地址）。
通行时长矛盾，难以通过修改通行方式缩短时长，则考虑更换地点（比如更近的同类地点）。
搜索错误矛盾：搜索的POI不是目标的地址，或过于粗糙。
3. 通行方式与时长优化（核心校验，符合真实逻辑）
基于 API 返回的 “实际通行时长”，结合地址间距、事件时间间隔、个人画像偏好，修正所有不合理配置，规则如下：
通行时长与交通方式匹配校验（严格执行）：
walking（步行）：仅适用于单程时长不长或距离不远或运动的场景，若 API 反馈时长＞20 分钟（或距离＞1.5 公里），需考虑调整为 bicycling（骑行）或 transit（公共交通）或driving（驾车）（例：“张杨路→金茂大厦 88 层观光厅” 步行 59.2 分钟，改为 transit/driving）；
bicycling（骑行）：仅适用于单程时长一般或运动的场景，时长＞25 分钟则考虑调整为 transit/driving，时长＜8 分钟且距离＜1 公里则考虑调整为 walking；
transit（公共交通）：适用于单程时长较长（>15分钟）或距离较远的场景，跨行政区、长距离优先选择，时长＞45 分钟且无地铁覆盖则考虑调整为 driving；
driving（驾车）：适用于单程时长 5 分钟以上以及各类距离的场景，时长＜5 分钟（或距离＜2 公里）且无时间紧张事件支撑（如 “赶会议”），可考虑调整为 walking 或 bicycling（例：“上海书城 (福州路店)→宏伊国际广场 (南京东路)” 驾车 4.7 分钟，改为 walking）；
事件时间间隔适配：修正后的 “通行时长 + 事件耗时” 需≤对应事件的时间间隔（例：1 小时午餐事件，往返通行时长≤40 分钟，预留 20 分钟用餐时间；2 小时观光事件，单程通行时长≤30 分钟，预留 1 小时观光时间）；
个人画像偏好匹配：确保通行方式与画像一致（如画像显示 “无驾车习惯”，则所有长距离场景均选择 transit，禁止 driving；画像显示 “偏好步行”，则 1 公里内优先 walking）；
三、地址分配与搜索指令规则（全量详细，格式无偏差）
地址核心要求：
真实性：所有优化后的地址必须是真实存在、可在地图 APP 中搜索定位的地点，优先复用 API 成功返回的有效 POI（直接使用其详细地址）；
精度要求：需精确到 “XX 路 XX 号 + POI 名称”（例：“上海市黄浦区福州路 465 号上海书城”），无门牌号时需补充 “城市 + 行政区 + 街道 + 具体 POI 名称”（例：“上海市浦东新区张江高科技园区 星巴克咖啡”），禁止模糊地址（如 “上海市黄浦区 餐厅”）；
场景适配：地址类型与事件主题严格匹配（例：“上班”→写字楼 / 产业园区，“午餐”→餐厅 / 快餐店，“健身”→健身房 / 运动场馆，“购物”→商场 / 超市）。
搜索指令类型及格式（严格固定，无任何字段省略）：
类型 1（提取画像地址）：适用于画像中存在真实详细地址且 API 搜索成功的场景，格式：
{{"type":"1","location":"省 / 市 / 区 / 街道 / 门牌号 + 用途（例：“上海市浦东新区张杨路 501 号八佰伴商场（购物）”）","city":"目标城市（例：“上海市”）"}}
类型 2（直接 POI 搜索）：适用于画像无适配地址或原指令搜索失败的场景，对于你认为可以保留的从API反馈中获取的正确的合理的真实POI地址及其名称(包括名称附加信息)，可写在keyword里保留。格式：
{{"type":"2","keyword":"城市 + 行政区 + 街道（如有）+POI 类型 / 事件主题（例：“上海市黄浦区南京东路 汤包店”“上海市浦东新区张江 健身房”）","city":"目标城市（例：“上海市”）"}}
类型 3（附近 POI 搜索）：适用于事件与基础地址绑定、需控制通行时间的场景，格式：
{{"type":"3","baseKeyword":"基础地址（需为有效详细地址，例：“上海市浦东新区世纪大道 88 号金茂大厦”）","poiType":"POI 类型（例：“中式快餐”“咖啡馆”）","city":"目标城市（例：“上海市”）","Keyword":"基础地址附近 + POI 类型（例：“上海市浦东新区世纪大道附近 中式快餐”）"}}
指令顺序要求：按当日生活事件的时间线与移动顺序排列（如 “家→公司→餐厅→公司→健身房→家”），确保与后续 transport 数组的索引严格对应（第 i 个指令对应第 i 个地点）。
四、通行方式规划规则（全量详细，无模糊表述）
交通方式限定：仅允许选择以下四种类型，无其他可选值：
driving：驾车（适用于中长途、跨区域、时间紧张或画像显示有车 / 偏好驾车的场景）；
walking：步行（适用于短距离、时间充裕的短途场景）；
transit：公共交通（适用于中距离、画像依赖公交 / 地铁或无驾车习惯的场景，含地铁、公交）；
bicycling：骑行（适用于短 - 中距离、路况适宜的场景）。

五、输出要求（严格固定格式，无任何额外内容）
输出内容：仅包含三个核心字段，无其他冗余字段：
"instruction"：优化后的地址搜索指令数组，按移动顺序排列，每个指令字段完整、格式正确（类型 1/2/3 严格对应上述格式）；
"city"：所有地址对应的真实城市数组，按字符串数组格式呈现（例：["上海市"]），若有跨城事件需包含所有涉及城市（例：["上海市","苏州市"]）；
"transport"：通行方式数组，第 i 个元素对应 “第 i 个指令的地点→第 i+1 个指令的地点” 的交通方式，仅允许上述四种类型，数组长度 = instruction 数组长度 - 1；
格式要求：直接以 {{}} 作为开头结尾，输出纯 JSON 内容，不添加任何额外文本、注释、代码块标记（如 ```json、// 说明文字等），确保可直接复制用于二次 API 调用；
容错要求：优化后的指令需确保无搜索失败风险，通行方式无逻辑矛盾，地址无模糊表述。
六、优化示例（基于提供的 API 反馈，全量还原优化逻辑）
只输出json，不要包含其他无关字段，以{{}}作为开头和结尾。
优化后输出 JSON 示例：
{{"instruction": [{{"type":"1","location":"上海市浦东新区张杨路 501 号（住址）","city":"上海市"}},{{"type":"1","location":"上海市浦东新区世纪大道 88 号金茂大厦 88 层观光厅（观光）","city":"上海市"}},{{"type":"2","keyword":"上海市黄浦区南京东路 中式快餐店","city":"上海市"}},{{"type":"1","location":"上海市黄浦区福州路 465 号上海书城（购书）","city":"上海市"}},{{"type":"1","location":"上海市黄浦区南京路步行街 299 号宏伊国际广场（逛街）","city":"上海市"}},{{"type":"1","location":"上海市浦东新区新金桥路 738 号迪卡侬 (啦啦宝嘟店)（健身）","city":"上海市"}},{{"type":"1","location":"上海市浦东新区张杨路 501 号（住址）","city":"上海市"}}],"city": ["上海市","上海市","上海市","上海市","上海市","上海市","上海市"],"transport": ["transit", "transit", "walking", "walking", "transit", "driving"]}}
参考数据：
第一轮搜索指令：{first_round_instruction}
API 反馈结果：{api_feedback}
当日生活事件：{data}
个人画像:{persona}

'''

template_poi_real_location_assign = '''
请基于合成的当日生活事件（非真实）及个人画像信息，为事件分配真实可搜的地址与合理通行方式，核心目标是提升生活事件数据的真实性与逻辑连贯性，你将通过对每个地址给出指令用于后续api查询的方式来分配地址。具体要求如下：
一、地址分配与搜索指令规则
地址全面提取:
请仔细分析当日生活事件，全面提取该个体的今日所有位置移动轨迹，为每一个不同的位置分配真实地理位置并明确其之间的真实通行时间和方式。
地址真实性要求：
所有分配的地址需为真实存在、可在地图 APP 中搜索定位的地点（示例：“上海市浦东新区张杨路 501 号八佰伴商场”“广州市天河区珠江新城冼村路 2 号（工作地）”），禁止虚构不存在的地址或笼统概念（如 “ downtown 餐厅”“郊区公园”）；
优先复用个人画像中明确的真实地址（如住址、工作地，需精确到 “XX 路 XX 号”），无画像地址时，按 “城市行政区 + 具体 POI 类型 + 真实名称” 生成（例：“杭州市西湖区湖滨银泰商场”“深圳市南山区科技园火锅店”）；
对合成事件中不合理 / 不可搜的地点描述（如 “未来科技馆”“家族聚会厅”），替换为同城市真实存在的相似类型 POI（例：“北京市朝阳区中国科学技术馆”“苏州市姑苏区平江路 XX 大酒店”）。
场景适配原则：
地址类型需与合成事件场景严格匹配（例：“上班” 事件匹配写字楼 / 产业园区，“午餐” 事件匹配周边真实餐厅，“健身” 事件匹配连锁健身房）；
无需完全拘泥于合成事件的原始描述，可围绕事件主题结合个人画像（如常住地、出行范围、消费偏好）调整地址，确保符合真实生活轨迹逻辑（例：合成事件 “跨城购物” 但画像显示无驾车习惯，可调整为同城核心商圈购物）。
搜索指令类型：
类型 1（提取画像地址）：直接复用画像中真实详细地址，格式：{{"type":"1","location":"省 / 市 / 区 / 街道 / 门牌号 + 用途（例：“成都市武侯区玉林路 100 号（住址）”）","city":"城市"}}
类型 2（直接 POI 搜索）：画像无适配地址时，设计搜索关键词进行搜索。关键词设计方法1）按 “城市 + 行政区 + 街道（如果有）+ 门牌号（如果有）+ 事件主题/POI 类型/具体名称” 生成关键词 2）优先采用格式1，若没强制指定，也不好推理具体位置，则可模糊描述，如XX区XX街道（尽可能具体的地址）附近的XX（事件主题/POI 类型）。格式：{{"type":"2","keyword":"地图搜索关键词（例：“南京市雨花台区 亲子游乐 主题公园”）","city":"目标城市"}}
类型 3（附近 POI 搜索）：当事件发生与其他场景绑定，或只是发生在某地附近的小事件，或不希望消耗过多时间通行的事件，可基于基础地址（如工作地）搜索周边真实 POI，使其发生在主要poi附近。注意在Keyword字段添加类似于类型2的目标语言描述。在附近搜索失败时将自动调用类型2方式进行搜索。格式：{{"type":"3","baseKeyword":"基础地址（例：“杭州市西湖区西溪路 525 号（工作地）”）","poiType":"周边 POI 类型（例：“中式快餐”）","city":"目标城市"，"Keyword":"同类型2对目标地点进行语言描述"}}
二、通行方式规划规则
交通方式限定：仅允许选择以下四种真实出行方式，需与地址间距、事件时间、画像特征高度适配：
driving（驾车）：适用于中长途（5 公里以上）、跨区域、时间紧张或画像显示有车的场景；
walking（步行）：适用于短距离（1 公里内，单程≤15 分钟），如工作地到周边餐厅、住址到附近超市；
transit（公共交通）：适用于中距离（3-10 公里）、画像显示依赖公交 / 地铁或无驾车习惯的场景；
bicycling（骑行）：适用于短 - 中距离（1-3 公里，单程≤20 分钟）、路况适宜的场景。
合理性校验（核心）：
通行时间需符合真实地理距离 + 交通方式的常规耗时（例：2 公里距离骑行约 10 分钟，驾车约 5 分钟，避免 “1 公里距离驾车 1 小时” 的矛盾）；
契合合成事件的时间间隔（例：1 小时午餐事件，需确保 “工作地→餐厅→工作地” 的往返通行时间 + 用餐时间≤60 分钟，禁止 “单程步行 30 分钟” 导致用餐时间不足的不合理配置）；
匹配个人画像出行偏好（如画像显示 “日常通勤选地铁”，则跨区事件优先选择 transit，而非 driving）。
三、输出要求
仅输出 JSON 格式内容，直接以 {{}} 作为开头结尾，不添加任何额外文本、注释或代码块标记，确保可直接用于数据合成系统解析：
"instruction"：地址搜索指令数组（按上述 3 种类型生成）；包含轨迹涉及到的所有地址，以移动顺序进行组织，后续会根据顺序匹配transport并计算通行时间。
"city"：所有地址对应的真实城市数组（格式：["上海市","杭州市"]）；
"transport"：通行方式数组（第 i 个元素对应第 i 个instruction搜索的地址到第 i+1 个地址的方式，仅允许四种类型，数组长度 = instruction 数组长度 - 1）。
四、输出示例
假设参考数据如下：
输出 JSON 示例：{{"instruction": [{{"type":"1","location":"深圳市南山区科技园科苑路 8 号（工作地）","city":"深圳市"}},{{"type":"3","baseKeyword":"深圳市南山区科技园科苑路 8 号（工作地）","poiType":"清淡快餐餐厅","city":"深圳市","Keyword":"深圳市南山区科技园附近快餐店"}},{{"type":"2","keyword":"深圳市南山区 亲子游乐 儿童乐园","city":"深圳市"}}],"city": ["深圳市","深圳市","深圳市"],"transport": ["walking", "transit"]}}（说明：工作地到周边餐厅步行 5 分钟，符合午餐时间逻辑；餐厅到儿童乐园选择地铁，契合画像出行偏好，通行时间约 20 分钟，整体轨迹真实合理）
参考数据：
当日生活事件：{data}
个人画像：{persona}

'''

# 年度类别事件创作优化模板
template_optimize_year_events = '''
# 核心任务：对{type}类别年度事件总结进行创作优化，**从一年的完整视角**进行审视，生成更真实、合理、多样的年度重要事件和变化记录。

## 任务要求：
1. **事件创作优化**：基于原始事件总结，进行合理的新增、删除、修改操作，确保事件符合人物画像和生活逻辑
2. **一年变化合理性分析**：
   - 从全年视角审视所有事件的时间分布是否合理
   - 分析事件之间的因果关系和逻辑连贯性是否符合真实生活轨迹
   - 确保事件变化的幅度和频率符合人物身份和现实情况
3. **事件多样性与真实性**：
   - 新增事件需符合人物身份、性格和生活轨迹
   - 确保事件类型多样，避免单一重复
   - 所有事件必须基于现实生活逻辑，避免不切实际的情节
4. **仅聚焦两类重要事件**：
   - **画像信息变化事件**：需要更新人物画像具体字段的重大变化事件，包括但不限于：个人工作、生活、身份、特征、爱好、健康、家庭、习惯等
   - **近期生活影响事件**：改变个人近期生活习惯、作息安排的事件
5. **影响的具体性**：
   - 画像信息变化事件：必须明确指出需要更新的具体字段和内容
   - 近期生活影响事件：必须明确时间范围、生活安排变化以及与之前的不同

## 输出格式要求：
**仅输出事件、事件时间、影响、影响的具体内容**，并严格分为两类：

# {type} 类年度重要事件与变化时间线

## 一、画像信息变化事件
1. **[时间节点]** [事件描述]（影响：[具体影响内容]）
2. **[时间节点]** [事件描述]（影响：[具体影响内容]）

...

## 输入数据：
### 人物画像：
{character_profile}

### {type}类别年度总结：
{category_summary}
'''

template_update_impact_events = '''
# 核心任务：根据优化后的年度总结，修改原始的影响事件列表

## 任务要求：
1. **事件修改依据**：严格根据优化后的年度总结内容，对原始影响事件列表进行全面调整
2. **修改内容范围**：
   - 删除：移除不符合优化后总结的事件
   - 新增：添加优化后总结中提到但原始列表中没有的事件
   - 修改：调整现有事件的时间、内容、影响等属性，使其与优化后总结一致

## 具体操作指南：
1. **删除事件**：
   - 移除与优化后总结内容无关的事件
   - 移除时间、内容或影响与优化后总结冲突的事件

2. **新增事件**：
   - 添加优化后总结中提到的所有重要事件
   - 为每个新增事件生成完整的属性，包括时间、内容、影响等
   - 确保新增事件符合人物画像和生活逻辑

3. **修改事件**：
   - 调整事件的时间，使其符合优化后总结的时间线
   - 更新事件的描述，使其与优化后总结一致
   - 修正事件的影响，确保与优化后总结中的描述相符

## 输出格式要求：
输出格式严格要求：
 - type字段必须为Career、Education、Relationships、Family&Living Situation、Personal Life、Finance、Health、Unexpected Events、Other之一。目前初步判断为{t}类事件。
 - date字段为起止时间数组，代表事件可能发生多次
 - description字段为对事件的详细描述
 - participant字段为参与者列表，格式正确
 - location字段描述所处城市和POI类别信息
 - EventBrief字段为事件的简短描述
 - Influence为该事件产生的变化和影响
 - 仅输出JSON格式内容，直接以[]作为开头结尾
 - 不添加任何额外文本、注释或代码块标记
 - 不要输出```json等无关字段
  
 格式示例：
 [
   {{
     "name": "事件名称",
     "date": ["2025-01-01至2025-01-03"],
     "type": "Career",
     "description": "（详细描述）",
     "participant": [{{"name":"张三","relation":"同事"}}],
     "location": "北京海淀区XX科技园区办公楼",
     "EventBrief": "项目启动"，
     "Influence"："这三天我需要加班熬夜。"
   }}
 ]

## 输入数据：
### 人物画像：
{character_profile}

### 原始影响事件列表：
{original_events}

### 优化后的年度总结：
{optimized_summary}
'''