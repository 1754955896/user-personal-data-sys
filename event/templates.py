context = '''
你是一位人类学家，作家，数据分析师。
'''

context2 = '''
你是一位人类学家，数据分析师，规划师。
'''

context3 = '''
你是一位人类学家，心理学家，作家。
'''

template_analyse = """
请基于以下人物画像数据，完成三项核心任务，输出结果需兼具全面性与结构化，为后续生成人物生活数据提供精准依据：
一、综合信息提炼
撰写一份整合描述，需系统覆盖以下核心维度：①基本信息（年龄、性别、学历、籍贯等关键标识）；②生活习惯（作息规律、饮食偏好、运动频率、兴趣爱好等日常行为特征）；③社交状态（社交圈规模、主要交往对象类型、社交频率与场景）；④工作情况（职业类型、岗位层级、行业属性等基础信息）；⑤经济状况（收入水平、消费习惯、负债/资产情况等）；⑥家庭结构（婚姻状况、亲属关系、家庭角色）；⑦个人特质（性格倾向、价值观、目标诉求等）；⑧重要日期（生日，结婚纪念日等）。描述需突出各维度关键信息，避免冗余。
二、专项深度分析
针对以下三个方向进行精准拆解，输出明确结论：
1. 居住情况：明确当前同住家庭成员构成（姓名、关系、年龄等），同步提炼居住相关特征（如住房类型、居住城市/区域、居住环境偏好、居家活动重点区域等）；
2. 工作情况：梳理工作中核心关联人物（如上级、下属、重要合作对象及关系属性），总结工作关键特征（如工作节奏、核心职责、办公模式、职业发展阶段等）；
3. 生活情况，梳理日常生活中常用联系人，总结生活中包括工作日非工作时间和非工作日可能的行为特征（如生活节奏，常见行为，生活阶段等）。
4. 日常轨迹：以“工作日”为核心场景，还原典型一天的生活常规轨迹，按时间顺序清晰呈现各时段主要活动及行为目的（需包含起床、通勤、工作、餐饮、休闲、睡眠等关键节点），不需要具体时间和具体事件。
三、事件分析
分析该人物可能生活中可能涉及的以下事件类别对应比例的合理列表。事件类别：Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other。
{persona}
最终把以上两个任务的输出组织成以下格式输出，不要有多余文本。
1.信息提炼：
2.深度分析：
2.1：居住情况：
2.2：工作情况：
2.3：生活情况：
2.4：工作日轨迹：
3.事件分析：
[{{'type':'','percent':''}},]
"""

template_yearterm_eventgen = '''
请基于下方的【人物分析】，为该人物推理生成 2025 年内可能发生的 100 件符合其画像的生活事件，需严格遵循以下要求，确保内容兼具真实性、独特性与多维度覆盖：
一、核心创作原则
聚焦非日常性：事件需区别于日常琐碎事务，优先选择「值得记录回忆」「需要提前准备」「有执行难度」「能体现个人特质」[持续时间长]的场景。
贴合人物画像：所有事件需与人物的职业背景、家庭关系、生活习惯、性格特质强关联，避免出现与画像矛盾的内容。
符合现实逻辑：事件需遵循时间规律（如 “冬季滑雪”“春节返乡”）、生活常识（如 “装修需 1-2 个月工期”“资格证备考需 1-3 个月”）与社会规则（如 “商业谈判需多次沟通”“医疗检查需提前预约”）。
二、事件细节要求
时间设定：
时长可覆盖 1 天至 3 个月（如 “单日的行业峰会参会”“持续 2 个月的技能培训”），需标注具体时间范围（格式：2025-XX-XX 或 2025-XX-XX 至 2025-XX-XX）；
允许时间重叠（例如 “云南旅行（2025-04-05 至 2025-04-12）” 与 “远程处理工作文件（2025-04-07 至 2025-04-08）”）；
支持多次发生的事件，需标注所有时间节点（格式：2025-XX-XX, 2025-XX-XX, 2025-XX-XX），例如 “季度性的家庭财务复盘（2025-03-30, 2025-06-25, 2025-09-28）”。
内容维度：需覆盖至少 9 个核心类别，每个类别至少包含 1 件事件，类别参考（可根据人物画像调整）：
Career & Education（职业发展 / 学习提升，如 “参加行业高峰论坛”“考取专业资格证”）；
Relationships（人际关系，如 “为父母筹备生日宴”“组织闺蜜旅行”）；
Living Situation & Family（居住生活和家庭事务，如 “房屋装修”“智能家居安装”）；
Personal Growth（个人成长，如 “学习新技能”“撰写个人传记”）；
Health & Well-being（健康管理，如 “中医调理”“瑜伽静修营”）；
Social & Lifestyle（社交生活，如 “组织同学聚会”“参加音乐节”）；
Finance（个人资产财务相关相关，如 “购买理财产品”，"汽车保养"）；
Unexpected Events（突发应对，如 “车辆事故处理”“临时代职管理”）；
Self Satisfy/Care（自我关怀，如 “定期 SPA 护理”“独自短途旅行”）。
Other（其他未涉及类别）
三、输出格式要求
按 “类别 + 事件数量” 分组输出，每个类别下按事件时间先后排序，示例如下：
Career & Education（20 件）
    参加上海零售业高峰论坛（2025-03-18 至 2025-03-19）：作为家族企业代表，学习行业趋势并拓展供应商资源。
----------------
人物分析：{summary}
'''

template_yearterm_complete = '''
请基于下方【人物画像】及你第一轮生成的 100 件事件，补充创作 100 个左右符合要求的新事件，需严格规避重复并实现精准互补，具体规则如下：
一、核心约束：绝对无重复 + 精准互补
内容去重：需与第一轮事件完全区分，无论是事件主题（如第一轮已有 “参加上海零售业高峰论坛”，第二轮不可再生成 “参加行业峰会” 类事件）、具体场景（如第一轮已有 “海南度假”，第二轮不可再生成 “海岛旅行”）均需差异明显，避免相似或变相重复。
维度互补：优先覆盖第一轮未涉及的领域，重点从以下 3 个方向切入：
节日关联场景：聚焦法定节假日（春节、清明、五一、端午、中秋、国庆、元旦）及重要民间节日（元宵、七夕、重阳、冬至），生成 “节日相关的工作生活娱乐社交事件”；
季节特色场景：结合四季特点生成事件，例如 “春季踏青赏花（2025-03-20 至 2025-03-22）—— 前往婺源看油菜花，拍摄家庭春日写真”“冬季滑雪度假（2025-12-20 至 2025-12-25）—— 预订长白山滑雪场住宿，学习单板滑雪”；
未用画像字段：重点挖掘【人物画像】中第一轮未涉及的信息（如联系人相关特点、特定技能/爱好、未提及的社交关系、专属目标等），例如若画像含 “联系人王芳爱好书法”，可生成 “被王芳邀请参加书法展（2025-05-15）—— 参观本地书法名家作品展，交流练字心得”；
二、事件细节要求（同第一轮，新增补充说明）
时间设定：需标注具体时间（格式同前），可结合节日日期（如 “端午龙舟赛观赛（2025-06-10）”）、季节时段（如 “夏季防汛物资准备（2025-06-01 至 2025-06-05）”）设定，允许与第一轮事件时间重叠，但需符合现实逻辑（如 “春节期间远程处理工作” 可与 “春节家庭聚会” 重叠）。
类别覆盖：需与第一轮类别保持一致（如 Career & Education、Finance 等），每个类别至少补充 5 件事件（若第一轮某类别事件较少，可适当多补充），优先确保整体维度均衡，每个类型都有一定量的事件。
三、输出格式要求
与第一轮保持一致，按 “类别 + 补充事件数量” 分组输出，每个类别下按时间先后排序，示例如下：
Career & Education（第二轮补充 20 件）
    端午商圈联合促销策划（2025-05-20 至 2025-06-10）：联动周边商家推出 “端午满减套餐”，融入传统香囊 DIY 活动吸引客流。
画像：{persona}
'''

template_yearterm_complete_2 = '''
请基于人物画像及前两轮已生成的事件，补充创作 100 个左右全新事件，需严格规避重复与冲突，聚焦 “人群共性” 与 “私人专属” 场景，具体要求如下：
一、核心创作导向：填补空白维度
绝对去重与无冲突
事件需与前两轮完全不同。
时间逻辑需自洽：若前两轮已设定 “2025-05 月出差北京”，本轮不可生成 “同期在上海参加婚礼” 等空间冲突事件。
人群共性事件：标签化场景挖掘结合人物的性别、年龄、地域、人生阶段等核心标签，生成符合该群体普遍经历但未被覆盖的事件。
私人专属事件：深度化场景延伸聚焦个人内心需求、隐秘体验或小众习惯，生成具有私密性的事件。
他人关联事件：社交角色延伸生成 “因他人需求而参与” 的非日常事件，突出人物在关系中的角色。
二、事件细节与格式要求
时间设定：需标注具体时间（格式同前），可覆盖全年分散时段，允许与前两轮事件时间重叠（如 “白天参加朋友婚礼，晚间处理私人事务”）。
类别覆盖：保持与前两轮一致的分类体系。
输出格式：同样按类别分组。
'''

template_yearterm_complete_3 = '''
请基于【人物总结】及前三轮已生成的事件，聚焦 “有困难、负面性、具挑战性” 的场景，补充创作 20 个左右符合人物特质的事件，需严格遵循以下要求：
一、核心创作原则：负面事件的真实性与适配性
负面属性明确：事件需包含 “困难性”（需克服障碍）、“负面性”（带来压力 / 失落 / 困扰）或 “挑战性”（超出能力舒适区）。
贴合人物画像：负面事件需与人物的职业、生活状态、社交关系强关联，避免脱离其身份的随机负面（如职场人不会出现 “农田歉收” 类事件）。
不要生成严重后果的负面事件，负面事件应当是能被解决的，只是一时的波折。
二、事件细节与分类要求
时间设定：需标注具体时间（格式：2025-XX-XX 或 2025-XX-XX 至 2025-XX-XX），允许短期事件（1-3 天）或持续困扰（1-2 周），例如 “急性肠胃炎影响工作（2025-03-12 至 2025-03-15）”“信用卡被盗刷处理（2025-10-05 至 2025-10-10）”。
类别覆盖：沿用前三轮的分类体系（如 Career & Education、Relationships 等），重点覆盖与人物关联度高的领域（如职场人侧重 Career 类，家庭主妇侧重 Relationships 类），不要求每个类别的数目遵循人物总结。
描述深度：每件事需补充 1-2 句 “负面影响” 或 “应对难点”，例如：
“社交媒体遭遇恶意评论（2025-08-20 至 2025-08-25）—— 发布的活动视频被网友曲解，引发持续网络攻击，需耗费大量时间澄清并调整账号设置”
“重要客户资料丢失（2025-11-03）—— 电脑硬盘损坏，未备份的年度合作方案丢失，面临重新制作的压力与客户信任危机”
三、输出格式要求
按类别分组输出，示例：
Career & Education
    门店遭遇恶意投诉（2025-02-18 至 2025-02-22）：被竞争对手指使的顾客恶意举报 “产品质量问题”，需配合工商调查并暂时下架相关商品，影响营业额。
人物总结：{summary}
'''

template_check = '''
请基于【个人画像】，对提供的【事件列表】进行全面合理性校验，按以下标准筛选出不合理内容，并给出优化建议：
一、核心检查维度(按优先级排列)
分析画像匹配度，排查事件与人物画像的冲突点。
处理原则：不合理如可以修改为合理则给出修改建议；严重不合理标记为 “建议删除”。
分析现实合理性，检查事件是否符合生活逻辑、时间规律或社会常识，合理性。
处理原则：不合理如可以修改为合理则给出修改建议；严重不合理标记为 “建议删除”。
分析日期、频率与间隔，有些事件发生的次数、间隔可能不合理。
处理原则：给出修改建议。
分析真实性，事件发生是否真实，不违和。
处理原则：不合理如可以修改为合理则给出修改建议；严重不合理标记为 “建议删除”。
注意：优先思考修改的方法，删除是不得以之举。
二、输出格式要求
只需列举有问题的事件，逐个分析呈现。
【个人画像】：{persona}【事件列表】：{content}
'''

template_process = '''
请基于你上一轮输出的问题事件及修改建议，对下方事件列表进行调整（包括修改或删除），最终输出处理后的合理的事件列表（未处理的事件做结构化调整后保留在列表中）。注意，删除操作需有明确依据，不可无理由移除任何事件。修改操作可以更改包括事件名称，日期，描述等字段。
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。date字段为起止时间数组，代表事件可能发生多次。description字段为对事件的描述。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "name": "事件名称",
          "date": ["2025-01-01至2025-01-03",],
          "type": "",
          "description":"（描述）"
        }},
        
      ]
---
事件列表{content}
'''

template_process_1 = '''
基于下面你输出的事件列表和人物关系描述，请你为每个事件分配合理的参与者，参与者可以是自己,同步优化事件描述使其更贴合实际参与场景。你也可以优化事件内容，使其更真实、丰富、重要、值得关注、不日常、合理。
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。date字段为起止时间数组，代表事件可能发生多次。description字段为对事件的描述。participant字段为参与者姓名和关系，要与画像中地name字段和relation字段相同。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物，优先从已有关系数据选择。location字段描述所处城市和POI类别信息。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "name": "事件名称",
          "date": ["2025-01-01至2025-01-03",],
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},]
          "location":"（POI大致描述）"
        }},
        
      ]
---
事件列表：{content}
关系数据：{relation}
'''

template_process_2 = '''
基于上述 {type} 类别的已有事件，请判断是否需补充更多事件以使其更真实、更多样，以及是否有画像信息没有反映出来，需补充事件。若需补充，请生成新的事件的列表，且新事件列表中所有事件必须与已有事件无重复；新事件要与已有事件完全不同，可发散思维，若已有事件已能充分覆盖一个人一年的相关情况，或者已有事件足够丰富，则输出空数组 [] 即可。宁缺毋滥，生成事件要高质量，合理真实，不要求生成的事件数目。
对于{type}类事件，可思考:{instruction}
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。date字段为起止时间数组，代表事件可能发生多次。description字段为对事件对的描述。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "name": "事件名称",
          "date": ["2025-01-01至2025-01-03",],
          "type": "",
          "description":"（描述）",
        }},
        
      ]
---
已有事件列表{content}
人物画像{persona}
'''

template_event_decomposer = '''
基于该事件列表，对其中的事件进行推理、扩展、分解，形成原子事件序列。原子事件是指详细具体的事件。

--- 说明 ---
1. 原子事件是指粒度细，比较具体的事件。它可能是原事件的详细步骤流程，也可能是原事件的前置（准备/规划/起因/预定）/后续（产生了什么影响/收尾）事件，也可能是相关的事件。**原子事件的发生时间不一定发生在原事件起止时间内，起止事件只代表事件主体发生的时间。在添加前置/后续事件时日期可以放在起止时间之前/之后。**原子事件的事件粒度必须小于等于一天，但是原子事件可以多次发生，如每月聚会的发生时间应写成(2025-01-01,2025-02-01,2025-03-01)而非(2025-01-01至2025-03-01)。注意原事件的id要保留。
2. 你需要分析每个事件，不同的事件重要性/复杂度/特殊性不同，涉及的流程长短，步骤难易，相关的原子事件数目也不同。对于持续时间长，流程复杂的事件，请先将其分解为子事件，再针对每个子事件分解为原子事件。
3. 请分析出不重要事件/日常工作生活等事件/会频繁发生/流程简单的事件，这些事件可以不进行分解。
4. 分解事件也要多样化，如不是所有事件都会经过准备/规划，也不是所有流程都一定会走完。同一类事件在不同时间不同地点执行时的流程和情景也不同。如吃饭可能会选择烤肉或火锅等等，有非常多的多样性。
5. 有些事件虽然持续时间长，但可能主要流程就发生在一天或者几天。由于持续时间是开始到结束时间但不代表这期间每一天都执行了该事件或做该事件有关的事。这之间可能有中断，所以你在分解时，不要求事件时间均匀分布，不要求每天都有相关事件，可以有的天较多执行相关事件，有的天不执行相关事件，要按照真实情况和常理合理分布时间。
6. 事件的各项信息和描述并不是一定合理的，可适当修改，在分析中指出，使其更真实合理。同时可考虑事件间的分解后安排是否有冲突。

--输入说明--
事件列表{content}
输入为事件列表，包含事件的基本信息。
--输出说明
对每个事件，给出一段分析。若需先拆分出子事件，先输出子事件序列，再输出原子事件序列并明确其对应子事件。若可直接分解为原子事件，则给出原子事件序列。示例如下：

**原事件名称、id**
**分析**：
**子事件序列**：
1. 子事件1
2. 子事件2
3. 子事件3
**原子事件序列**：
子事件1：
事件名（发生时间）：描述 

--用户画像--
一些相关信息可以从用户画像中推理
{persona}
'''

template_process_3 = '''
将你上述的分解事件组织为下面的结构化格式输出。
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。date字段为起止时间数组，代表事件可能发生多次。description字段为对事件的描述。participant字段为参与者姓名和关系，要与画像中地name字段和relation字段相同。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物，优先从已有关系数据选择。location字段描述所处城市和POI类别信息。subevent对应下一层事件，你可以理解为若没有子事件，则原子事件即为下一层事件，subevent数组即为该事件的原子事件数组，原子事件的subevent为空数组[]。若有子事件，则该事件的subevent为子事件，子事件的subevent为原子事件。注意event_id的层级关系，上层事件分解为下层事件时，下层事件id为上层事件的id-序号。注意原子事件的事件粒度必须小于等于一天，但是原子事件可以多次发生，如每月聚会的date应写成[2025-01-01,2025-02-01,2025-03-01]而非[2025-01-01至2025-03-01]。最上层原事件的id保持原本不变。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "event_id":"1"
          "name": "事件名称",
          "date": ["2025-01-01至2025-01-03",],
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},]
          "location":"（POI大致描述）",
          "subevent"：[
          {{
            "event_id":"1-1"
            "name": "事件名称",
            "date": ["2025-01-01至2025-01-03","2025-01-01至2025-01-03"],
            "type": "",
            "description":"（描述）",
            "participant":[{{"name":"","relation":""}},]
            "location":"（POI大致描述）",
            "subevent":[]
          }},
          ]
        }},
        
      ]
'''

template_process_4 = '''
请基于本月事件序列、人物画像及本月日历，按以下维度开展合理性分析，全面冲突排查、特征密度分析及优化调整，确保优化后事件序列真实合理、逻辑自洽。请你先以日历为基础，列出每日事件及其对应的持续时间和地点，然后针对每日进行分析，调整/删除事件，使其合理，最后考虑是否新增事件。最终输出修改后的事件序列。
一、不合理分析（需逐天核验事件）
- 时空冲突：检查同一主体在时间地点上的逻辑矛盾；
- 画像冲突：验证事件内容与人物画像核心属性（如身份角色、行为习惯、能力范围、职业限制）的匹配度，排除背离设定的异常事件；
- 逻辑冲突：排查事件前后因果关系、流程关联性（如前序依赖事件未完成却开展后续事件、事件结果与前置条件矛盾）的合理性。
- 月份特征匹配度：结合本月日历中的每日属性判断事件合理性。
- 密度分析：调整密度过高或过低的异常时段。对相似、冗余的事件可进行合并。灵活调整事件，使每天事件密度合理。
二、优化操作
1. 优先通过调整时间（如“3号会议”改为“20号会议”，时间可任意调整安排，合理即可）、更换地点、替换参与人物，修改描述消除矛盾或合理化；内容严重不合理的可以修改事件内容，对于冲突无法调和的事件标记“建议删除”，优先删除不重要的事件；
2. 序列完整性补充：基于月份特征和空闲时段日期的特征以及个人特征，新增合理事件，使事件序列丰富真实连贯。但新增事件不要过于日常。
本月事件{content}
人物画像{persona}
本月日历{calendar}
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。date字段为起止时间数组，代表事件可能发生多次。description字段为对事件的描述。participant字段为参与者姓名和关系，要与画像中地name字段和relation字段相同。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物，优先从已有关系数据选择。location字段描述所处城市和POI类别信息。event_id对于原事件虽然修改了但保持不变，对于新增事件则随机分配一个大于500的数字为id。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "event_id": 1
          "name": "事件名称",
          "date": ["2025-01-01至2025-01-03",],
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},]
          "location":"（POI大致描述）",
        }},
        
      ]
---
'''

template_process_5 = '''
基于你对本月事件提出的问题和修改建议，生成一份新的本月事件列表，注意保留未修改的事件，同时修改要修改的事件。
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。date字段为起止时间数组，代表事件可能发生多次。description字段为对事件的描述。participant字段为参与者姓名和关系，要与画像中地name字段和relation字段相同。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物，优先从已有关系数据选择。location字段描述所处城市和POI类别信息。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "name": "事件名称",
          "date": ["2025-01-01至2025-01-03",],
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},]
          "location":"（POI大致描述）",
        }},
        
      ]
---
本月原事件{content}
'''

template_update_cog = '''
现在你将基于指定的 3 类参考数据，完成个人长期记忆更新：
1. 长期记忆更新
核心筛选标准：优先选择「有用 / 重要 / 后续可能常用」的信息，具体包括三类内容：一是客观事实与固定偏好（如 “我常去 XX 银行，已在此办理常驻业务”“家附近超市的营业时间为 8:00-22:00”“我常去XX健身房，在此办了卡”）；二是印象深刻的关键事件（如 “首次完成项目独立交付”“与家人确定春节旅行目的地”）；三是重复多次进行的事件的总结（如 “连续一周 18:30 去健身房锻炼，形成最近经常锻炼的记忆”）。
内容呈现要求：对以往事件结合已有长期记忆做总结，只描述主要信息。
动态更新原则：若近期无重要事件，可暂不更新记忆；更新时需先回望近期事件，排除无价值、无后续关联的内容；随着时间推移，后续判断为 “不重要” 的旧记忆（如 “单次临时购买日用品”“无后续的偶然事件”）需从长期记忆中移除，确保记忆库仅留存高价值信息。可对记忆进行总结和压缩。
本质定位：最终输出内容为一段话，聚焦已发生的事实的记忆，对过去的总结，与形成的认知，语言简洁、信息明确，便于后续快速检索与调用。注意长期记忆的特征，不需要有未来相关的内容和想法相关内容。只表述记忆。同时注意不要和自我认知重复，长期记忆主要是在模拟生活过程中做总结和认知，而自我认知是固定好的对自我的描述。同时若有未来规划相关的记忆，需明确其发生日期。
注意，对于记忆事件需明确其日期，不要用明天，周末，下周一等模糊概念，要明确几月几号。
2. 输出要求
仅输出JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，long_term_memory填写按规则更新后的长期记忆内容；environment填写生成的外部环境调控事件。两者都是一段字符串，格式示例如下：
{{
"long_term_memory":"",
}}

4.参考数据
自我认知{cognition}
长期记忆{memory}
近期事件{history}
后续规划:{plan}
'''

template_plan_1 = '''
请基于第一步输出的拟人化思考过程、事件修改明细、结合初始 **规划事件（含原子事件背景）** 与 **自我认知 **和交通轨迹分析，生成个人覆盖全天（从起床到睡前）、事件衔接连贯、地点转变清晰的个人一天生活内容。把个人思考作为参考和基础，然后你要以客观角度，审视事实合理性，不一定都采纳思考的建议，在思考之外进行调整增加或修改，使一天活动更合理且丰富。注意保留下的规划事件要执行，不能再删除规划事件。你可以合理新增活动、事件、地点、场景，新增事件可以是非日常事件，以客观视角叙述，具体要求如下：
一、内容生成核心要求
1. 填补稀疏时段，新增各类活动，避免内容空洞：对于初始日程中未明确提及的空白时段（如“06:30-07:00”“20:30-21:30”），需结合全天事件逻辑，补充丰富多样（行为多样、活动多样、地点多样、人物多样等）且连贯的事件，注意逻辑要和其他事件以及本日特征连贯，**要和之前几天的事件有差异。**。针对初始日程中“单事件占用长时间但内容单薄”的时段（如“14:00-15:00 休息”），需新增关联场景、活动或互动内容进行填充。示例：将“14:00-15:00 休息”优化为“14:00-15:00 刷手机浏览旅行攻略并收藏小众景点，后又与同事在茶水间交流周末探店体验”，确保时段内活动充实且有细节。
2. 结合交通轨迹，优化移动逻辑：参考交通轨迹分析数据中的地点、通行时间，融入并调整全天事件，使个人移动轨迹符合日常习惯。需注意：交通数据未包含准备时间及特殊情况，可合理修改通行时长、调整出行方式，新增活动时同步补充合理地点。
3. 丰富事件维度，避免同质化：允许对现有事件进行调整或新增事件，同一类型事件需体现形式多样性。具体可从三方面拓展：
- 事务内容：将笼统事务拆解为具体行为（如“处理工作”细化为“撰写项目周报、对接客户需求”）；
- 地点和形式选择：饮食类可选择增加火锅、日料、烤肉等，娱乐类可拓展网吧、KTV、电玩城、livehouse等；
- 活动形式：新增博物馆参观、城市公园骑行、独立咖啡店办公、市集打卡等场景，灵活修改思考过程中的执行形式。
4. 强化衔接逻辑，明确地点转变：事件间需体现“顺承关系”，地点转换需符合日常轨迹与交通合理性（如“家→小区门口便利店买早餐→地铁通勤至公司”“公司→楼下商场快餐店午餐→回公司午休”），避免无逻辑空间跳跃。示例：“在家吃完煎蛋吐司早餐后，拿上通勤包和折叠伞出门→步行5分钟到地铁站乘坐3号线→抵达公司后先开电脑整理昨日会议纪要”。
5. 细化事件描述，补充情景细节：所有事件需清晰说明“核心过程+场景”，事件的描述要充实，内容要丰富，包括该时间段的主题相关事件和一些同时或穿插发生的其他事件情景（不是必要）。重点突出主要事件的执行步骤与场景氛围，示例：“19:00-20:00 预定周末机票（过程：打开旅行APP对比不同航班的起降时间与价格，选择靠窗座位并支付，同时浏览目的地美食攻略帖子，收藏3家评分高的本地菜馆）”。
6. 思考过程结果，增强生活连贯性：思考过程多体现主观意愿，描述事件时可合理加入客观执行过程、结果及后续影响（无需每个事件都体现）。结果需符合逻辑且避免频繁出现颠覆性影响（如“12:30-13:00 前往中医馆正骨，发现康复”）。当然结果需要以概率呈现，不是你执行事件就一定有结果。
最终生成合理的一天生活
二、输出格式要求
1）输出全天事件，按 “时间区间、事件、地点、人物、描述” 的格式呈现，时间区间拆分合理，**地点为详细地点，包含市、区、街道、建筑、详细名称。**若之前没用提及请你进行合理补充地点信息使其完整。
三、参考数据：
可能交通轨迹分析数据：{poi}
'''

template_plan_11 = '''
第一步输出的拟人化思考过程是个人主观对该日的安排，现在请你从客观视角考虑，结合该日日程、思考过程、和客观合理性真实性，对该日事件进行调整增加或修改，使一天活动更合理且丰富。你可以合理新增活动、事件、地点、场景，新增事件可以是非日常事件，以客观视角叙述，具体要求如下：
一、内容生成核心要求
1. 确定事件发生时段，填补稀疏时段，新增各类活动，避免内容空洞，生成改天每个时段的事件活动。对于一些未分配事件的的空白时段，需结合全天事件逻辑，补充丰富多样（行为多样、活动多样、地点多样、人物多样等）且连贯的事件，注意逻辑要和其他事件以及本日特征连贯，**要和之前几天的事件有差异。**。针对一天事件中“单事件占用长时间但内容单薄”的时段（如“14:00-15:00 休息”），需新增关联场景、活动或互动内容进行填充。示例：将“14:00-15:00 休息”优化为“14:00-15:00 刷手机浏览旅行攻略并收藏小众景点，后又与同事在茶水间交流周末探店体验”，确保时段内活动充实且有细节。
2. 明确交通轨迹，优化移动逻辑：要明确事件和时段间地点的转变，包括转变的具体地点（某市某区某类建筑或某市某区某楼），通勤方式，通勤占用时间。
3. 丰富事件维度，优化合理性，避免同质化：请分析历史记忆中的事件，新增事件尽量与其有差异，不要每天事件同质化，且要与历史事件连贯。允许对现有事件进行执行方式调整（如难以同时发生的事改为别人代办，或线上办理）。同时允许新增事件，同一类型事件需体现形式多样性。具体可从三方面拓展：
- 事务内容：将笼统事务拆解为具体行为（如“处理工作”细化为“撰写项目周报、对接客户需求”）；
- 地点和形式选择：饮食类可选择增加火锅、日料、烤肉等，娱乐类可拓展网吧、KTV、电玩城、livehouse等；
- 活动形式：新增博物馆参观、城市公园骑行、独立咖啡店办公、市集打卡等场景，灵活修改思考过程中的执行形式。
4. 强化衔接逻辑，明确地点转变：事件间需体现“顺承关系”，地点转换需符合日常轨迹与交通合理性（如“家→小区门口便利店买早餐→地铁通勤至公司”“公司→楼下商场快餐店午餐→回公司午休”），避免无逻辑空间跳跃。示例：“在家吃完煎蛋吐司早餐后，拿上通勤包和折叠伞出门→步行5分钟到地铁站乘坐3号线→抵达公司后先开电脑整理昨日会议纪要”。
5. 细化事件描述，补充情景细节：所有事件需清晰说明“核心过程+场景”，事件的描述要充实，内容要丰富，包括该时间段的主题相关事件和一些同时或穿插发生的其他事件情景（不是必要）。重点突出主要事件的执行步骤与场景氛围，示例：“19:00-20:00 预定周末机票（过程：打开旅行APP对比不同航班的起降时间与价格，选择靠窗座位并支付，同时浏览目的地美食攻略帖子，收藏3家评分高的本地菜馆）”。此外，描述内容若涉及未来事件，注意对其时间的指定是否正确，尽量不明确说出未来事件的具体发生时间。
6. 思考过程结果，增强生活连贯性：思考过程多体现主观意愿，描述事件时可合理加入客观执行过程、结果及后续影响（无需每个事件都体现）。结果需符合逻辑且避免频繁出现颠覆性影响。当然结果需要以概率呈现，不是你执行事件就一定有结果。此外考虑事件的变化。
7. **新增事件不要有较大后续影响或后续事件（如打算周末去异地）。新增事件、场景、描述时请注意，所有涉及未来的事件、场景、描述，请参考未来该日期的安排，不要无中生有新增未来安排。你所添加的新事件、场景、描述只能局限于今天发生，不要涉及未来。**
最终生成合理的一天生活
二、输出格式要求
1）输出全天事件，按 “时间区间、事件、地点、人物、描述” 的格式呈现，时间区间拆分合理，**地点为详细地点，包含市、区、街道、建筑、详细名称。**若之前没用提及请你进行合理补充地点信息使其完整。注意对事件进行描述时，不要遗漏任何今日事件中的事件信息和描述细节。
三、参考数据：
今日事件{plan},包含未来事件和今日事件以及昨日事件，请把未来事件和昨日事件作为分析参考，重点关注今日事件，生成一个前后连贯的合理的今日详细生活全天事件。
'''

template_plan_2 = '''
请你完全代入角色，以 “我” 的第一视角思考，结合自我认知（性格、习惯、偏好）、记忆（过往轨迹、重复事件、长期习惯）、当下想法（近期意愿、兴趣点）、及今日日期，分析**今日事件（今日规划及相关参考事件）{plan}**，梳理今日事件日程的合理性（时空冲突，精力分配）与调整方向(推迟事件，修改事件，删除事件，维持不变)。
注意，今日可能规划很稀疏，或没有规划，这时你的主要思考可能是今天大概要做什么，添加什么安排，新增什么事件，后续会根据你的想法生成一天完整的活动。
思考过程如下：
1）逐一审视今日计划，分析合理性：- 结合自我认知判断对事件的意愿,是否契合自身行为偏好；- 对照当下精力状态评估事件执行的可行性与效率，若事件太满太忙可选择性删除事件或推迟事件；- 关联过往记忆排查事件是否存在时间或安排上的冲突； -分析今日事件是否有时间空间的冲突。
2）与个人画像、近期记忆、个人习惯比对：- 依据日期属性（工作日/周末）匹配对应作息，调整时间冲突事件；- 梳理近一周事件避免重复，使今日事件与历史事件连贯，同时替换同质化安排- 结合个人习惯与特质，对事件进行适配性调整以符合自身行为模式。
3）新增事件，充实生活：1.结合当下需求与潜在意愿新增事件，既满足实际生活所需，也兼顾兴趣探索，同时做好后续衔接。2.补充丰富多样（行为多样、活动多样、地点多样、人物多样等）且连贯的事件。3.考虑到社交、爱好、娱乐、工作、生活等各类场景补充事件。4.考虑个人习惯。
4）分析历史，是否有很久没做的事，想尝试的事情。
5）思考事件的变化发展，避免生活一成不变。
6）思考一些事件可以结束/删除/中断/拒绝。
注意所有的内容都是根据**今日已有规划事件{plan}**思考，判断其中事件的调整方向，不要涉及无关事件。
输出内容:
1）拟人化思考过程，一段话表述，思考要符合该角色特征。
2）事件修改明细列表：每条改 / 删的事件，都带 “我为什么这么改”（如 “删掉 XX，因为我不想……”“调整 XX，因为我觉得……”）（优先调整、推迟事件，删除只做严重不合理，难以调整情况下选择）
3)今天可能涉及的生活轨迹地点（按顺序呈现，如:家->工作地点->寿司店—>工作地点->家->公园—>家）
**参考数据：**
自我认知：{cognition}
记忆：{memory}
想法：{thought}
日期信息：{date}（你要明确工作日/休息日）
个人画像:{persona}
'''

template_plan_21 = '''
请你完全代入角色，以 “我” 的第一视角思考，结合自我认知（性格、习惯、偏好）、记忆（过往轨迹、重复事件、长期习惯）、当下想法（近期意愿、兴趣点）、及今日日期，分析**今日事件（今日规划及相关参考事件）{plan}**，梳理今日事件日程,给出今日活动的安排想法。
注意，今日可能规划很稀疏，或没有规划，这时你的主要思考可能是今天大概要做什么，添加什么安排，新增什么事件，后续会根据你的想法生成一天完整的活动。
思考过程如下：
1）逐一审视今日计划，分析如何执行：- 结合自我认知判断对事件的详细执行过程和方法,如执行该事件常去的地点是什么，这次是否探索新地点；我一般如何执行该事件，今天会有什么不同。为事件添加丰富真实的细节过程。
2）与个人画像、近期记忆比对：- 依据日期属性（工作日/周末）匹配对应作息；- 结合个人习惯与特质，对事件进行适配性调整以符合自身行为模式。
3）新增事件，充实生活：1.结合当下需求与潜在意愿新增事件，既满足实际生活所需，也兼顾兴趣探索（本地景点、娱乐爱好等），同时做好后续衔接。2.补充丰富多样（行为多样、活动多样、地点多样、人物多样等）且连贯的事件。3.考虑到社交、爱好、娱乐、工作、生活等各类场景补充事件。4.梳理近一周事件避免重复，替换同质化安排.5.考虑探索尝试没做过或很少做的新事件、新娱乐、新爱好等。6.分析居住地有什么热门景点选择体验。
4）思考事件的变化发展，避免生活一成不变。
输出内容:
1）拟人化思考过程，一段话表述，思考要符合该角色特征。
2）今天的事件和活动想要怎么安排。只输出大概有哪些活动，不用做具体的时间安排或全天安排。可根据事件密度来判断并选择合理新增丰富的活动。
3) 今天可能涉及的生活轨迹地点（按顺序呈现，如:家->工作地点->XX店—>工作地点->家->公园—>家）
**参考数据：**
自我认知：{cognition}
记忆：{memory}
想法：{thought}
日期信息：{date}（你要明确工作日/休息日）
个人画像:{persona}
'''

template_plan_3 = '''
请以**人物画像及前期生成的初始个人单日生活内容**为核心依据，在各时段核心活动框架基础上，从客观角度，同步完成「优化丰富调整」与「合理连贯调整」，最终生成逻辑严谨、细节饱满的高质量个人单日生活内容。优先保证生活真实，不违和。同时新增内容要与历史事件不同，防止事件频繁发生（如每天都网购，过于频繁做同一件事）。具体执行要求如下：
一、事件密度适配与细事件叠加：聚焦场景真实感
1. 密度优化原则
优先校验各时段时长与事件的匹配合理性：若某时段事件过于稀疏（例如“9:00-10:00 仅听音乐”），需新增贴合场景的情景事件，使时段内活动充实且符合日常行为逻辑。新增示例：“9:00-10:00 听音乐时搭配去公园跑步，耳机里循环舒缓节奏的歌单，跑完步在长椅上歇5分钟，顺带拍了张公园晨景发朋友圈”。
2. 细事件叠加规则
- 主题差异化：新增细事件需与时段核心活动主题形成互补（如工作时段可叠加“回复同事微信协作消息”“快速浏览行业资讯短文”；用餐时段可叠加“与邻座朋友闲聊周末计划”“收到外卖小哥赠送的小零食”）；同时也不要与记忆中细事件的主题重复。
- **事件影响控制**:新增的事件不得有较大的影响，不能引起个人社交关系、基本信息的变化，必须是没有大的影响的事件，偏日常的事件。
- 场景自然融入：严格贴合时段所处场景，避免违和感（如通勤途中叠加“在地铁上刷到便利店新品海报，决定下班顺路购买”；工作间隙叠加“接热水时瞟了眼手机日程，确认下午3点的会议提醒”）；
- 细节与时效性：每个细事件需包含“具体动作+当日可闭环结果”，80%以上新增事件需在当日完成且不产生后续待办,最多一个新增事件需有后续事件（示例：“刷到网红店限时买一送一优惠，午休时顺路购买，当场饮用完毕”“看到小区团购群接龙，随手下单，傍晚送达并接收（若是后天送达则有后续事件）”），优先选择手机相关操作、短时可执行或可与核心活动并行的场景。
数量约束：无需每个时段均新增事件，需结合用户行为规律判断“是否存在空隙时间”“已有事件密度是否充足”；新增细事件场景总计不超过6个，且需保证事件类型不重复、频率分布协调合理，同时尽量与近期及未来事件主题形成差异。
3.真实性优化
分析事件联系，合理优化或增加相关事件。
二、多样性与灵活调整：增强行为动态感
1. 避免同质化策略
对比历史记忆的事件，若出现“时间+主题”双重重复的活动（如每日固定居家用餐），可进行灵活调整：例如改为“外出到常去的面馆就餐”“点一份新品外卖”“因临时处理工作推迟半小时用餐”；每日固定行为（如睡眠时间、运动时间）或轨迹（如通勤方式）可随机微调，需保持“大致符合人物规律”的前提（如平时7点起床，今日可因周末调整为7:30，避免出现凌晨3点起床等违和设定）。
2. 波折与随机事件设计
可选自然融入轻量级变化（非必做），需符合日常逻辑：例如“网购的衬衫款式缺货，联系客服改选相近颜色”“计划去健身房但遇下雨，改为在家做15分钟拉伸操”“收到朋友周末聚餐邀请，回复‘暂定参加，晚上确认时间’”。此类小变化总计不超过3个，事件结果可包含“拒绝（如婉拒临时邀约）”或“处理（如同意赴约并初步规划）”两种情况。同样遵循**事件影响控制**:新增的事件不得有较大的影响，不能引起个人社交关系（联系人的变动）、基本信息（住址，工作，爱好等）的变化，必须是没有大的影响的事件，偏日常的事件。
三、合理微调：保障内容严谨性
对整体内容进行逻辑梳理，重点校验“历史事件与当日事件的连贯性”“活动与人物画像的匹配度”“时间线的合理性”，对存在违和、不真实的内容进行微调，最终实现内容多样、细节真实、逻辑自洽的效果。
三、输出格式
保留全天事件列表按 “时间区间、事件、地点、人物、描述” 的格式呈现，描述要更加丰富，思考时间段的事件密度合理性，确保内容连贯、主题多元，贴合人物画像。不要输出其他多余内容。

参考：
记忆历史：{memory}
'''

template_plan_31 = '''
请以**人物画像及前期生成的初始个人单日生活内容**为核心依据，分析记忆数据，在各时段核心活动框架基础上，从客观角度，同步完成「细节丰富调整」与「合理连贯调整」与「信息明确」，最终生成逻辑严谨、细节饱满的高质量个人单日生活内容。优先保证生活真实，不违和。新增事件不要指向未来（如约定下周XX，准备明日XX）。同时新增内容要与历史事件不同，防止事件频繁发生（如每天都网购，过于频繁做同一件事）。具体执行要求如下：
一、细节丰富调整：聚焦场景真实感
 **首先明确，新增事件、场景、描述时要排查是否有包含指向未来的事件描述（如“与XX讨论明天的聚会”“规划后天的行程”等未发生的安排），此类内容需全部删除。新增事件、场景、描述时不要无中生有新增未来安排。你所添加的新事件、场景、描述只能局限于今天发生，不要涉及未来。**
 **其次注意，所有初始个人单日生活内容内容信息不要有任何遗漏，在保留原信息的基础上做优化调整。**
1.参考以下时段安排进行事件调整：
- 核心任务时段：聚焦人物每日必须完成的关键事项（如工作、学习、照顾家人等），参考「要事优先」原则，将3件最重要的事安排在精力峰值时段（如职场人上午9-11点、学生下午2-4点），每个核心任务标注具体时长，并明确任务场景。
- 过渡衔接时段：针对跨场景移动（如通勤、家务转换）或状态切换（如工作转休息）的时段，采用「两分钟法则」处理碎片化事务。例如通勤途中可安排听行业播客（标注具体节目名称及时长）、下班回家后用10分钟收纳随身物品并规划晚餐食材处理顺序。（新增事务需今日完成，不会跨天）
- 弹性留白时段：每天预留1-2个20-60分钟的空白时段，避免行程过度饱和。留白时段可结合人物兴趣爱好设计低强度活动（如职场妈妈午间15分钟冥想、大学生傍晚40分钟校园散步，午休刷20分钟手机），或作为突发事项缓冲时间（如临时回复工作消息、调整家务顺序），增强生活真实感。
2.连贯合理性调整和新增
通过「因果关联」「状态递进」方式，强化时段间的连贯性，避免活动割裂感：
- 因果关联衔接：前一时段的活动为后一时段埋下伏笔。例如“上午超市采购时购买了新鲜草莓（原因）→ 下午下午茶时段清洗草莓制作酸奶杯（结果）”；“工作中收到客户修改需求（原因）→ 晚间预留1小时加班调整方案（结果）”。
- 状态递进衔接：遵循从活跃到平静的生理状态变化。如“傍晚进行40分钟有氧操（高强度）→ 结束后用15分钟拉伸放松（中强度）→ 睡前10分钟听舒缓音乐（低强度）”；“上午进行头脑风暴会议（高专注）→ 午后处理常规报表（中专注）→ 临近下班整理桌面文件（低专注）”。
3.差异化控制机制：避免重复与不合理频率
在生成新内容前，检索人物过往7天的生活记录，筛选高频出现的活动（如网购、外卖、特定娱乐项目），新增活动需满足“同类行为间隔≥3天”原则。例如上周三已安排“网购衣服”，本周单日内容中则替换为“线下服装店试穿”或“整理衣柜捐赠旧衣”。确保新增内容与过往生活轨迹差异化，同时符合日常行为规律。
4.多维度确保内容真实性
生成初稿后，通过「逻辑自洽性」「画像匹配度」「生活违和度」三项校验标准进行审核调整：
- 逻辑自洽性校验：检查时间线是否存在冲突（如14:00同时出现在会议室与健身房）、活动耗时是否合理（如30分钟无法完成“从公司回家+做一顿四菜一汤”），可借助「时间记账法」逐时段核对时长分配。
- 画像匹配度校验：对照人物核心特征（年龄、职业、收入、家庭结构等），删除不符合设定的内容。如“刚毕业的实习生”不应出现“自驾高端车通勤”“频繁出入高档餐厅”等场景；“独居老人”需减少“深夜外出娱乐”等风险行为。
- 生活违和度校验：模拟真实生活场景，判断活动组合是否自然。例如“工作日清晨6点起床做烘焙”对职场人而言违和度较高，可调整为“周末上午烘焙”；“连续3小时无休息工作”不符合人体疲劳周期，需插入番茄钟休息时段。
5.遵循**事件影响控制**:新增的事件不得有较大的影响，不能引起个人社交关系（联系人的变动）、基本信息（住址，工作，爱好等）的变化，必须是没有大的影响的事件，偏日常的，没有后续的事件。不要新增未来规划/准备事件。（如约定下周XX，准备明日XX）
总结：保留人物核心特征与初始事件的基础上，生成兼具细节质感、逻辑连贯性与、生活真实性与动态波折感的个人单日生活内容，同时有效规避重复事件与、违和场景与过度戏剧化情节，实现高质量内容产出。
二、合理微调：保障内容严谨性
对整体内容进行逻辑梳理，重点校验“历史事件与当日事件的连贯性”“活动与人物画像的匹配度”“时间线的合理性”，对存在违和、不真实的内容进行微调，最终实现内容多样、细节真实、逻辑自洽的效果。
三、输出格式
保留全天事件列表按 “时间区间、事件、地点、人物、描述” 的格式呈现，描述要更加丰富，思考时间段的事件密度合理性，确保内容连贯、主题多元，贴合人物画像。不要输出其他多余内容。

参考：
初始个人单日生活内容{life}
记忆历史：{memory}

'''

template_plan_4 = '''
请基于今日事件数据{plan0}执行以下事件调度分析，通过调度事件发生日期使事件发生安排合理真实。需严格遵循优先级与逻辑约束：
一、核心分析维度
- 合理性校验：判断事件密度是否适中，重点排查是否存在同日难以完成的时空冲突（如需前往不同地点的事件难以在同一天安排、高耗时事件难以在同一天完成，事件过多同一天难以完成等）。同时从客观角度分析一天的时空轨迹合理性（如今明两天人物都在北京，则不可能出现今日有以该人物为主体的事件在广东完成），思考事件如何安排更合理。
- 事件优先级排序：优先保留符合当日特征的重要事件——工作日以工作事件为主，休息日侧重非工作事务，节假日优先匹配节日属性事件。
- 时间成本区分：随手可完成、能在事件间隙处理的轻量事件无需推迟；需专门抽时间、耗精力或前往特定地点的重量级事件，需重点评估时空可行性。
二、关键约束规则
1. 若事件数量不多或可在当日合理完成（无时空冲突或不合理），直接输出空数组[]，尽量将今日事件安排在当日完成。
2. 推迟事件发生日期需合理考虑推迟的时间。同时参考其背景中的相关事件时间：如事件A（1-1-1）的后续事件为B（1-1-2），则A不得推迟至1-1-2及之后日期，避免逻辑断裂。
3. 需联动分析后续一周事件序列与前一天事件序列，确保推迟事件分配至空闲且时空无冲突的日期，且需确保今日的事件合理真实；同时关注event_id相近的关联事件，严禁前置事件发生在后续事件之后。
输出要推迟的今日事件的id和对应时间。event_id要和今日事件数据里的event_id严格相同。new_date字段的日期也要严格遵守"XX-XX-XX"格式。同时在conclusion字段说明调整逻辑，描述剩余事件的当日大致流程，同时明确该天的个人时空轨迹（大概什么时间在什么地方）。
仅输出JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，若无需推迟任何事件，直接输出空数组[]。格式示例如下：
{{
"event_update":[
{{"event_id":'1-1',"new_date":"2025-01-20"}},
{{"event_id":'1-2',"new_date":"2025-01-21"}}
],
"conclusion":""
}}
参考数据:
**今日事件:{plan1}（含具体事件及其完整背景）**
今日日期特征：{date}
后一周事件序列{plan2}
前一天事件序列{plan3}
'''

template_plan_5 = '''
基于轨迹数据对该日事件进行重新安排，参考交通轨迹分析数据中的地点、通行时间，融入并调整全天事件，使个人移动轨迹符合真实时间。在调整过程中，需先完成事件合理性校验与优化，再进行细节补充，具体要求如下：
一、事件调整核心要求
1. 事件合理性校验：首先判断所有事件是否存在不合理之处，包括但不限于与历史事实、当前客观情况、人物身份及行为逻辑的冲突，若存在冲突需进行修正或删除；其次排查是否包含指向未来的事件描述（如“与XX讨论明天的聚会”“规划后天的行程”等未发生的安排），此类内容需全部删除。
2. 通勤细节明确：结合轨迹数据明确通勤过程，包括具体通勤时间（精确到分钟）、通勤方式（如地铁、公交、自驾、步行等），可在合理范围内修改通行时长（不得与真实同行时长差距过大）、调整出行方式。
3. 地点转变清晰：明确各事件间的地点转变逻辑，确保地点切换与时间顺序、通勤方式匹配，避免出现空间跳跃不合理的情况。
4. 事件安排优化：在符合轨迹数据的基础上合理调整事件顺序与时长，确保全天事件节奏合理；同时可新增只与当日相关的事件细节执行描述或多样化情景（如“在XX餐厅点了XX菜品”“在开会时浏览感兴趣衣物”等），增强事件真实性。新增事件不得有任何跨天后续事件或影响（如打算周末去旅游），必须本日完成。
二、输出格式要求
1）输出全天事件，按 “时间区间、事件、地点、人物、描述” 的格式呈现，时间区间拆分合理，**地点为详细地点，包含市、区、街道、建筑、详细名称。**若之前没用提及请你进行合理补充地点信息使其完整。
三、参考数据：
轨迹数据：{poi}
'''

template_get_event = '''
请根据此前生成的**全天事件：{content}**，提取事件并生成新的格式化事件序列。具体需按以下步骤执行：
全天事件是按照时间区间加描述的形式展示，你需要从描述部分提取出该个人的生活事件，要能反应这个人一天的生活。
然后分析提取出的事件与原分解事件的相同部分将其对应上，明确对原事件是否存在改动或调整（如时间、地点变更），然后重写原事件，注意被推迟的没在今天发生的事件也要重写其发生事件后放入新事件序列。
再核查原事件是否有被删除的情况，删除后的事件不必放入新事件序列；
最后梳理新增事件。分析新增事件之间有没有关联，是否是相关事件或连贯事件，新增事件是否应有后续事件（注意此处发挥你的想象力，全天序列没有给出后续信息和关联信息，需要你根据识别出的新事件推断），然后把相关事件和后续事件组织成一个完整的有逻辑的完整事件。
提取事件时，需覆盖全天事件的完整信息，不仅限于细粒度具体事件。例如，即使描述仅为 “1 点到 4 点工作” 且无具体行为，也需将该时段工作作为事件提取，确保生成的全天事件无信息遗漏。最终输出与该日相关的完整事件列表。
最后将提取出的所有事件重写为完整事件：对原有事件，参考原完整事件重写，注意eventid等内容保持不变，主要修改今日事件的修改部分。对新增事件若新增事件涉及多个关联事件及后续事件，需先生成新增事件的上层完整事件，然后在完整事件的subevent字段中详细列出每个具体事件（如网购XX事件，有后续事件拿快递，使用等（或有前置原因事件），那么可以组织为完整事件购买XX,然后完整事件购买XX有subevent字段[网购，拿快递，使用]）；若仅为单一新增事件且无后续关联，则直接生成该事件，其subevent字段设为[]。
**注意检查原事件的完整事件重写是否和原分解事件对应的完整事件对应,因为我后续将依据此更改事件序列**
---
数据：
原分解后事件序列{plan}
原分解事件对应的完整事件{back}
**今日日期{date}**
---
最终输出和原事件中背景事件一样的完整事件，而非分解事件。
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。description字段为对事件的描述。participant字段为参与者姓名和关系，要与画像中地name字段和relation字段相同。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物，优先从已有关系数据选择。location字段描述所处城市和POI类别信息。subevent对应下一层事件，你可以理解为若没有子事件，则原子事件即为下一层事件，subevent数组即为该事件的原子事件数组，原子事件的subevent为空数组[]。若有子事件，则该事件的subevent为子事件，子事件的subevent为原子事件。注意event_id的层级关系，上层事件分解为下层事件时，下层事件id为上层事件的id-序号。注意原子事件的事件粒度必须小于等于一天，但是原子事件可以多次发生，如每月聚会的date应写成[2025-01-01,2025-02-01,2025-03-01]而非[2025-01-01至2025-03-01]。最上层原事件的id保持原本不变。对于原有事件eventid保持不变，对新增事件最上层事件的eventid为0。starttime为起始时间，endtime为结束时间，以XX-XX-XX XX:XX:XX的形式给出。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "event_id":"1"
          "name": "事件名称",
        ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00",](date应为今日日期)
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},{{"name":"","relation":""}}]
          "location":"（POI大致描述）",
          "subevent"：[
          {{
            "event_id":"1-1"
            "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00",],
            "type": "",
            "description":"（描述）",
            "participant":[{{"name":"","relation":""}},{{"name":"","relation":""}}]
            "location":"（POI大致描述）",
            "subevent":[]
          }},
          ]
        }},
        
      ]
'''

template_get_event_1 = '''
请基于提供的今日事件，对比分析其与原有规划事件的差异，明确具体改动内容。需严格围绕原规划事件序列:{plan} 生成操作指令，仅针对序列内事件提出修改、删除等操作（不关心新增），禁止包含与该序列无关的操作；若无需改动，可直接输出 []。生成时可结合个人思考字段中提及的事件修改明细列表(仅参考)，然后你可再度思考如何重新安排原规划事件，只有严重冲突，难以调整的情况下选择删除事件，否则尽量推迟事件或调整事件时间避免冲突，**尽量不进行delete删除**。
具体操作步骤如下：
1. 信息匹配与改动分析：以「此前生成的全天事件」为基准，结合历史思考过程，对照「原规划事件序列」，逐一找出与之对应的原规划事件。重点分析两者的相同部分以建立对应关系，明确原事件是否存在改动（如时间变更、地点变更/详细化、内容调整等）或被删除；特别注意：被推迟至今日之后发生的原规划事件，也需判断是否需纳入操作范围。
2. 操作生成原则：仅针对原有规划事件的改动或删除情况生成操作指令，未受影响的事件无需体现。event_id一定要对应原规划事件序列的id。

---
数据：
今日事件{content}
个人思考{thought}(个人对今日安排的思考，不一定都采纳了，可以参考)
---
最终输出操作指令数组，每个操作包含"type"和"event"字段。"type"为"delete"或"update"（update为推迟（修改时间）或修改，delete为删除（只要当日事件发生了就没删除，个人思考不一定被采纳，所以仍需对照今日事件分析是否被保持））；"event"为事件对象，其中删除操作的事件需包含能唯一标识的event_id，修改操作的事件需包含修改后完整信息,未修改信息要保持（仍以event_id匹配原事件）。事件推迟要修改时间时，**注意其date字段一定要是”XX-XX-XX XX:XX:XX至XX-XX-XX XX:XX:XX“的格式，如["2025-01-02 09:00:00至2025-01-02 10:00:00"]，"至"不可缺少。

仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等字段.示例：
[
{{"type":"delete","event":{{"event_id":"1"}},"description":"改动描述"}},
{{"type":"update","event":{{"event_id":"2-1","name":"修改后事件名","date":["2025-01-01 09:00:00至2025-01-01 10:00:00"],"type":"Career & Education","description":"修改后描述","participant":[{{"name":"张三","relation":"同事"}}],"location":"详细地址","subevent":[]}},"description":"改动描述"}}
]

'''

template_get_event_2 = '''
分析所有不在**已有规划事件列表：{plan}**中的新增事件，在已有规划事件列表中的事件已经推理过后续，不用分析后续。只针对新增事件推理后续，判断其是否有存在后续的事件（如网购需后续收货），若需后续事件，请思考并生成完整的后续事件流程，并规划后续事件发生的，今天之后的具体日期，再将该系列事件整合为含后续环节的整体事件；
单日发生的整体事件无需拆分，其subevent字段直接设为空[]；仅含发生在不同天的后续事件的整体事件需包含subevent结构，且子事件按 “一天一个” 原则拆分（同一天内的多个关联操作需合并为一个子事件，不可拆分）。示例：完整事件 “网购” 的子事件为 ["下单与沟通卖家（2025-01-01）","收货（2025-01-03）"]。
输出的事件不超过两个，且一定不要与已有规划事件列表中的事件相似。
最终输出分析提取出的有后续事件组成的层次完整事件，若没有可输出空数组[]。不要强行设计后续，要自然，只有必须有后续的才考虑输出。
**若修改日期，其格式要严格遵守["XX-XX-XX XX:XX:XX至XX-XX-XX XX:XX:XX"],如（"2025-01-01 08:00:00至2025-01-01 09:00:00"）
**今日日期{date}**
**关于后续事件的推理，你可以进行润色修改其过程，使其不要产生较大后续影响，不要出现人事变动，画像改变等问题。（如XX提出离职，后续事件可以是交流后涨薪，最终没有离职。）一些没必要有后续的事件（可有可无）就不用推理输出。
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。description字段为对事件的描述。participant字段为参与者姓名和关系，要与画像中地name字段和relation字段相同。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物，优先从已有关系数据选择。location字段描述发生的详细地址。date以XX-XX-XX XX:XX:XX的形式给出（如2025-01-01 08:45:00）,由于其可能多次发生，以数组的形式展现，发生一次则为["XX-XX-XX XX:XX:XX"]。所有上层事件的eventid均为0。subevent为对完整事件的分解，同一天的事件不要分解，不同天的同一件事才要分解组织，subevent为[]。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，输出后请检查json格式是否没问题，符号对应是否没缺失。格式示例如下：

      [
        {{
          "event_id":"0"
          "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00",]
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},]
          "location":"详细地址",
          "subevent"：[
          {{
            "event_id":"1-1"
            "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00",],
            "type": "",
            "description":"（描述）",
            "participant":[{{"name":"","relation":""}},{{"name":"","relation":""}}]
            "location":"详细地址",
            "subevent":[]
          }},
          ]
        }},
        
      ]
'''

template_get_event_2_copy = '''
请基于提取的与已有规划事件完全不同的新增事件，按以下思路组织分析并生成完整事件格式数据：
分析其中事件是否确定不在**已有规划事件列表：{plan}**中，在已有规划事件列表中有的事件不用分析后续。只针对新增事件推理后续，已有规划事件已经推理过后续了。
分析新增事件中的事件（包括描述中的细事件）是否有存在后续的事件（如网购需后续收货），若需后续事件，请思考并生成完整的后续事件流程，并规划后续事件发生的，今天之后的具体日期，再将该系列事件整合为含后续环节的整体事件；
单日发生的整体事件无需拆分，其subevent字段直接设为空[]；仅含发生在不同天的后续事件的整体事件需包含subevent结构，且子事件按 “一天一个” 原则拆分（同一天内的多个关联操作需合并为一个子事件，不可拆分）。示例：完整事件 “网购” 的子事件为 ["下单与沟通卖家（2025-01-01）","收货（2025-01-03）"]。
新增的需要组织的有后续事件不要超过三个，若过多请你重新描述事件执行方式，使其能在今日完成并不组织成层次事件（被拒绝或因意外搁置、放弃、更改描述）。
最终输出事件个数不超过20个。当事件比较多，20个展现不完所有信息时，可合理合并事件，或根据地点，时间就近合并，使其少于20个，优先保证信息全面覆盖,不遗漏任何事件和细节，一些细微事件（无后续）也可根据地点时间就近合并。只有完整事件不可以合并，需要独立展现主题。注意不同时间和地点的事件合并后，每个事件单独的发生时间和地点要在描述中明确。不可遗漏信息。
最终输出1）提取出的有后续事件组成的层次完整事件 2）所有其他剩余事件。（其他事件不需层次结构，因为都是本日进行的，按原事件的描述和格式输出即可，其subevent为[]）
**今日日期{date}**
---
最终输出新增事件的完整事件序列，而非分解事件。
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。description字段为对事件的描述。participant字段为参与者姓名和关系，要与画像中地name字段和relation字段相同。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物，优先从已有关系数据选择。location字段描述发生的详细地址。date以XX-XX-XX XX:XX:XX的形式给出（如2025-01-01 08:45:00）,由于其可能多次发生，以数组的形式展现，发生一次则为["XX-XX-XX XX:XX:XX"]。所有上层事件的eventid均为0。subevent为对完整事件的分解，同一天的事件不要分解，不同天的同一件事才要分解组织，subevent为[]。

仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，格式示例如下：

      [
        {{
          "event_id":"0"
          "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00",]
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},]
          "location":"详细地址",
          "subevent"：[
          {{
            "event_id":"1-1"
            "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00",],
            "type": "",
            "description":"（描述）",
            "participant":[{{"name":"","relation":""}},{{"name":"","relation":""}}]
            "location":"详细地址",
            "subevent":[]
          }},
          ]
        }},

      ]
'''

template_get_event_3 = '''
请基于「此前生成的全天事件列表」，对比今日已有规划事件{plan}，提取不在今日已有规划事件中的所有事件，并生成新的格式化事件序列，具体要求如下：
1）事件提取规则：从 “时间区间 + 描述” 中先单独提取并去除已有规划事件的部分，然后重新优化调整，组织描述，需完整覆盖所有剩下的信息，能反映全天生活状态；
2）主题合并与拆分：同主题同地点的相关事件和连贯事件、因果事件可进行合并，然后总结描述，（如9：00到10：：00在准备材料，11：00-12：00在开会，可合并为工作处理事件，然后在描述中详细结束每个事件的过程。）；若一个时段包含不同主题事件（如同一时段内有 “联系同事"（工作主题） ," 材料制作”（工作主题）与 “网购”（个人生活主题）），可选择性拆分。
3）结果限制：**最终输出事件仅保留不在「已有规划事件」中的新增事件**，且个数不超过20个。当事件比较多，20个展现不完所有信息时，可合理合并事件，并减少拆分，根据同地点，就近时间合并，使其少于20个，优先保证信息全面覆盖，然后保证不同事件间的主题尽量鲜明，不同。一些细微事件（无后续）也可根据地点，时间就近合并。凡是不可能产生手机使用相关场景的事件，直接依据地点时间就近合并，不单独提取。通勤通行相关事件也就近合并，其信息要在描述中明确。
**今日日期{date}**
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。description字段为对事件的描述。participant字段为参与者姓名和关系。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物。location字段描述出发生的详细地址。date以XX-XX-XX XX:XX:XX的形式给出（如2025-01-01 08:45:00）,由于其可能多次发生，以数组的形式展现，发生一次则为["XX-XX-XX XX:XX:XX"]。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，输出后请检查json格式是否没问题，符号对应是否没缺失。格式示例如下：

      [
        {{
          "event_id":"1"
          "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00","2025-01-02 08:00:00至2025-01-02 09:00:00"]
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},{{"name":"","relation":""}}]
          "location":"详细地址",
          ]
        }},

      ]
------
此前生成的全天事件列表：{content}
**已有规划事件{plan}**
位置参考数据{poi}
'''

template_get_event_31 = '''
请基于「此前生成的全天事件列表」，提取并生成新的格式化事件序列，具体要求如下：
1）事件提取规则：从 “时间区间 + 描述” 中对事件描述和标题进行优化调整，组织描述，需完整覆盖所有信息，能反映全天生活状态；
2）最终输出事件个数不超过20个。当事件比较多，20个展现不完所有信息时，可合理合并事件，优先根据就近时间合并，然后根据同地点合并，使其少于20个，优先保证信息全面覆盖。
**今日日期{date}**
---
输出格式严格要求,type字段为Career & Education，Relationships，Living Situation，Social & Lifestyle，Finance，Self Satisfy/Care & Entertainment，Personal Growth，Health & Well-being,Unexpected Events,Other之一。description字段为对事件的描述。participant字段为参与者姓名和关系。如果是自己则可以为{{"自己名字","自己"}},如果关系数据中没有合适地人可编造一些人物。location字段描述出发生的详细地址，参考poi数据来描述。date以XX-XX-XX XX:XX:XX至XX-XX-XX XX:XX:XX的形式给出（如2025-01-01 08:45:00至2025-01-01 09:45:00）,由于其可能多次发生，以数组的形式展现，发生一次则为["XX-XX-XX XX:XX:XX至XX-XX-XX XX:XX:XX"]。
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段，输出后请检查json格式是否没问题，符号对应是否没缺失。格式示例如下：

      [
        {{
          "event_id":"1"
          "name": "事件名称",
            ”date“:["2025-01-01 08:00:00至2025-01-01 09:00:00"]
          "type": "",
          "description":"（描述）",
          "participant":[{{"name":"","relation":""}},{{"name":"","relation":""}}]
          "location":"详细地址",
          ]
        }},

      ]
------
此前生成的全天事件列表：{content}
位置参考数据{poi}
'''


template_reflection = '''
请以「我」的第一视角展开叙述，先完整梳理并代入今日发生的所有事件（可按时间顺序或重要程度呈现关键场景），再结合以下维度自然融合表达，无需刻意罗列：
- 核心感受：基于今日经历产生的真实情绪（如充实、疲惫、治愈、遗憾等），可结合具体事件说明情绪触发点；
- 自我洞察：关联自我认知、过往记忆（如某件事让你想起过去的经历）、近期规划，分析今日事件对自身状态的影响（包括洞察出康复、事件完成等结束状态，防止之后没有察觉继续执行）；
- 事件记忆：今日事件的描述中有提到什么后续事件吗（如预约了明天的某某服务，准备周末联系某某等），记录下这些事件。同时思考是否有记忆相关内容已达到预定日期，需从想法里删除。
- 想法反思：指对今日及近期相关事件的思考与感悟，可包含但不限于以下参考方向（无需全部考虑，根据实际感受选择）：回忆1-2件印象最深刻的事并简要评论，或反思今日待改进之处；总结近期活动规律（如“很久没和朋友聚餐，这周外卖有点频繁”）；基于近期持续行为提出结果和发展（如“最近坚持每天跑步30分钟，应该瘦了2斤左右”）；提出未在今日规划中出现的尝试方向（如“下周可以去家附近新开的书店看看”），或提炼今日获得的小经验；对长期进行的事项给出判断等。注意凡是与未来有关的想法，必须明确其发生日期，如2025-XX-XX。最终按以下格式输出
{{
            "date": "XX-XX-XX",(格式为XX-XX-XX，如2025-01-01，请依据今日日期填写)
            "topic": "（描述今天活动的主要主题有哪些，将作为衡量不同天相似度的依据）",
            "events": "即今日事件的所有内容,请组织为一段话，同时明确发生日期,注意，你要清楚全面地描述今天地所有事件，不要遗漏任何信息，包括细节事件。",
            "thought": "你对今日事件体验后的感受和想法，一段话描述。"
}}
今日事件{content}
自我认知{cognition}
记忆{memory}
近期规划{plan}
今日日期{date}

输出格式严格要求,仅输出JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段.
'''

template_get_poi = '''
请基于个体当日生活事件和轨迹信息及过往画像信息，按以下规则输出今日移动轨迹，确保信息精准、符合地图搜索逻辑：
POI 数组要求：
内容需为当日实际移动涉及的地点，不得包含笼统概念，需能在地图 APP 中搜索定位（如 “上海市浦东新区八佰伴商场”“北京市朝阳区 XX 路 XX 号（住址）”）；
地址精度：优先提取画像中明确的详细门牌号（如住址、工作地需精确到 “XX 路 XX 号”），无门牌号时填写具体地点名称 + 类型（如 “杭州市西湖区银泰商场”“深圳市南山区火锅店”），模糊类别需前置所属城市行政区；
合理性修正：对原文本中不合理的 POI（如 “家族宴会厅”）进行重写，替换为地图可搜的具体地点（如 “XX 市 XX 区 XX 大酒店”）；粒度仅细化到建筑层级或POI类别，无需标注建筑内具体区域（如 “XX 路 XX 号（家）” 即可，无需写 “家中客厅”）。
输出要求：
**仅输出JSON格式内容，直接以{{}}作为开头结尾，不添加任何额外文本、注释或代码块标记。不要输出```json等无关字段。transport数组第i个元素代表从第i个poi到第i+1个poi的交通方式，所以其数组长度应比poi数组长度小1。**格式示例如下：
{{
"poi":[],（对于连续在同一个位置的可合并）
"city":[],（poi对应城市）
"transport":[]（地点间的交通方式,只允许"driving", "walking", "transit"，"bicycling"（即驾车，步行，公共交通，骑行）四种）(**注意：第i个元素代表从第i个poi到第i+1个poi的交通方式，数组长度应比poi数组长度小1**)
}}
画像：{persona}
'''

#事件推理第一轮：追求全面多样
template1_1 = '''
请根据以下人物画像，为其构建2025年**完整365天周期内**最符合其身份、性格、职业与生活习惯的**综合生活主题事件**。此类事件需区别于“超长期项目（超过一个月）”和“高频周期性习惯”，聚焦非日常性、多维度的生活场景，所有内容必须真实可感、符合现实逻辑。

---
主题事件核心定位与要求
本类事件需与“超长期项目（超过1个月）”和“高频周期性习惯”生成内容形成互补框架，重点覆盖：非高频周期性的单次/多次事件、有明确起止的中短期事件（持续时间一个月以内）、重要转折/意外/纪念性事件，需满足以下具体要求：
1. 数量与维度覆盖：主题事件数量不少于80个，需全面覆盖9大生活维度：① 工作学习（如项目任务、会议、培训、考虑该职业涉及的各种事务）；② 个人发展（如晋升、调岗、考证、求职、升学等）；③ 家庭亲密关系（如家人重要事项、团聚活动、矛盾处理等）；④ 休闲娱乐（如旅行、观影、演唱会、兴趣体验等）；⑤ 自我提升（如短期课程、技能集训等）；⑥ 社交参与（如朋友聚会、社区活动、行业交流等）；⑦ 特殊节点（如节日庆祝、生日纪念、纪念日等）；⑧ 意外/突发/重大事件（如生病就医、设备维修、紧急事务等）；⑨生活重要事件（如跨地域出游、人生里程碑筹备、重要物品购置/处置、特殊体验活动等）；
2. 时间特性规范：① 事件可横跨多日（1天至3个月内），允许与其他事件时间重叠（例：“海南度假（2025-02-10至2025-02-17）”与“远程处理工作邮件（2025-02-12至2025-02-12）”）；② 周期性事件仅保留“月及以上跨度”（如每2个月部门团建、每季度财务复盘），需在“起止时间”数组中列出每次具体日期，不重复拆分事件；③ 排除“每周/每天频率”的日常性事件（如每日通勤、每周健身），避免与高频周期习惯内容重复。
3. 画像契合度与真实性：事件必须紧密匹配人物的职业（如教师的“期中监考”“家长会”）、年龄（如中年人的“父母体检”）、性格（如外向者的“朋友生日派对”）、经济能力（如职场新人的“平价游”）、家庭状况（如育儿家庭的“孩子入园准备”）、健康状况（如过敏体质的“换季就医”）等属性；可加入合理逻辑关联事件（如“获得年度优秀员工”后衔接“晋升答辩”“岗位调岗”），避免脱离现实的虚构内容。
4. 事件分布与冲突检查：① 按生活重心合理分配事件数量（如职场人士工作相关事件占比40%-50%）；② 输出前需核查：无时空冲突事件（如同一人不可同时出现在“北京出差”与“上海同学聚会”）、无重复重大事件（如“结婚”仅出现一次）、无违和事件（如学生出现“商务谈判”），确保事件逻辑自洽。
5. 我给出的例子只是参考，请你推断更多相似方面，增强生成的多样性。   

---
人物画像如下
{persona}
'''
#事件推理第二轮：追求补充和多样
template1_2 = '''
请根据人物画像及第一轮生成的事件，为其额外补充2025年**完整365天周期内**符合身份、性格、职业与生活习惯的**生活主题事件（第二轮）**。核心用于填补时间空白与主题盲区，与第一轮事件形成互补。同时对第一轮事件进行拓展丰富。

---
主题构建要求
1. 延续与补全原则：严格遵循第一轮事件的主题构建要求，覆盖工作、生活、社交、娱乐等全维度，重点补充第一轮未充分涉及的场景主题。同时分析第一轮事件涉及的主题是否仍可以进行扩展丰富。事件不要过于日常，非周期性事件占比不少于60%。
2. 时间与多样性优化：① 填补时间空白——确保全年无连续7天以上无事件，重点补充第一轮事件稀疏的月份；② 丰富事件类型——工作场景可增加更多细分事件，娱乐场景可补充更多元体验，社交场景考虑更多关系和可做事件等。使主题事件多元化。
3. **排他性要求：输出事件需与第一轮完全不同，不得重复事件。**
4. 数量与分布：主题事件数量不少于60个，优先补充工作（40%）、社交（20%-25%）、生活（20%-25%）类事件，平衡长期事件与短期事件占比。

---
输出格式严格要求
与第一轮一致：仅输出JSON格式内容，直接以[]开头结尾，“主题事件”为字符串，“起止时间”为数组（单日格式“2025-04-05至2025-04-05”，多次事件列全具体区间），不添加任何额外文本。
'''
#事件推理第3轮：细节丰富
template1_3 = '''
请根据人物画像及前两轮生成的事件，为其额外补充2025年**完整365天周期内**符合身份、性格、职业与生活习惯的**生活主题事件（第三轮）**。核心用于强化人群共性与画像深挖，提升事件密度与真实感。

---
主题构建要求
1. 多维融合原则：① 人群共性事件——结合人物的性别/年龄/地域/人生阶段的标签进行推理生成常见事件（如年轻女性可推理出注重皮肤保养）；请你推理出至少3个人群标签。② 通用生活事件——加入如“换季衣物收纳整理”“人情往来送礼”“家居小改造”等人类通用场景；③ 画像深挖事件——基于画像未充分利用的信息（如隐藏技能、亲友职业）生成关联事件（如“陪医生家人值夜班送饭” “带摄影爱好者同事外拍采风”）。请分析画像中有哪些未利用信息。④可生成一些具体短期事件/日常事件（如个人工作过程的某个具体事务，生活的某个情节）和第一轮生成的事件互为补充。⑤根据画像补充工作、生活、社交、娱乐等全维度主题事件。
2. 补全与逻辑化原则： ①主题多样化——针对工作/生活/社交/娱乐四大核心维度，补充更多具体事件，避免内容同质化，单一化。② 事件连贯性——复盘前两轮事件，补充关联性后续场景（如前两轮有“陪朋友挑选婚纱”，需新增“参加朋友婚礼”；有“新房装修”，需新增“装修后通风散味”），杜绝逻辑断裂的孤立事件。
2. 事件类型拓展：新增“日常事件”（如“修电脑”“买换季衣服”"加班做项目"）、“轻微意外事件”（如“钥匙丢失配锁”“快递损坏维权”），与前两轮的重要事件形成梯度；确保覆盖至少10个不同主题。
3. 排他性与协调性：输出事件与前两轮完全不同，无时空冲突；事件数量不少于60个，工作/生活/家庭类事件占比不低于50%，工作和非工作事件数量分布要合理，事件时间分布上要合理。休闲娱乐等活动要多样。
4. 最终核查：输出前需检查：① 无重复/违和事件；② 与前两轮事件无时空冲突；③ 全年事件密度合理，有忙的时间和清闲的时间，每天事件平均两个左右，符合真实生活节奏。

---
输出格式严格要求
与前两轮一致：仅输出JSON格式内容，直接以[]开头结尾，“主题事件”为字符串，“起止时间”为数组（严格遵循“2025-04-05至2025-04-07”格式），不添加任何额外文本。
'''


#周期性事件生成
template2 = '''
请根据以下人物画像，描述符合其身份、性格、职业与生活习惯的2025年一年生活特征。核心通过生成**周期性生活主题事件**，具象化呈现个人生活规律与特质，所有内容需满足真实可感、逻辑自洽、高度贴合画像的要求。

---
主题事件构建核心维度与要求
1. 周期类型限定：仅聚焦以“周/月”为频率的周期性事件，需覆盖四大核心维度：① 基础生活轨迹（如职业相关固定日程）；② 长期习惯养成（如健身、阅读）；③ 周期性任务/目标（如工作汇报、技能学习进度）；④ 社交与兴趣安排（如聚会、爱好实践）。
2. 频率描述规范：可明确具体时间的事件，需在“频率”字段精准标注（例：每周一/周三/周五、每月5号/20号）；无法固定具体日期的，标注通用频率（例：每周两次、每月一次）。
3. 画像契合度要求：事件必须紧密关联人物的职业（如程序员的“每周代码复盘”）、年龄（如大学生的“每周课程学习”）、性格（如内向者的“每周独处阅读”）、经济能力（如中等收入者的“每月一次轻奢聚餐”）、家庭状况（如已婚者的“每周家庭采购”）及兴趣爱好（如摄影爱好者的“每月户外采风”），可基于画像进行合理现实推断，避免脱离人设的行为设计。
4. 数量与合理性平衡：需生成至少5个主题事件，确保覆盖生活各维度且不过于密集（例：每周事件不超过4个，避免时间冲突）；事件间需符合现实时间分配逻辑（如“每天加班到深夜”与“每天晨跑”不建议同时出现）。

---
输出格式严格要求
仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。格式示例如下：

      [
        {{
          "主题事件": "职场通勤",
          "频率": "每周一至周五7:30-8:30"
        }},
        {{
          "主题事件": "健身撸铁",
          "频率": "每周二/周四/周六19:00-20:30"
        }},
        {{
          "主题事件": "月度工作汇报",
          "频率": "每月最后一个周五15:00-16:00"
        }},
        {{
          "主题事件": "家庭聚餐",
          "频率": "每月第一个周日"
        }}
      ]
    

---
人物画像如下
{persona}
'''
#长期事件生成第一轮：推理可能事件
template3_1 = '''
请根据以下人物画像，为其生成2025年**完整365天周期内**可能发生的长期事件，需满足真实感、逻辑性与细节丰富度要求。
示例：备考PMP
- 步骤1：报名与资料准备（2025年2月10日-2月28日）→ 目标：完成PMP考试报名，购买《PMBOK指南》及线上课程，制定每日2小时学习计划；
- 步骤2：第一阶段理论学习（3月1日-4月30日）→ 目标：学完“范围管理/时间管理”等6大知识领域，每周完成1套章节练习题（因4月15日-4月20日加班，暂停学习5天）；
- 步骤3：模拟题冲刺训练（5月1日-5月20日）→ 目标：完成10套历年真题，整理错题本，重点攻克“风险管理”薄弱模块；
- 步骤4：参加考试（5月25日）→ 目标：按时赴考，合理分配答题时间；
- 步骤5：成绩查询与证书申领（7月10日-7月15日）→ 目标：查询考试结果，通过后提交证书申领资料（若未通过，计划2026年3月重考）。

---
核心要求
1. 长期事件定义：指持续时间≥7天、需分阶段推进的目标/项目/任务（如工作项目、备考计划、技能学习、人生大事筹备等），需体现“断断续续执行”或“阶段性攻坚”的真实状态，避免流程化线性推进。
2. 拆解与时间分配：每个长期事件需拆解为3个以上的具体原子事件，每个原子事件需明确：① 具体行动内容（含可落地细节）；② 起止时间（精确到“月-日至月-日”，时间间隔需合理，允许存在空窗期）；③ 该步骤的核心目标（如“完成竞品调研→明确项目差异化方向”）。
3. 事件数量与多样性：需生成5-12个最合理，最可能发生的长期事件，考虑人物画像中的核心维度（如职业/生活/学习/社交等）；事件起始时间随机分布在2025年1-12月，允许事件跨年未完成（需标注“2025年未完成，持续至2026年X月”）。持续时间大于1个月的事件至少有3个。
4. 真实场景约束：需结合人物画像中的基础属性（如年龄/职业/城市/标签）设计事件，避免脱离现实（例：学生不设计“年度商务谈判项目”，无骑行爱好不设计“环青海湖骑行筹备”）；可加入轻微意外干扰（如“因加班推迟资料整理”“生病暂停学习1周”）增强真实感。长期事件的执行可能遇到一些意外和紧急事件或波折，避免流程化的线性推进。
5. 多样性增强：需覆盖多时间维度的长期事件，形成梯度化分布。具体包括：短期长期事件（持续1-2周，如线下活动筹备、周末集训营）、中期长期事件（持续1-3个月，如论文投稿筹备、职业资格证冲刺复习）、长期长期事件（持续3个月以上，如备战高考、新房装修全程），确保不同时长的事件类型均有涉及，丰富全年事件的时间跨度层次。


---
长期事件参考方向
- 职业类：公司重点项目落地（如“Q2新品营销 campaign 筹备 新产品研发项目”）、职业资格备考（如“CPA考试复习计划”）、跨部门协作任务（如“企业数字化转型调研”）；
- 生活类：人生大事筹备（如“婚礼策划与执行”“新房装修”）、技能学习（如“从零学吉他→完成首支弹唱”）、深度兴趣实践（如“马拉松备赛训练”“年度骑行挑战路线规划”）；
- 成长类：学历提升（如“在职研究生申请与备考”）、个人品牌打造（如“小红书账号从0到1万粉运营”）、重要关系维护（如“筹备父母金婚纪念活动”）。
**人物画像如下：** 
{persona}
'''
##长期事件生成第二轮：事件筛选与融合
template3_2 = '''
请结合以下已生成的个人2025年非长期事件，对首轮产出的长期事件进行系统性筛选、有机整合与细节优化，最终输出时间排布紧凑合理、精力分配科学均衡、内容无逻辑冲突的长期事件列表。
--- 核心要求 ---
1. 数量与精力匹配：需结合个人全年工作生活密度，综合评估时间与精力上限，最终保留2-5个核心长期事件。避免因事件数量过多导致执行矛盾，例如同一时间段内并行推进3个以上高强度项目（如备考、重大工作项目、大型活动筹备），确保各事件在时间周期上有合理缓冲。优先筛选最有可能发生的长期事件。
2. 冲突与重复处理：重点分析已生成非长期事件与首轮长期事件的关联性，仅针对内容相关或主题重复事件进行整合（避免不整合导致的内容违和）：若存在相似事件（如“非长期事件‘参加插花体验课’”与“长期事件‘系统学习插花’”），需修改长期事件步骤，将非长期事件作为原子步骤自然融入（例如将体验课设定为“入门认知阶段”的核心行动）；若无非相关非长期事件，则直接保留首轮长期事件原步骤。整合过程中不得删除首轮原步骤，可通过微调时间节点（如提前/延后1-2周）实现流程连贯，避免生硬拼接。不要为了整合其他事件过度修改原事件。
3. 细节优化与逻辑自洽：筛选后的长期事件需逐一审验时间线连贯性（如阶段间隔是否合理、是否存在时间断层）与步骤合理性（如行动难度与个人能力是否匹配）。针对整合调整部分补充具体细节，例如因融入非长期事件导致的学习计划调整、阶段目标量化更新等，确保每个原子事件的行动内容、时间节点、核心目标与非长期事件形成互补而非冲突，整体贴合个人真实生活节奏。
4. 事件分解明确：长期事件的分解事件既可为按时间推进的连贯顺序事件（如“资料准备→理论学习→冲刺训练”），也可为围绕核心目标的相关联事件（如“健身计划中的‘力量训练’‘有氧训练’‘饮食管理’”），但需保证各分解事件均服务于长期事件的最终目标，且行动逻辑清晰可追溯。
5. 新增事件：若首轮长期事件存在人物画像核心维度（如职业发展、生活规划、技能提升等）覆盖不足的情况，或已生成长期事件质量不足，可结合已生成非长期事件的风格内容与个人属性，自行新增1-2个合理的长期事件。新增事件需符合“持续时间≥7天、分阶段推进”要求，且与现有事件无时间冲突、精力分配无矛盾，行动细节贴合个人真实场景。
6. 输出时请明确该长期事件包含和整合了哪些已生成非长期事件及其起止时间。主题要具体，分解事件不是并列关系，是逻辑连贯的关系。
已生成事件如下： {content}
'''
##长期事件生成第3轮：事件分解，粒度对齐到周。
template3_3 = '''
请根据你已筛选优化后的长期事件列表，对每个长期事件进行更具体化的步骤分解，需严格遵循真实场景逻辑与时间合理性要求，最终按指定格式输出分解结果。
--- 核心分解要求 ---
1. 步骤时长限制：每个分解的主题事件持续时长不得超过7天（≤一周），支持“单日完成”或“多日连续完成”两种设计形式，起止时间需精确到“年-月-日至年-月-日”，格式统一且无歧义。
2. 分解数目与合理性：结合长期事件的总时长与实际执行流程确定分解步骤数，例如：持续1个月的事件可分解为4-5个步骤，持续3个月以上的事件可分解为10-15个步骤。需避免分解过粗（如合并多个独立行动）或过细（如拆分单一简单任务），确保每个步骤均为独立、必要的行动单元。
3. 时间连贯性与灵活性：分解步骤的起止时间需完全落在对应上层长期事件的总时间周期内，步骤间可保留合理间隔（如周末休息、临时事务处理），整体形成连贯时间线。允许对步骤时间进行微调优化，长期事件无需在周期内不间断推进，可在分解事件间合理设置真空期，但也可连续执行，单个分解事件也可根据实际场景小幅延长或短暂中断（需符合真实执行节奏）。
4. 内容真实性与关联性：主题事件需贴合现实场景，行动内容具体可落地（示例：“收集3家核心竞品近3个月价格数据”而非“开展竞品调研”），避免空泛表述。同时，主题事件描述需隐含与上层事件的关联，让人直观理解其归属（如“新店选址备选区域实地考察”可明确关联“新店筹备”），确保每个步骤符合人物身份与事件推进逻辑。
--- 输出格式要求 ---
严格按照以下JSON数组格式输出，其中“上层事件”需与所给长期事件的主题完全一致，主题事件描述需体现与上层事件的关联性，仅输出JSON格式内容，直接以[]作为开头结尾，不添加任何额外文本、注释或代码块标记。格式示例如下：：
[
  {
    "主题事件": "新店年度工作规划会议",
    "起止时间": ["2025-01-08至2025-01-09"],
    "上层事件": "新店筹备"
  },
  {
    "主题事件": "孩子小学入学报名",
    "起止时间": ["2025-05-10至2025-05-10"],
    "上层事件": "孩子入学"
  }
]

'''
#逐月对上述生成三类事件进行融合调整，通过具体化时空属性判断时空逻辑。
template_gen = '''
请参考用户画像、生活特征习惯数据、上月事件数据，对本月日程事件数据进行逐天分析，通过具体化、调整、增删等操作，消解不合理之处，生成合理真实丰富的日程事件数据。
--- 输出格式要求 ---
严格遵循以下JSON对象格式输出，直接以大括号开头结尾，不得添加```json```标记或额外说明文字：
{{
  "2025-10-01": {{
    "事件": ["每月闺蜜聚会", "季度家庭大扫除"],
    "描述": "当天日程描述"
  }},
  "2025-10-02": {{
    "事件": ["高中同学聚会"],
    "描述": "当天日程描述"
  }}
}}
--- 核心说明 ---
1. 请先明确本月每日“日期-周几-工作日/休息日/法定假期”属性
2. 日程具体化与描述要求：需明确每日事件的发生地点（合理多样，如“公司会议室”“家附近超市”）、占用时间，描述需覆盖全天，补充事件衔接内容（如“早上9点从家出发去公司，18点下班后赴闺蜜聚会”），确保日程符合真实生活节奏，描述详细且逻辑连贯。
3. 操作权限与优先级：支持“调整日程事件时间”“新增事件”“删除事件”三类操作：① 优先通过调整事件起止时间、暂时中断后继续、缩短/延长时长、提前/延迟发生等方式，处理时空冲突与密度不合理问题；② 仅对内容逻辑严重不合理且难以调整的事件采取删除操作，删除后可新增事件补充多样性；③ 新增事件用于填补生活场景空白，使日程更完整。
4. 逐天校验维度：① 空间冲突：同一日事件的地点是否存在往返矛盾（如上午在上海开会、下午突然出现在北京逛街）；② 时间冲突：事件占用时间是否重叠且无法兼容（如同一时段既在办公室工作又参加线下活动）；③ 逻辑合理性：事件内容是否符合用户身份、能力与习惯（如不会游泳者不安排深潜活动，低收入者不频繁入住五星级酒店）。
5. 跨日时空衔接：分析用户跨日期的地点变化是否合理，包括交通方式与耗时匹配（如杭州到南京可当日往返，新疆到南京需预留交通时间），确保上一日与下一日的时空过渡自然，事件间体现合理的时间顺序或因果关系（如“前日提交项目方案”→“今日参加方案评审会”），避免孤立、跳跃。
6. 重复事件管控：针对重复/相似事件，校验间隔频率是否合理（如上月已有理发事件，本月需间隔20天以上）；结合历史事件，避免当前事件与其重复或矛盾，必要时进行删除或延期。
7. 工作日与休息日适配：描述中需明确周几，工作相关事件优先安排在工作日，休闲、社交等事件合理分配至休息日或工作日非工作时段，避免单日日程过于密集。
8. 跨月事件衔接：确保本月开始的事件与上月未完成事件连贯（如上月“新房装修设计”→本月“装修材料选购”）；本月末尾未完成事件需预留衔接空间，为下月继续推进做准备。
9. 事件与描述一致性：“事件”字段需与“描述”内容完全对应，描述中新增的具体事件需同步提取至“事件”数组中。
用户画像如下： {persona}
本月事件日程数据如下： {content}
用户生活特征习惯如下： {habit}
上月事件日程数据如下： {history}
下月事件日程数据如下： {future}
'''

#基于调整后的日程事件，分析事件密度，充实每日事件。
template_enrich = '''
请依据本月事件数据，为用户新增**本月内（{month}月）** 符合其身份、性格、职业与生活习惯的事件。新增目标为：1）衔接现有事件，填补逻辑断层，使日程更流畅；2）解决现有事件同质化问题（如工作类事件单一），提升事件多样性。3）从本月视角出发，更全面充实地描绘个人生活全貌。4)解决日程事件不丰富、密度不合理等问题。所有内容需真实可感、符合现实逻辑。
--- 输出格式要求 ---
严格遵循以下JSON对象格式输出，直接以大括号开头结尾，不得添加```json```标记或额外说明文字：
{{
  "2025-10-01": {{
    "事件": ["每月闺蜜聚会", "季度家庭大扫除"],
    "描述": "当天日程描述"
  }},
  "2025-10-02": {{
    "事件": ["高中同学聚会"],
    "描述": "当天日程描述"
  }}
}}
--- 说明 ---
1. 事件唯一性与逻辑性：新增事件不得与当月已有事件重复，且需避免与已有事件产生冲突（包括发生频率、间隔合理性及顺序逻辑冲突）。
2. 时间灵活性：事件可横跨多日，允许与其他事件时间重叠（例如“海南度假”期间同步“远程处理紧急工作邮件”），但重叠内容需符合现实场景（如高强度工作与休闲度假不可同时进行）。
3. 内容真实丰富：围绕用户本月工作、学习、生活、社交等维度生成具体事件，避免重复单调或过度理想化内容（如普通职员频繁参加高端酒会），增强生活真实感。同时请考虑本月的节假日期是否缺乏相关事件，本月有什么季节特点。
4. 频率与间隔管控：生成后需校验与已有事件的重复/相似性，协调发生频率与间隔。
5. 时间范围限定：仅生成起止时间完全在本月（{month}月）内的事件；同一天事件的起止时间需表述为“2025-04-05至2025-04-05”；多次发生的事件，在“起止时间”数组中依次列明每次的时间范围（如["2025-04-05至2025-04-07","2025-04-15至2025-04-17"]）。
6. 本月事件数据的已有事件都要保留，你只可以新增事件并优化描述。
7. 请体现忙碌日期（事件多）和清闲日期（事件不多），工作日（工作事件多）和休息日（多元化休闲，社交）。
8. 生成的事件不要与个人画像冲突，要合理真实。
**本月事件数据如下：**{content}
**个人画像：**{persona}
、
'''

template_decomposer = '''
请依据历史记忆，个人画像，本周事件日程，将本周事件详细具体地分解为原子事件。原子事件是指详细具体的事件。

--- 说明 ---
1. 原子事件是指粒度细，比较具体的事件。它可能是原事件的步骤流程，也可能是原事件的前置（准备/规划/起因/预定）/后续（产生了什么影响/收尾）事件，也可能是相关的事件。**原子事件的发生时间不一定发生在原事件起止时间内，起止事件只代表事件主体发生的时间。在添加前置/后续事件时日期可以放在起止时间之前/之后。**
2. 你需要分析每个事件，不同的事件重要性/复杂度/特殊性不同，涉及的流程长短，步骤难易，分解后事件数目也不同。
3. 请分析出不重要事件/日常工作生活等事件/会频繁发生/流程简单的事件，过滤掉这些事件，不进行分解。
4. 分解事件也要多样化，如不是所有事件都会经过准备/规划，也不是所有流程都一定会走完。同一类事件在不同时间不同地点执行时的流程和情景也不同。由于原事件的起止日期是个数组，即表示该事件可能在不同时间发生多次，所以每次的分解都要不同（既有共同的流程也有不同的情景）。
5. 历史记忆包括了历史相关事件的分解原子事件，可供参考，但一定要有不同。由于画像中社交关系字数过多，你可以先提取出有关人物然后生成。
6. 在分解生成时加入一些情景。描述时尽量详细具体，明确时间，场景。
7. 有些事件虽然持续时间长，但可能主要流程就发生在一天或者几天。由于持续时间是开始到结束时间但不代表这期间每一天都执行了该事件或做该事件有关的事。这之间可能有中断，所以你在分解时，不要求事件时间均匀分布，要按照真实情况和常理合理分布时间。
7. 若事件日程为空则输出空数组[]。

本周事件日程如下：{content}
历史记忆如下：{memory}
个人画像如下：{persona}
'''

template_decomposer_1 = '''
请依据历史记忆、个人画像及本周事件日程，将本周事件详细具体地分解为原子事件。原子事件需满足粒度细、场景清、动作实的核心要求。
一、原子事件定义与范围
原子事件指详细具体的细粒度事件，既可以是原事件的核心步骤流程，也可以是前置事件（如准备、规划、起因、预定等）或后续事件（如影响、收尾、复盘等）。原子事件的发生时间不限于原事件起止时间内，前置事件可安排在原事件起止时间之前，后续事件可延伸至之后，当然也可以安排在起止时间内。起止事件只代表事件主体发生的时间。
二、分解核心原则
1. 差异化分解：根据事件的重要性、复杂度、特殊性调整分解深度——重要/复杂/特殊事件可细化更多步骤，流程简单、高频发生的日常工作生活类不重要事件无需分解，直接过滤。
2. 场景多样性：避免同质化分解，并非所有事件都需包含“准备-执行-收尾”全流程；同一类事件有可能在不同时间/地点多次发生，分解需兼顾共同基础流程与差异化情景（如不同天气、不同协作人员、不同地点带来的细节变化）。
3. 参考与创新结合：历史记忆中相关事件的原子化案例可作为流程参考，但需在场景、动作细节上体现新变化，禁止完全复刻。个人画像中社交关系信息可先提取关键人物，再结合人物特征生成互动情景。
4. 时间合理分布：有些事件虽然持续时间长，但可能主要流程就发生在一天或者几天。由于持续时间是开始到结束时间但不代表这期间每一天都执行了该事件或做该事件有关的事。这之间可能有中断，所以你在分解时，不要求事件时间均匀分布，要按照真实情况和常理合理分布时间。不要为了给每日都安排事件把事件拆分的不符合人类习惯和逻辑。
5. 分解生成时需融入具体情景描述，每个原子事件的描述需明确发生时间（精确到日/时段）、具体场景细节，分解要兼顾详细多样。若本周事件日程为空，则直接输出没有事件。

本周事件日程如下：{content}
历史记忆如下：{memory}
个人画像如下：{persona}
'''

template_decomposer_json = '''
请你将你之前的输出的所有分解事件，规整为下面的json格式发给我。注意直接以括号开头，不要输出···json等无关字段。发生日期格式为"2025-01-01"。若事件为空则你继续输出空数组[]，不要有任何其他解释。
---输出格式---
[
{
"原子事件":"",
"发生日期":"",
"详细描述":"",
"原事件":""
}
]
'''

template_genatomic = '''
请依据历史记忆，个人画像，本天的日程事件,对未来一周的安排，详细具体地推理撰写该个人一天的生活原子事件。原子事件是指详细具体的事件。

--- 说明 ---
1. 原子事件是指粒度细，比较具体的事件。
2. 历史记忆包含了最近的详细生活，历史发生的事件，自己的反思与想法。请根据历史记忆合理调整当日日程，如分析某事件已经做到什么进度，当前应该怎么继续。某事件是否已经完成，不必重复。之前自己的想法/未完成事件，是否需安排时间进行。
3. 未来规划包含了未来七天的大概事件主题。请分析某事件当前应该怎么做，和未来安排相协调。
2. 你需要首先分析思考作为该个人自己最近做了什么，未来要做什么，最近和未来的安排是否足够，自己想做什么，今天要做什么，今天的日期是周几，今天会发生什么情景。然后基于此推理生成该个人一天可能的详细的生活。
3. 本日日程事件可能持续多天，本日只是其中一部分。本日日程事件只是一个预先规划，不代表一定发生也不代表合理。请你首先思考历史事件分析日程是否合理，是否需要新增删除事件，然后根据该日详细生活灵活调整日程事件地点甚至内容。生成事件后要分解事件，使事件详细具体，明确发生的时间和场景。
4. 本日详细事件表示本日事件在本日执行的详细步骤其他日事件在本日执行的前置/后续步骤。应尽量执行。但如果和本日安排有时空冲突，可以选择延后执行，请明确输出哪些事件安排到之后哪一天进行。
4. 基于画像合理插入各种可能的事件。一天的生活不止有日程规划的事件，每天会有不同的独特事件场景（日常事件/突发事件/需同时进行的事件等等可能性），不要每天都同质化。考虑事件密度，一天可能会做很多事。
5. 在详细化日程事件和其他事件时注意详细性和多样性。1）对比之前历史中可能作的类似事件，一些共同流程可以参考（如爱做的事），但情景要多样且不同（如上次去了某地，这次考虑不同地点）。2）事件要丰富多样，明确事件可能的发生地点和过程，事件细节过程都要描述清楚。3）考虑到生活真实感，插入各种可能的事件。

今天事件日程如下：{content}
未来一周安排如下：{plan}
历史记忆如下：{memory}
个人画像如下：{persona}
'''

template_genatomic_1 = '''
请基于历史记忆，个人画像，本天的日程事件,对未来一周的安排数据，以第一视角"我"的思考逻辑为起点，详细且具体地推理撰写某个人完整一天的生活原子事件。原子事件需满足粒度细、场景清、动作实的要求，需体现生活的真实感与独特性，避免同质化。
一、数据说明及前置分析要求（需先完成思考再生成事件）
1. 数据说明：历史记忆包含了最近的详细生活，历史发生的事件，自己的反思与想法。未来规划包含了未来七天的事件主题。详细事件指今天事件的详细步骤或其他日事件安排在今天完成的前置/后续步骤，在具体化详细事件时要参考详细事件的描述，你主要参考详细事件字段进行生成而非事件字段。
2. 时间锚点确认：明确当日日期及星期几，结合季节、天气等基础环境信息，为事件场景铺垫合理性（如雨天带伞、夏季晨跑更早等）。注意工作日有可能请假去做重要事件，休息日也可处理一些简单工作事件，可以考虑到一些生活的复杂性和多样性，对于事件多比较忙时完全可以在假期远程工作或加班。
3. 历史记忆关联：梳理记忆里"我"最近3-5天的详细生活事件、未完成事项及反思想法。需判断：①未完成事件的当前进度，今日是否需推进及推进步骤；②重复发生的事件是否需更换场景或细节；③反思中提及的调整需求是否需在今日日程中体现。④今日事件是否和历史数据冲突或违和。⑤是否有没做的事件。
4. 事件规划协调：结合未来事件和历史事件，思考日程安排是否合理，调整今日日程以避免与未来安排冲突。思考未来安排，是否有些事没做但也没安排在日程里（如提前预约等），进行提前处理，也可提前做一些未来规划事件。
5. 日程合理性调整：本日日程事件可能为多日持续事件的一部分，且预设日程仅为初步规划，不代表必然发生或完全合理。针对"本日预设日程事件"，需先判断其与历史记忆、未来规划的兼容性：①是否存在重复的已完成事件；②时间/地点是否与其他事件冲突；③**优先根据当日详细生活场景灵活调整日程事件的时间、地点甚至内容（**方法包括简化流程、并行处理、线上处理、事件合并、更改事件执行的地点，时间使其可以融入等**），将本日事件和详细事件尽可能多的合理的纳入当日安排；**④若因时空冲突问题事件无法当日执行，在输出完一天详细活动后，输出一段明确说明需延后至未来某天执行的事件及具体日期。选择延期时间时，要思考未来规划，有些事件是否紧急，必须执行，不能延期，则需作为紧急事件强行执行（加班，熬夜，放弃休闲等）。**针对需延迟处理的事件，应建立明确的优先级筛选机制：首先确保重要事件及作为其他事件执行基础的前置条件类事件优先连贯推进，避免整体流程受阻；而休闲娱乐、约会等对后续关键事务无直接影响的事件，则可灵活延迟至空闲时段再行安排。**
6. 事件灵活调整：可基于历史记忆、个人画像及当日实际场景合理生成符合逻辑的新增事件，同时删除与历史数据、未来规划或个人行为习惯存在明显矛盾的事件，确保全天生活事件的连贯性与合理性。针对删除的事件不需要延期。
7. 请优先根据本日事件和本日详细事件及其描述安排当日生活，再考虑多样性真实性等问题进行修改。对于详细事件请关注原子事件和详细描述。分析是否有些详细事件只占用短时间，并不消耗精力，完全可以在本日生活中完成，此外一些简单的详细事件可以合并在一起完成，无需延迟。

二、原子事件生成规范
- 时间颗粒度：事件需标注具体时间（精确到分钟，如"7:05-7:15"），连续事件需体现衔接逻辑。
- 场景与动作细节：每个事件描述需包含"地点+具体动作+感官/心理补充"，例如："8:20-8:35在公司楼下便利店买早餐，选了全麦三明治和热美式，付款时发现手机没电，用现金支付后匆匆走向电梯"，而非简单写"买早餐"。
- 多样性与真实性：除预设日程外，需插入非同质化的日常/突发/并行事件和其他各种可能发生的事件，如："10:10接到来电提醒家里水管漏水，联系物业约定下午3点上门维修"、"14:00-14:30午休时趴在桌上看了半集纪录片"、"19:40在小区门口遇到邻居，闲聊了5分钟关于宠物寄养的事"，或插入一些事件情景为之后的事件铺垫。当本日事件较多时优先安排本日事件，然后再考虑插入其他事件。不要因插入事件过多而减少本日事件的执行数目。
- 个人画像贴合度：结合人物的年龄、职业、爱好、性格等画像特征，设计符合其行为习惯的事件，避免出现与画像矛盾的场景（如不爱运动的人突然安排2小时高强度健身）。
三、输入数据与输出结构建议
### 输入数据描述
今天事件日程如下：{content}
未来一周安排如下：{plan}
历史记忆如下：{memory}
个人画像如下：{persona}
### 输出建议
无需遵循固定输出格式，可充分发挥想象力，以自然流畅的叙事方式展现当日生活。需先融入第一视角思考完成前置分析，再通过具体场景与细节串联全天原子事件，突出生活的真实感与独特性即可。对于与当日日程事件相关的事件请用括号标注清楚事件名和详细事件的原子事件名，便于后续识别没做的事件。事件描述要具体详细充实，不要遗漏给定事件里的任何信息，描述时可结合一些前后因果或情景细节。
'''

template_genatomic_json = '''
请你将你之前的输出的一天活动，规整为下面的json格式发给我。注意直接以括号开头，不要输出···json等无关字段。
---输出格式---
[
{"事件标题":"",
"发生时间段":"",
"详细描述":"",
"关键词":""
}
]
---说明---
事件标题简要说明做了什么事情，详细描述详细介绍事件发生的具体内容情景过程。关键词提取事件的主谓宾作为关键词，同时筛选出相关的重点的关键词。关键词一共有五个。关键词尽量简短，除主宾的名称外尽量限制在两个字。主谓宾一定要在关键词里。
'''

template_genatomic_delay = '''
根据你第一轮输出的延期情况,提取出哪些事件被延期了，延期到何日执行,无延期事件则输出空数组[]。然后以json格式输出延期事件。注意直接以括号开头，不要输出···json等无关字段。
**注意无延期事件则输出空数组[]**
输出格式如下：
[{"原子事件": "新年清晨家庭布置", "发生时间": "2025-01-01", "详细描述": "在家中餐厅更换绣有'福'字的桌布时，发现去年聚餐的葡萄酒渍痕迹，回忆起姑妈去年喝醉的场景，精心布置用餐环境", "原事件": "元旦家庭聚餐","延迟日期":"2025-01-02"}]
里面的所有字段严格保留原本日日程事件的描述。
'''

template_genatomic_reflect = '''
下面是过去七天你的生活事件和上一次总结反思内容，请你更新并重新总结你的每周总结反思。包括1）总结这一周的生活事件经历（这是主要部分，其他内容可以少一些）和以前经历的重要事件。2）提出一些反思、想法等。输出一段不超过200字的文字。
过去生活：{content}
上一次反思：{ref}
'''